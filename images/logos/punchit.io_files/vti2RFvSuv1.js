/*!CK:711026249!*//*1441740957,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["RoXgQ"]); }

__d("GenderConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null,{});
__d("MercuryActionStatus",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};},null,{});
__d("MercuryActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",UNPIN_THREAD:"ma-type:unpin-thread",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",UPDATE_BLOCKER_STATUS:"ma-type:update-blocker-status",UPDATE_BLOCKEE_STATUS:"ma-type:update-blockee-status",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note"};},null,{});
__d("MercuryAPIArgsSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};},null,{});
__d("MercuryAttachmentContentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};},null,{});
__d("MercuryAttachmentType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ERROR:"error",FILE:"file",PHOTO:"photo",STICKER:"sticker",SHARE:"share",UNKNOWN:"unknown",VIDEO:"video",ANIMATED_IMAGE:"animated_image"};},null,{});
__d("MercuryAudioType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};},null,{});
__d("MercuryErrorType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};},null,{});
__d("MercuryGlobalActionType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MARK_ALL_READ:"mga-type:mark-all-read"};},null,{});
__d("MercuryLogMessageType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};},null,{});
__d("MercuryMessageSourceTags",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null,{});
__d("MercuryParticipantTypes",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page",FRIEND:"friend",FB4C:"fb4c",NON_FRIEND:"non_friend"};},null,{});
__d("MercuryPayloadSource",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={UNKNOWN:"unknown",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_MARK_THREAD_SEEN:"client_mark_thread_seen",CLIENT_ADD_PARTICIPANTS:"client_add_participants",CLIENT_FETCH_PARTICIPANTS:"client_fetch_participants",CLIENT_DELETE_MESSAGES:"client_delete_messages",CLIENT_DELETE_THREAD:"client_delete_thread",CLIENT_UPDATE_SNIPPET:"client_update_snippet",CLIENT_HANDLE_ERROR:"client_handle_error",CLIENT_UNPIN_THREAD:"client_unpin_thread",CLIENT_CHANGE_FLAG:"client_change_flag",CLIENT_MOVE_PENDING_TO_INBOX:"client_move_pending_to_inbox",CLIENT_CREATE_PAGE_ADMIN_NOTE:"client_create_page_admin_note",SERVER_INITIAL_DATA:"server_initial_data",SERVER_SEND_MESSAGE:"server_send_message",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_MARK_SEEN:"server_mark_seen",SERVER_FETCH_PARTICIPANTS:"server_fetch_participants",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",SERVER_STANDALONE_NOTIFICATIONS:"server_standalone_notifications",SERVER_THREAD_SYNC:"server_thread_sync",SERVER_TAB_PRESENCE:"server_tab_presence",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_SEARCH:"server_search",SERVER_CHANGE_FLAG:"server_change_flag"};},null,{});
__d("MercurySendMessageFields",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null,{});
__d("MercurySourceType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot"};},null,{});
__d("MercuryTimePassed",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null,{});
__d("MessagingEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",UPDATE_BLOCKER_STATUS:"update_blocker_status",UPDATE_BLOCKEE_STATUS:"update_blockee_status",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};},null,{});
__d("MessagingTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",OTHER:"other",PENDING:"pending",MONTAGE:"montage",EVENT:"event",SENT:"sent",SMS_MUTE:"sms_mute",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email"};},null,{});
__d("PageMessageEnumTag",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:"flag",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing"};},null,{});
__d("PhotoResizeModeConst",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTAIN:"s",COVER:"p"};},null,{});
__d('ChatImpressionLogger',['AsyncSignal','requireWeak','ChatConfig','ChatVisibility','Poller','PresencePrivacy','PresenceStatus','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=null;i('AvailableList',function(v){return p=v;});var q=null;function r(){if(!q)return '';return q.getCachedSortedList().toString();}function s(){if(!q||!p)return '';var v=[],w=q.getCachedSortedList();for(var x=0;x<w.length;x++)v[x]=p.get(w[x]);return v.toString();}function t(v){v.setURI('/ajax/chat/imps_logging.php').setData({list_availability:s(),sorted_list:r(),source:'periodical_imps'});}var u={init:function(v){q=v;var w=j.get('chat_impression_logging_periodical',0);if(w){var x=j.get('periodical_impression_logging_config.interval'),y=new l({interval:x,setupRequest:t,clearOnQuicklingEvents:false,dontStart:true});m.subscribe('privacy-user-presence-changed',o(function(){if(k.isOnline()){y.start();}else y.stop();}));}this.init=function(){};},logImpression:function(v,w,x){var y=j.get('chat_impression_logging_with_click'),z={list_availability:y?s():'',sorted_list:y?r():'',source:v,target:w,target_presence:n.get(w),viewport_width:document.body.clientWidth};new h('/ajax/chat/ct.php',Object.assign(z,x)).send();}};f.exports=u;},null);
__d('ImageSourceType',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;},null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();function n(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){'use strict';this._request.fbid=r;return this;};n.prototype.setType=function(r){'use strict';if(!m([i.PROFILE_PICTURE,i.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){'use strict';this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){'use strict';if(!m([k.COVER,k.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){'use strict';this._callback=r;return this;};n.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){l.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new j();o=r;l.registerEndpoints({'/ajax/image_source.php':{request_user_id:h.getID(),mode:l.BATCH_DEFERRED_MULTI,batch_function:function(s,t){var u;(u=s.requests).push.apply(u,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}f.exports=n;},null);
__d('MercuryIDs',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){if(!i||typeof i!=='string')return false;return (/^\w{3,12}:/.test(i));},isValidThreadID:function(i){if(!h.isValid(i))return false;var j=h.tokenize(i);switch(j.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(i){if(!this.isValid(i))throw 'bad_id_format '+i;var j=i.indexOf(':');return {type:i.substr(0,j),value:i.substr(j+1)};},getUserIDFromParticipantID:function(i){if(!this.isValid(i))throw 'bad_id_format '+i;var j=h.tokenize(i),k=j.type,l=j.value;if(k!='fbid')return null;return l;},getParticipantIDFromUserID:function(i){if(isNaN(i))throw 'Not a user ID: '+i;return 'fbid:'+i;},getUserIDFromThreadID:function(i){if(!this.isCanonical(i))return null;return this.tokenize(i).value;},getThreadIDFromUserID:function(i){return 'user:'+i;},getThreadIDFromThreadFBID:function(i){return 'thread:'+i;},getThreadIDFromParticipantID:function(i){var j=this.getUserIDFromParticipantID(i);return j?this.getThreadIDFromUserID(j):null;},getParticipantIDFromFromThreadID:function(i){return this.getParticipantIDFromUserID(this.getUserIDFromThreadID(i)||'');},isCanonical:function(i){return this.isValid(i)&&this.tokenize(i).type==='user';},isGroupChat:function(i){return this.isValid(i)&&this.tokenize(i).type!=='user';},isLocalThread:function(i){return this.isValid(i)&&this.tokenize(i).type==='root';}};f.exports=h;},null);
__d('MercuryAssert',['MercuryIDs'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();f.exports={isParticipantID:function(i){if(!h.isValid(i))throw 'bad_participant_id '+i;},allParticipantIDs:function(i){i.forEach(this.isParticipantID);},isUserParticipantID:function(i){var j=h.tokenize(i);if(j.type!='fbid')throw 'bad_user_id '+i;},isEmailParticipantID:function(i){var j=h.tokenize(i);if(j.type!='email')throw 'bad_email_id '+i;},allThreadID:function(i){i.forEach(this.isThreadID);},isThreadID:function(i){if(!h.isValid(i))throw 'bad_thread_id '+i;}};},null);
__d('MercuryAttachment',['MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','MercuryConfig'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l={getAttachIconClass:function(m){switch(m){case h.PHOTO:return 'MercuryPhotoIcon';case h.VIDEO:return 'MercuryVideoIcon';case h.MUSIC:return 'MercuryMusicIcon';case h.VOICE:return 'MercuryVoiceIcon';case h.TEXT:return 'MercuryTextIcon';case h.MSWORD:return 'MercuryMSWordIcon';case h.MSXLS:return 'MercuryMSXLSIcon';case h.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(m){if(m.startsWith('image')){return 'MercuryPhotoIcon';}else if(m.startsWith('video')){return 'MercuryVideoIcon';}else if(m.startsWith('audio')){return 'MercuryMusicIcon';}else if(m.startsWith('text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(m){if(m.startsWith('image')){return h.PHOTO;}else if(m.startsWith('video')){return h.VIDEO;}else if(m.startsWith('audio')){return h.MUSIC;}else if(m.startsWith('text/plain')){return h.TEXT;}else return h.UNKNOWN;},convertRaw:function(m){var n=[];for(var o=0;o<m.length;o++){var p=m[o];if(p.attach_type===i.PHOTO){n.push(p);}else if(p.filename){var q=l.getAttachTypeByMime(p.filetype),r={};r.attach_type=i.FILE;r.name=p.filename;r.icon_type=q;r.url='';n.push(r);}}return n;},get:function(m){var n=[];if(m.attachments){n=m.attachments;}else if(m.raw_attachments)n=this.convertRaw(m.raw_attachments);if(!(m.attachments&&m.attachments.length>0)){if(m.sticker_id)return n.concat([{attach_type:i.STICKER}]);if(m.preview_attachments&&m.preview_attachments.length>0)return n.concat(m.preview_attachments);}return n;},resizeContain:function(m,n){var o=m.width/m.height,p=n.width/n.height;if(p<o){return {width:Math.ceil(Math.min(m.height*p,n.width)),height:Math.ceil(Math.min(m.height,n.height))};}else return {width:Math.ceil(Math.min(m.width,n.width)),height:Math.ceil(Math.min(m.width/p,n.height))};},isBubblePreferred:function(m){if(k.ChatTabMessengerStyle)return !(this.isPhotoAttachment(m)||this.isStickerAttachment(m)||this.isVideoAttachment(m)||this.isVoiceAttachment(m));return !(this.isPhotoAttachment(m)||this.isStickerAttachment(m)||this.isVideoAttachment(m));},isPhotoAttachment:function(m){return !!(m.attach_type==i.PHOTO||m.attach_type==i.ANIMATED_IMAGE||m.attach_type==i.FILE&&m.preview_url);},isVideoAttachment:function(m){return m.attach_type==i.VIDEO;},isShareAttachment:function(m){return m.attach_type==i.SHARE;},isFileAttachment:function(m){return m.attach_type==i.FILE;},isErrorAttachment:function(m){return m.attach_type==i.ERROR;},isStickerAttachment:function(m){return m.attach_type==i.STICKER;},isVoiceAttachment:function(m){if(!m.metadata)return false;return (m.metadata.type===j.AudioClip||m.metadata.type===j.VoiceMessageWithTranscript);},hasAttribution:function(m){return !!m.app_attribution;}};f.exports=l;},null);
__d('MercurySingletonMixin',['CurrentUser'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j];}};f.exports=i;},null);
__d('MercuryThreadInformer',['ArbiterMixin','LogHistory','MercuryAssert','MercuryLoggingHelper','MercurySingletonMixin','mapObject','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';var q=i.getInstance('mercury_informer');o=babelHelpers.inherits(r,n(h));p=o&&o.prototype;function r(t){p.constructor.call(this);this.$MercuryThreadInformer1=t;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11=0;}r.prototype.updatedThread=function(t){this.$MercuryThreadInformer3[t]=true;this.$MercuryThreadInformer12();};r.prototype.deletedThread=function(t){this.$MercuryThreadInformer2[t]=true;this.$MercuryThreadInformer12();};r.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer5=true;this.$MercuryThreadInformer12();};r.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer6=true;this.$MercuryThreadInformer12();};r.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer7=true;this.$MercuryThreadInformer12();};r.prototype.changedThreadReadState=function(t,u,v){if(!this.$MercuryThreadInformer4[t]||this.$MercuryThreadInformer4[t].timestamp<v)this.$MercuryThreadInformer4[t]={mark_as_read:u,timestamp:v};this.$MercuryThreadInformer12();};r.prototype.receivedMessage=function(t){j.isThreadID(t.thread_id);var u=t.thread_id;if(!this.$MercuryThreadInformer8[u])this.$MercuryThreadInformer8[u]=[];this.$MercuryThreadInformer8[u].push(t);this.updatedThread(u);};r.prototype.reorderedMessages=function(t,u){this.$MercuryThreadInformer9[t]={source:u};this.$MercuryThreadInformer12();};r.prototype.updatedMessage=function(t,u,v){if(!this.$MercuryThreadInformer10[t])this.$MercuryThreadInformer10[t]={};this.$MercuryThreadInformer10[t][u]={source:v};this.updatedThread(t);};r.prototype.synchronizeInforms=function(t){this.$MercuryThreadInformer11++;try{t();}catch(u){throw u;}finally{this.$MercuryThreadInformer11--;this.$MercuryThreadInformer12();}};r.prototype.listen=function(t,u){return this.subscribe('threads-updated',function(v,w){if(w[t])u(t);});};r.prototype.$MercuryThreadInformer12=function(){if(!this.$MercuryThreadInformer11){var t=this.$MercuryThreadInformer2,u=this.$MercuryThreadInformer3,v=this.$MercuryThreadInformer4,w=this.$MercuryThreadInformer5,x=this.$MercuryThreadInformer6,y=this.$MercuryThreadInformer7,z=this.$MercuryThreadInformer8,aa=this.$MercuryThreadInformer9,ba=this.$MercuryThreadInformer10;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5=false;this.$MercuryThreadInformer6=false;this.$MercuryThreadInformer7=false;this.$MercuryThreadInformer8={};this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};var ca=Object.keys(u);if(ca.length||w)this.inform('threadlist-updated',ca);if(ca.length)this.$MercuryThreadInformer13('threads-updated',u);for(var da in v){this.$MercuryThreadInformer13('thread-read-changed',v);break;}for(da in t){this.$MercuryThreadInformer13('threads-deleted',t);break;}if(x)this.$MercuryThreadInformer13('unseen-updated',null);if(y)this.$MercuryThreadInformer13('unread-updated',null);for(da in z){this.$MercuryThreadInformer13('messages-received',z);break;}for(da in aa){this.$MercuryThreadInformer13('messages-reordered',aa);break;}for(da in ba){this.$MercuryThreadInformer13('messages-updated',ba);break;}}};r.prototype.$MercuryThreadInformer13=function(t,u){s(t,u);this.inform(t,u);};function s(t,u){var v=u;if(t=='messages-received')v=m(v,function(w){return w.map(function(x){return k.obfuscateMessage(x);});});q.debug(t,v);}Object.assign(r,l);f.exports=r;},null);
__d('MercuryDispatcher',['ArbiterMixin','LogHistory','MercuryLoggingHelper','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadInformer','invariant','isEmpty','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;'use strict';var s=i.getInstance('mercury_dispatcher');q=babelHelpers.inherits(t,p(h));r=q&&q.prototype;function t(u){r.constructor.call(this);this.$MercuryDispatcher1=u;}t.prototype.handleUpdate=function(u){this.$MercuryDispatcher2(u);!(!!u.from_client!==!!u.preprocessed)?n(0):undefined;delete u.preprocessed;if(!o(u))m.getForFBID(this.$MercuryDispatcher1).synchronizeInforms((function(){if(!u.from_client)this.inform('payload-preprocessed',u);this.inform('update-thread-ids',u.newlyAddedClientIDs||{});this.inform('update-participants',u);this.inform('update-threads',u);this.inform('update-unread',u);this.inform('update-threadlist',u);this.inform('update-pinned-threads',u);this.inform('update-messages',u);this.inform('update-unseen',u);this.inform('update-typing-state',u);this.inform('update-delivery',u);this.inform('update-roger',u.roger);this.inform('update-blocked-users',u);this.inform('model-update-completed',null);}).bind(this));};t.prototype.$MercuryDispatcher2=function(u){var v={actions:[],threads:[]};if(u){if(u.actions)v.actions=u.actions.map(function(y){return j.obfuscateMessage(y);});if(u.threads)v.threads=u.threads.map(function(y){return j.obfuscateThread(y);});}var w=Object.assign({},u,v),x=u.payload_source;if(x!==k.CLIENT_CHANGE_READ_STATUS&&x!==k.CLIENT_MARK_THREAD_SEEN)s.debug('update:'+x,{payload:w,from_client:u.from_client});};Object.assign(t,l);f.exports=t;},null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=i.create({retry:true}),k=h.isEnabled('mercury_send_error_logging'),l={log:function(m){if(!k)return;var n={message_id:m.message_id,timestamp_client:Date.now(),error_type:m.error_data.type,error_code:m.error_data.code,error_description:m.error_data.description,is_transient:m.error_data.is_transient};j.log('MercurySendErrorLoggerConfig',n);}};f.exports=l;},null);
__d('MercurySingletonProvider',['CurrentUser','Map'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';function j(k){this.$MercurySingletonProvider1=new i();this.$MercurySingletonProvider2=k;}j.prototype.getForFBID=function(k){if(!this.$MercurySingletonProvider1.has(k))this.$MercurySingletonProvider1.set(k,new this.$MercurySingletonProvider2(k));return this.$MercurySingletonProvider1.get(k);};j.prototype.get=function(){return this.getForFBID(h.getID());};j.mock=function(k){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=j;},null);
__d('MercuryMessageClientState',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;},null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=9999,k={create:function(l){var m=new h(this.endpoint_uri).setData({message_batch:[l],client:this.client}),n=new i(m,{});Object.assign(n,{error:j,silentError:false,transientError:true,request:m});return n;}};f.exports=k;},null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n='/ajax/mercury/send_messages.php',o=i.getInstance('mercury_server_send_message_queue');function p(q,r,s,t){'use strict';this.sender_id=q;this.queue_id=r;this.$MercuryServerSendMessageQueue1=s.success_handler;this.$MercuryServerSendMessageQueue2=s.error_handler;this.$MercuryServerSendMessageQueue3=s.transport_error_handler;this.$MercuryServerSendMessageQueue4=s.timeout_handler;this.client=t;var u=null;if(k.msgrRegion)u={name:'X-MSGR-Region',value:k.msgrRegion};var v={};v[n]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:l.IMMEDIATE,customHeader:u,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:s.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:s.connection_retries};l.registerEndpoints(v);this.pending_message=null;this.queue=[];}p.prototype.enqueue=function(q){'use strict';this.queue.push(q);this.$MercuryServerSendMessageQueue5();};p.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();l.trySend(n,{message_batch:[this.pending_message],client:this.client},null,this.sender_id,this.queue_id);};p.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};p.prototype.$MercuryServerSendMessageQueue8=function(q){'use strict';this.$MercuryServerSendMessageQueue2(m.create(q));o.error('mark_as_failed',{fbid:this.sender_id,queue_id:this.queue_id,message:j.obfuscateMessage(q)});};p.prototype.handleSuccess=function(q,r){'use strict';this.$MercuryServerSendMessageQueue1(q,r);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};p.prototype.handleError=function(q){'use strict';this.$MercuryServerSendMessageQueue2(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTransportError=function(q){'use strict';this.$MercuryServerSendMessageQueue3(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.handleTimeout=function(q){'use strict';this.$MercuryServerSendMessageQueue4(q);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};p.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';o.debug('maybe_send_next_pending_message',{fbid:this.sender_id,queue_id:this.queue_id,pending_message:j.obfuscateMessage(this.pending_message),queue:this.queue.map(function(r){return j.obfuscateMessage(r);})});var q='send_queue.delayed.queue_length.'+this.queue.length.toString();h.bumpEntityKey('chat.web',q);};f.exports=p;},null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.getInstance('mercury_server_send_message_queue_router'),n='chat.web.send_queue_router';h.setEntitySample(n,.1);function o(p){'use strict';this.fbid=p;this.queues=new j();}o.prototype.enqueue=function(p,q,r,s){'use strict';if(!this.queues.has(p)){this.queues.set(p,new k(this.fbid,p,q,r));m.debug('added queue',{fbid:this.fbid,queue_id:p});h.bumpEntityKey(n,'new_queue');}this.queues.get(p).enqueue(s);};Object.assign(o,l);f.exports=o;},null);
__d('FBID',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';var h={isUser:function(i){return i<2.2e+09||i>=1e+14&&i<=100099999989999||i>=8.9e+13&&i<=89999999999999||i>=6.000001e+13&&i<=60000019999999;}};f.exports=h;},null);
__d('PagesMessengerThreadUtils',['PageMessageEnumTag'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={isFlagThread:function(j){if(j&&j.page_thread_info&&'flagged' in j.page_thread_info)return j.page_thread_info.flagged;return false;},isPageSpecficFilter:function(j){if(j===h.FLAG)return true;return false;}};f.exports=i;},null);
__d('MercuryPageServerRequests',['MercuryAPIArgsSource','MercuryAssert','MercuryServerRequests','PageMessageEnumTag','PagesMessengerThreadUtils','MercuryServerDispatcher'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n,o,p=h.MERCURY;n=babelHelpers.inherits(q,j);o=n&&n.prototype;function q(r){'use strict';o.constructor.call(this,r);var s={'/pages/messaging/thread_tag/add/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/remove/':{request_user_id:r,mode:m.BATCH_SUCCESSIVE,batch_function:this.$MercuryPageServerRequests1,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/thread_tag/list/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)},'/pages/messaging/create_note/':{request_user_id:r,mode:m.IMMEDIATE,handler:(function(t,u){return this.__handleUpdate(t,u);}).bind(this)}};m.registerEndpoints(s);}q.prototype.$MercuryPageServerRequests1=function(r,s){'use strict';var t=r?r.tag_name:s.tag_name,u=r?r.thread_ids:[],v=s?s.thread_ids:[],w=u.concat(v),x={tag_name:t,thread_ids:w};return x;};q.prototype.addThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/add/',u);}).bind(this));};q.prototype.createNote=function(r,s,t,u){'use strict';i.isThreadID(t);this.__threadIDMap.getServerIDFromClientID(t,(function(v){var w={body:r,message_id:s,other_user_fbid:v,timestamp:u};this.__sendRequest('/pages/messaging/create_note/',w);}).bind(this));};q.prototype.fetchThreadlistInfo=function(r,s,t,u,v){'use strict';if(l.isPageSpecficFilter(u)){v=v||p;var w={folder:t,tag_name:u,offset:r,limit:s};this.__sendRequest('/pages/messaging/thread_tag/list/',w);return;}o.fetchThreadlistInfo.call(this,r,s,t,u,v);};q.prototype.removeThreadFlag=function(r,s){'use strict';i.isThreadID(r);this.__threadIDMap.getServerIDFromClientID(r,(function(t){var u={thread_ids:[t],tag_name:k.FLAG};this.__sendRequest('/pages/messaging/thread_tag/remove/',u);}).bind(this));};q.prototype.toString=function(){'use strict';return 'MercuryPageServerRequests';};f.exports=q;},null);
__d('MercuryServerRequestSingletonMixin',['CurrentUser','FBID'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(h.getID());},getForFBID:function(k){var l=this._getInstances();if(!l[k])if(i.isUser(k)){l[k]=new this(k);}else{var m;e(['MercuryPageServerRequests'],function(n){m=new n(k);});l[k]=m;}return l[k];}};f.exports=j;},null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=new h(),j={getServerIDs:function(k,l){var m=k.filter(function(o){return o.indexOf('id')===-1;}),n=function(o){var p=k.map(function(q){return o[q]?o[q]:q;});l(p);};return i.executeOrEnqueue(m,n);},addServerID:function(k,l){i.setResource(k,l);}};f.exports=j;},null);
__d("MercuryServerSendMessageQueueOptions",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;},null);
__d('MercuryServerRequests',['Arbiter','AsyncResponse','ChannelConstants','CurrentUser','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryThreadIDMap','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercuryServerRequestSingletonMixin','MercurySourceType','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','MercuryServerDispatcher','MercuryServerSendMessageQueueOptions','createObjectFrom','errorCode','invariant','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){if(c.__markCompiled)c.__markCompiled();'use strict';var oa=l.getInstance('mercury_server'),pa=o.MERCURY;function qa(bb){return bb.getError()?'_'+bb.getError():'';}function ra(bb,cb){var db=babelHelpers._extends({},bb),eb;if(cb.threads){if(!db.threads)db.threads={};for(eb in cb.threads)db.threads[eb]=Object.keys(ka((db.threads[eb]||[]).concat(cb.threads[eb])));}if(cb.messages){if(!db.messages)db.messages={};for(eb in cb.messages){if(!db.messages[eb])db.messages[eb]={};for(var fb in cb.messages[eb])if(db.messages[eb][fb]){db.messages[eb][fb]=wa(db.messages[eb][fb],cb.messages[eb][fb]);}else db.messages[eb][fb]=cb.messages[eb][fb];}}db.client=bb.client||cb.client;return db;}function sa(bb,cb){var db=Object.assign(ka(bb.folders,true),ka(cb.folders,true)),eb=bb.client||cb.client;return {folders:Object.keys(db),client:eb};}function ta(bb,cb){for(var db in cb)if(bb[db]&&typeof bb[db]==='object'){bb[db]=wa(bb[db],cb[db]);}else if(cb[db]&&typeof cb[db]==='object'){var eb={};Object.assign(eb,cb[db]);bb[db]=eb;}return bb;}function ua(bb,cb){var db=babelHelpers._extends({},bb.ids,cb.ids),eb=bb.client||cb.client;return {ids:db,client:eb};}function va(bb,cb){return cb;}function wa(bb,cb){var db=bb.offset<cb.offset?bb.offset:cb.offset,eb=bb.offset+bb.limit,fb=cb.offset+cb.limit,gb=eb>fb?eb:fb,hb=gb-db,ib=bb.timestamp>cb.timestamp?bb.timestamp:cb.timestamp;return {offset:db,limit:hb,timestamp:ib};}function xa(bb,cb){var db=bb.client||cb.client,eb={ids:{},client:db};Object.assign(eb.ids,bb.ids,cb.ids);return eb;}function ya(bb,cb){var db={},eb,fb=bb.client||cb.client;delete bb.client;delete cb.client;for(eb in bb)Object.assign(db,ka(bb[eb],eb));for(eb in cb)Object.assign(db,ka(cb[eb],eb));var gb={client:fb};for(var hb in db){eb=db[hb];if(!gb[eb])gb[eb]=[];gb[eb].push(hb);}return gb;}function za(bb,cb){var db=bb.client||cb.client,eb=ka(bb.ids,true),fb=ka(cb.ids,true),gb=Object.assign(eb,fb);return {ids:Object.keys(gb),client:db};}function ab(bb){this._fbid=bb;this._lastActionTimestamp=0;this._fetchingThreads={};this._sentMessagesTimestamp={};this.__threadIDMap=r.getForFBID(this._fbid);this._dispatcher=q.getForFBID(this._fbid);this._payloadPreprocessor=z.getForFBID(this._fbid);this._sendMessageQueueOptions=new ja((function(cb,db){return this.__handleUpdate(cb,db);}).bind(this),(function(cb){return this._handleSendMessageError(cb);}).bind(this),(function(cb){return this._handleSendMessageTransportError(cb);}).bind(this),(function(cb){return this._handleSendMessageTimeout(cb);}).bind(this),aa.sendMessageTimeout,ga.SEND_CONNECTION_RETRIES);this._registerEndpoints();}Object.assign(ab.prototype,{fetchThreadlistInfo:function(bb,cb,db,eb,fb){db=db||ha.INBOX;fb=fb||pa;var gb=eb?ia.IMMEDIATE:null,hb={client:fb};hb[db]={offset:bb,limit:cb,filter:eb};this.__sendRequest('/ajax/mercury/threadlist_info.php',hb,gb);},fetchPinnedThreads:function(){this.__sendRequest('/mercury/pinned_threads/',{});},fetchUnseenThreadIDs:function(bb,cb){cb=cb||pa;this.fetchThreadlistInfo(ea.RECENT_THREAD_OFFSET,ea.JEWEL_THREAD_COUNT,bb,null,cb);},fetchUnreadThreadIDs:function(bb,cb){cb=cb||pa;this.__sendRequest('/ajax/mercury/unread_threads.php',{folders:[bb],client:cb});},fetchMissedMessages:function(bb,cb){cb=cb||pa;var db={last_action_timestamp:this._lastActionTimestamp,folders:bb,client:cb};db.last_action_timestamp=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/thread_sync.php',db);},fetchThreadData:function(bb,cb){cb=cb||pa;p.allThreadID(bb);var db={threads:{},client:cb},eb=[],fb=[];bb.forEach((function(hb){if(this._fetchingThreads[hb])return;this._fetchingThreads[hb]=true;var ib=this.__threadIDMap.getServerIDFromClientIDNow(hb),jb=u.tokenize(hb);if(jb.type=='user'){eb.push(jb.value);db.threads.user_ids=eb;}else if(jb.type=='thread'){if(ib){fb.push(ib);}else fb.push(jb.value);db.threads.thread_fbids=fb;}else if(jb.type=='root'){if(ib){fb.push(ib);db.threads.thread_fbids=fb;}}else if(jb.type!='pending')throw new Error('Unknown thread type',jb);}).bind(this));this._dispatcher.inform("fetch-thread-data",db);for(var gb in db.threads){this.__sendRequest('/ajax/mercury/thread_info.php',db);break;}},ensureThreadIsFetched:function(bb,cb){cb=cb||pa;if(!this.__threadIDMap.getClientIDFromServerIDNow(bb)&&!this._fetchingThreads[bb]){this._fetchingThreads[bb]=true;this.__sendRequest('/ajax/mercury/thread_info.php',{threads:{thread_fbids:[bb]},client:cb});}},fetchThreadMessages:function(bb,cb,db,eb,fb,gb){p.isThreadID(bb);gb=gb||pa;var hb,ib,jb=u.tokenize(bb),kb=this.__threadIDMap.getServerIDFromClientIDNow(bb),lb=false;if(kb){hb=kb;ib=jb.type=='user'?'user_ids':'thread_fbids';}else{hb=jb.value;switch(jb.type){case 'user':ib='user_ids';lb=true;break;case 'thread':ib='thread_fbids';break;}}var mb={messages:{},threads:{},client:gb};if(ib){mb.messages[ib]={};mb.messages[ib][hb]={offset:cb,timestamp:eb,limit:db};if(lb)mb.threads[ib]=[hb];this.__sendRequest('/ajax/mercury/thread_info.php',mb,fb);}else this.__threadIDMap.getServerIDFromClientID(bb,(function(nb){mb.messages.thread_fbids={};mb.messages.thread_fbids[nb]={offset:cb,timestamp:eb,limit:db};this.__sendRequest('/ajax/mercury/thread_info.php',mb,fb);}).bind(this));},handleThreadInfoError:function(bb){var cb=bb.getRequest().getData(),db=[];if(cb.messages){for(var eb in cb.messages.thread_fbids)db.push(this._createServerErrorLogMessage(this.__threadIDMap.getClientIDFromServerIDNow(eb)));for(var fb in cb.messages.user_ids)db.push(this._createServerErrorLogMessage('user:'+fb));for(var gb in cb.messages.group_ids)db.push(this._createServerErrorLogMessage('group:'+gb));}if(db.length)this._dispatcher.handleUpdate({actions:db,from_client:true,payload_source:x.CLIENT_CHANNEL_MESSAGE});if(cb.threads&&(cb.threads.user_ids||cb.threads.group_ids||cb.threads.thread_ids)){var hb=5,ib=true;if(!cb.retry_count){cb.retry_count=0;if(cb.messages)delete cb.messages;}else if(cb.retry_count>=hb){ib=false;(cb.threads.thread_ids||[]).forEach((function(kb){if(kb in this._fetchingThreads)delete this._fetchingThreads[kb];}).bind(this));}if(ib){var jb=Math.pow(2,cb.retry_count)*1000;na((function(){oa.log('retry_thread',cb);this.__sendRequest('/ajax/mercury/thread_info.php',cb);}).bind(this),jb);cb.retry_count++;}}},markFolderAsRead:function(bb){this.__sendRequest('/ajax/mercury/mark_folder_as_read.php',{folder:bb});var cb=[{action_type:t.MARK_ALL_READ,action_id:null,folder:bb}];this._dispatcher.handleUpdate({global_actions:cb,from_client:true,payload_source:x.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(bb,cb,db,eb,fb,gb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(hb){var ib,jb={ids:(ib={},ib[hb]=cb,ib),source:db,watermarkTimestamp:eb,titanOriginatedThreadId:fb,shouldSendReadReceipt:gb};this.__sendRequest('/ajax/mercury/change_read_status.php',jb);}).bind(this));},changeThreadArchivedStatus:function(bb,cb,db){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(eb){var fb={ids:{},source:db};fb.ids[eb]=cb;this.__sendRequest('/ajax/mercury/change_archived_status.php',fb);}).bind(this));},changeThreadFolder:function(bb,cb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(db){var eb={};eb[cb]=[db];this.__sendRequest('/ajax/mercury/move_thread.php',eb);}).bind(this));},changeMutingOnThread:function(bb,cb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(db){this.__sendRequest('/ajax/mercury/change_mute_thread.php',{thread_fbid:db,mute_settings:cb,payload_source:pa});}).bind(this));},markThreadSpam:function(bb,cb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(db){this.__sendRequest('/ajax/mercury/mark_spam.php',{id:db,source:cb});}).bind(this));},unmarkThreadSpam:function(bb,cb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(db){this.__sendRequest('/ajax/mercury/unmark_spam.php',{id:db,source:cb});}).bind(this));},deleteThread:function(bb,cb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(db){var eb={ids:[db],source:cb};this.__sendRequest('/ajax/mercury/delete_thread.php',eb);}).bind(this));},unpinThread:function(bb){p.isThreadID(bb);this.__threadIDMap.getServerIDFromClientID(bb,(function(cb){this.__sendRequest('/mercury/unpin_thread/',{id:cb});}).bind(this));},deleteMessages:function(bb,cb){fa.getServerIDs(cb||[],(function(db){this.__sendRequest('/ajax/mercury/delete_messages.php',{message_ids:db});}).bind(this));},sendDeliveryReceipts:function(bb,cb){fa.getServerIDs(bb||[],(function(db){this.__sendRequest('/ajax/mercury/delivery_receipts.php',{message_ids:db,thread_ids:cb});}).bind(this));},sendNewMessage:function(bb,cb){cb=cb||pa;if(bb.client_state&&bb.client_state!==w.SEND_TO_SERVER)return;var db=u.tokenize(bb.thread_id),eb=db.type,fb=babelHelpers._extends({},bb);fb.thread_id=null;if(eb=='user'){fb.other_user_fbid=db.value;this._sendNewMessageToServer(fb,cb);}else if(eb=='thread'){fb.thread_fbid=db.value;this._sendNewMessageToServer(fb,cb);}else if(eb=='root'&&db.value==fb.offline_threading_id){fb.client_thread_id=bb.thread_id;this._sendNewMessageToServer(fb,cb);}else{!u.isLocalThread(bb.thread_id)?ma(0):undefined;this.__threadIDMap.getServerIDFromClientID(bb.thread_id,(function(gb){fb.thread_fbid=gb;this._sendNewMessageToServer(fb,cb);}).bind(this));}},_sendNewMessageToServer:function(bb,cb){h.inform(j.ATTEMPT_RECONNECT);this._sentMessagesTimestamp[bb.message_id]=Date.now();ba.getForFBID(this._fbid).enqueue(bb.other_user_fbid||bb.thread_fbid||bb.client_thread_id,this._sendMessageQueueOptions,cb,bb);},markSeen:function(){var bb=this._lastActionTimestamp;this.__sendRequest('/ajax/mercury/mark_seen.php',{seen_timestamp:bb});},_handleSendMessageErrorCommon:function(bb,cb,db,eb){oa.debug('handle_send_message_error_common',{reliability_error_status:db,request_error_status:cb});var fb=bb.getData(),gb=fb.message_batch,hb=gb.map(function(jb){var kb={action_type:n.SEND_MESSAGE,other_user_fbid:jb.other_user_fbid,thread_fbid:jb.thread_fbid,client_message_id:jb.message_id,message_id:jb.message_id,client_thread_id:jb.client_thread_id,status:cb,error_data:eb};return kb;});hb.forEach(function(jb){if(jb.action_type===n.SEND_MESSAGE&&jb.status===m.ERROR)y.log(jb);},this);var ib={actions:hb,payload_source:x.CLIENT_HANDLE_ERROR};this._payloadPreprocessor.handleUpdate(ib);},handleSendMessageError:function(bb){var cb=bb.getPayload(),db=null,eb=null;if(cb&&cb.error_payload){db=m.UNCONFIRMED;eb='send_error';}else{db=m.ERROR;eb='request_error'+qa(bb);}var fb=bb.error;if(fb===1404102)i.verboseErrorHandler(bb);var gb=/<.*>/.test(bb.getErrorDescription())?bb.getErrorSummary():bb.getErrorDescription();this._handleSendMessageErrorCommon(bb.getRequest(),db,eb,{type:s.SERVER,code:bb.getError(),description:gb,is_transient:bb.isTransient()});},handleSendMessageTransportError:function(bb){this._handleSendMessageErrorCommon(bb.getRequest(),m.ERROR,'transport_error'+qa(bb),{type:s.TRANSPORT,code:bb.getError(),is_transient:true});},handleSendMessageTimeout:function(bb){this._handleSendMessageErrorCommon(bb,m.ERROR,'transport_timeout',{type:s.TIMEOUT,is_transient:true});},getLastActionTimestamp:function(){return this._lastActionTimestamp;},updateLastActionTimestamp:function(bb){if(bb)this._lastActionTimestamp=Math.max(this._lastActionTimestamp,bb);},markThreadFetched:function(bb){delete this._fetchingThreads[bb];},_createServerErrorLogMessage:function(bb){return {action_type:n.LOG_MESSAGE,thread_id:bb,message_id:bb,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:da.UNKNOWN,log_message_type:v.SERVER_ERROR,log_message_data:{}};},_getForAsyncRequest:function(bb){var cb=bb.getData(),db=cb.request_user_id?cb.request_user_id:k.getID();return ab.getForFBID(db);},__handleUpdate:function(bb,cb){this._getForAsyncRequest(cb)._payloadPreprocessor.handleUpdate(bb);},_handleThreadInfoError:function(bb){var cb=this._getForAsyncRequest(bb.getRequest());cb.handleThreadInfoError(bb);},_handleSendMessageError:function(bb){var cb=this._getForAsyncRequest(bb.getRequest());cb.handleSendMessageError(bb);},_handleSendMessageTransportError:function(bb){var cb=this._getForAsyncRequest(bb.getRequest());cb.handleSendMessageTransportError(bb);},_handleSendMessageTimeout:function(bb){var cb=this._getForAsyncRequest(bb);cb.handleSendMessageTimeout(bb);},_registerEndpoints:function(){var bb=null;if(aa.msgrRegion)bb={name:'X-MSGR-Region',value:aa.msgrRegion};var cb={'/ajax/mercury/thread_sync.php':{request_user_id:this._fbid,mode:ia.IDEMPOTENT,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/thread_info.php':{request_user_id:this._fbid,mode:ia.BATCH_DEFERRED_MULTI,customHeader:bb,batch_function:ra,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this),error_handler:(function(db){return this._handleThreadInfoError(db);}).bind(this)},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/change_read_status.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE,customHeader:bb,batch_function:ua,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/mark_seen.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE,customHeader:bb,batch_function:va,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/threadlist_info.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE_UNIQUE,customHeader:bb,batch_function:ta,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/mark_spam.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/unmark_spam.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/unread_threads.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE_UNIQUE,customHeader:bb,batch_function:sa,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/chat/settings.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb},'/ajax/mercury/change_archived_status.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE,customHeader:bb,batch_function:xa,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/delete_thread.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE,customHeader:bb,batch_function:za,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/delete_messages.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/delivery_receipts.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/move_thread.php':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE,customHeader:bb,batch_function:ya,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/ajax/mercury/change_mute_thread.php':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/mercury/pinned_threads/':{request_user_id:this._fbid,mode:ia.BATCH_SUCCESSIVE_UNIQUE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)},'/mercury/unpin_thread/':{request_user_id:this._fbid,mode:ia.IMMEDIATE,customHeader:bb,handler:(function(db,eb){return this.__handleUpdate(db,eb);}).bind(this)}};ia.registerEndpoints(cb);},__sendRequest:function(bb,cb,db){ia.trySend(bb,cb,db,this._fbid);}});Object.assign(ab,ca);f.exports=ab;},null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(n){this.$MercuryThreadIDMap1=n;this.$MercuryThreadIDMap2=new h();this.$MercuryThreadIDMap3=new h();}l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};l.prototype.setServerIDToClientID=function(n,o){var p=this.getClientIDFromServerIDNow(n);if(p){p!==o;return;}this.forceSetServerIDToClientID(n,o);};l.prototype.forceSetServerIDToClientID=function(n,o){this.$MercuryThreadIDMap2.setResource(n,o);this.$MercuryThreadIDMap3.setResource(o,n);};l.prototype.setDeprecatedServerIDToClientID=function(n,o){if(n)this.$MercuryThreadIDMap2.setResource(n,o);};l.prototype.getClientIDFromServerIDNow=function(n){return this.$MercuryThreadIDMap2.getResource(n);};l.prototype.getClientIDFromServerID=function(n,o){this.$MercuryThreadIDMap2.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(p){p.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(n);}).bind(this));};l.prototype.getServerIDFromClientIDNow=function(n){return this.$MercuryThreadIDMap3.getResource(n);};l.prototype.getServerIDFromClientID=function(n,o){i.isThreadID(n);var p=this.$MercuryThreadIDMap3.executeOrEnqueue(n,o);e(['MercuryServerRequests'],(function(q){var r=this.$MercuryThreadIDMap3.getUnavailableResources(p),s=j.tokenize(n);if(r.length&&s.type!='root')q.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(r);}).bind(this));};l.prototype.hasClientIDForServerID=function(n){return !!this.getClientIDFromServerIDNow(n);};l.prototype.convertThreadIDIfAvailable=function(n){var o=this.getClientIDFromServerIDNow(n);return o||n;};l.prototype.canLinkExternally=function(n){i.isThreadID(n);var o=j.tokenize(n);return o.type=='user'||!!this.getServerIDFromClientIDNow(n);};var m=new k(l);f.exports=l;},null);
__d('MercuryServerPayloadPreprocessor',['CurrentEnvironment','MercuryIDs','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonMixin','MercuryThreadIDMap','invariant','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();'use strict';function s(t){this.$MercuryServerPayloadPreprocessor1=t;this.$MercuryServerPayloadPreprocessor2=p.getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=m.getForFBID(this.$MercuryServerPayloadPreprocessor1);}s.prototype.handleUpdate=function(t){var u={};!!t.from_client?q(0):undefined;(t.threads||[]).forEach((function(ma){this.$MercuryServerPayloadPreprocessor4(ma,u);var na=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(ma.thread_id);e(['MercuryServerRequests'],(function(oa){var pa=oa.getForFBID(this.$MercuryServerPayloadPreprocessor1);pa.markThreadFetched(ma.thread_id);pa.markThreadFetched(na);pa.updateLastActionTimestamp(ma.timestamp);}).bind(this));}).bind(this));(t.ordered_threadlists||[]).forEach((function(ma){var na=ma.thread_fbids||[];na=na.concat(ma.other_user_fbids||[]);ma.thread_ids=na.map((function(oa){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(oa.toString());}).bind(this));}).bind(this));if(t.pinned_threads&&t.pinned_threads.thread_fbids)t.pinned_threads.thread_fbids=t.pinned_threads.thread_fbids.map((function(ma){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ma);}).bind(this));if(t.delivery_receipts){var v={};for(var w=t.delivery_receipts,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z,ba=aa.other_user_fbid?i.getThreadIDFromUserID(aa.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(aa.thread_fbid);v[ba]=aa.time;}t.delivery_receipts=v;}t.actions=t.actions||[];t.actions.forEach((function(ma){if(ma.action_type===k.SEND_MESSAGE&&ma.status===j.ERROR)n.log(ma);var na=null,oa=null;if(ma.other_user_fbid){oa=i.getThreadIDFromUserID(ma.other_user_fbid);na=ma.other_user_fbid;}else if(ma.thread_fbid){oa=i.getThreadIDFromThreadFBID(ma.thread_fbid);na=ma.thread_fbid;}else if(ma.thread_id){oa=i.getThreadIDFromThreadFBID(ma.thread_id);na=ma.thread_id;}else if(ma.status&&ma.status!=j.SUCCESS&&ma.client_thread_id){oa=ma.client_thread_id;}else q(0);na=na&&na.toString();ma.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(na)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(na):oa;if(ma.action_type==k.SEND_MESSAGE&&ma.client_thread_id&&na){ma.thread_id=ma.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(na,ma.client_thread_id);u[na]=ma.client_thread_id;}!ma.thread_id?q(0):undefined;if(!t.payload_source||!t.payload_source.startsWith('server'))e(['MercuryServerRequests'],(function(pa){pa.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(ma.timestamp);}).bind(this));}).bind(this));this.$MercuryServerPayloadPreprocessor5(t);if(t.end_of_history){var ca=[];for(var da=0;da<t.end_of_history.length;da++){var ea=t.end_of_history[da];if(ea.type=='user'){ca.push('user:'+ea.fbid);}else if(ea.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(ea.fbid))ca.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ea.fbid));}t.end_of_history=ca;}if(t.roger){var fa={};for(var ga in t.roger){var ha=Object.keys(t.roger[ga]),ia;if(ga){ia=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(ga);}else if(ha.length===1)ia=i.getThreadIDFromUserID(ha[0]);if(ia){var ja=t.roger[ga];fa[ia]={};for(var ka in ja)if(ja.hasOwnProperty(ka)){var la=i.getParticipantIDFromUserID(ka);fa[ia][la]=ja[ka];}}}t.roger=fa;}t.newlyAddedClientIDs=u;t.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(t);};s.prototype.$MercuryServerPayloadPreprocessor4=function(t,u){var v=t.other_user_fbid?t.other_user_fbid:t.thread_fbid;!v?q(0):undefined;var w=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v);if(!w){w=t.other_user_fbid?i.getThreadIDFromUserID(t.other_user_fbid):i.getThreadIDFromThreadFBID(t.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(v,w);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(t.thread_id,w);u[v]=w;}t.thread_id=w;};s.prototype.$MercuryServerPayloadPreprocessor5=function(t){t.actions.forEach(function(u){if(u.action_type===k.USER_GENERATED_MESSAGE){u.attachments=u.attachments||[];u.attachments.forEach(function(v){if(l.isShareAttachment(v)&&h.messengerdotcom){var w=new r(v.share.uri);if(!w.getDomain())v.share.uri=w.setDomain('facebook.com').setSubdomain(r.getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};Object.assign(s,o);f.exports=s;},null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();'use strict';var o=h.getInstance('short_profiles');function p(r){this.$MercuryParticipantFetcher1=k.getForFBID(r);this.$MercuryParticipantFetcher2=false;this.$MercuryParticipantFetcher3=new l();this.$MercuryParticipantFetcher4=new l();}p.prototype.fetch=function(r){this.$MercuryParticipantFetcher5(r);this.$MercuryParticipantFetcher6();};p.prototype.fetchMulti=function(r){r.forEach((function(s){return this.$MercuryParticipantFetcher5(s);}).bind(this));this.$MercuryParticipantFetcher6();};p.prototype.$MercuryParticipantFetcher5=function(r){if(!this.$MercuryParticipantFetcher4.has(r))this.$MercuryParticipantFetcher3.add(r);};p.prototype.$MercuryParticipantFetcher6=function(){if(this.$MercuryParticipantFetcher2||this.$MercuryParticipantFetcher3.size===0)return;this.$MercuryParticipantFetcher2=true;n((function(){this.$MercuryParticipantFetcher2=false;this.$MercuryParticipantFetcher3.forEach((function(r){return this.$MercuryParticipantFetcher4.add(r);}).bind(this));this.$MercuryParticipantFetcher7(this.$MercuryParticipantFetcher3,(function(r){r.forEach((function(s){return this.$MercuryParticipantFetcher4['delete'](s.id);}).bind(this));this.$MercuryParticipantFetcher8(r);}).bind(this));this.$MercuryParticipantFetcher3.clear();}).bind(this));};p.prototype.$MercuryParticipantFetcher7=function(r,s){var t=[];r.forEach(function(u){var v=i.tokenize(u),w=v.type,x=v.value;w==='fbid'&&t.push(x);});if(t.length>0){m.getMulti(t,function(u){var v=[];for(var w in u)v.push(q(u[w],w));s(v);if(v.length!==t.length)o.error('server_fetch_participant_count_error',{expectedIDs:t,receivedIDs:Object.keys(u)});});o.debug('client_fetch_participants',{userIDs:t});}};p.prototype.$MercuryParticipantFetcher8=function(r){this.$MercuryParticipantFetcher1.handleUpdate({participants:r,from_client:false,payload_source:j.SERVER_FETCH_PARTICIPANTS});};function q(r,s){var t=babelHelpers._extends({gender:r.gender,fbid:r.id||s,href:r.uri,id:i.getParticipantIDFromUserID(r.id||s),image_src:r.thumbSrc,name:r.name,short_name:r.firstName,employee:r.employee,is_employee_away:r.is_employee_away,type:r.type,vanity:r.vanity,is_friend:r.is_friend,is_messenger_user:r.is_messenger_user,social_snippets:r.social_snippets},{});if(r.officeStatus){t.officeStatus=r.officeStatus;t.officeStatusStartDate=r.officeStatusStartDate;t.officeStatusEndDate=r.officeStatusEndDate;t.officeStatusComment=r.officeStatusComment;t.officeStatusLocation=r.officeStatusLocation;}return t;}f.exports=p;},null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j=new h(),k=new h(),l={getID:function(m){return j.get(m);},getVanity:function(m){return k.get(m);},hasID:function(m){return k.has(m);},hasVanity:function(m){return j.has(m);},set:function(m,n){i.isParticipantID(n);j.set(m,n);k.set(n,m);}};f.exports=l;},null);
__d('MercuryParticipants',['CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();'use strict';var y='change';function z(ba){this.$MercuryParticipants1=ba;this.$MercuryParticipants2=new i();this.$MercuryParticipants3=new m();this.$MercuryParticipants4=new p(this.$MercuryParticipants1);this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',(function(ca,da){if(da.participants&&da.participants.length>0)this.$MercuryParticipants6(da.participants);}).bind(this));}z.prototype.addListener=function(ba,ca){return this.$MercuryParticipants2.addListener(ba,ca);};z.prototype.getIDFromVanityOrFBID=function(ba){if(!ba)return null;if(t.hasVanity(ba))return t.getID(ba);if(/^\d+$/.test(ba))return o.getParticipantIDFromUserID(ba);};z.prototype.getNow=function(ba){return this.$MercuryParticipants7(ba);};z.prototype.getOrFetch=function(ba){var ca=this.$MercuryParticipants7(ba);if(!ca)this.$MercuryParticipants4.fetch(ba);return ca;};z.prototype.get=function(ba,ca){n.isParticipantID(ba);return this.$MercuryParticipants8([ba],function(da){ca(da[ba]);});};z.prototype.getMulti=function(ba,ca){return this.$MercuryParticipants8(ba,ca);};z.prototype.getBigImageMulti=function(ba,ca){n.allParticipantIDs(ba);var da=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(ba,(function(ea){var fa={},ga=0,ha=new v(),ia=(function(ma,na){ga++;fa[ma]=na;if(ga===ba.length){ca(fa);if(ha.size>0)this.$MercuryParticipants9(ha);}}).bind(this),ja=(function(ma,na){this.$MercuryParticipants3.setResource(ma,l.set(this.$MercuryParticipants3.getResource(ma),{big_image_src:na.uri}));ha.add(ma);ia(ma,na.uri);}).bind(this);for(var ka in ea){var la=ea[ka];if(!la.big_image_src){new j().setFBID(o.getUserIDFromParticipantID(ka)).setType(k.PROFILE_PICTURE).setDimensions(da,da).setResizeMode(u.COVER).setCallback(ja.bind(null,ka)).send();}else ia(la.id,la.big_image_src);}}).bind(this));};z.prototype.getOrderedBigImageMulti=function(ba,ca){return this.getBigImageMulti(ba,function(da){ca(ba.map(function(ea){return da[ea];}));});};z.prototype.$MercuryParticipants8=function(ba,ca){n.allParticipantIDs(ba);var da=this.$MercuryParticipants3.executeOrEnqueue(ba,ca),ea=this.$MercuryParticipants3.getUnavailableResources(da).filter((function(fa){var ga=o.tokenize(fa),ha=ga.type,ia=ga.value;if(ha==='email'){this.$MercuryParticipants10(fa,ia);return false;}return true;}).bind(this));this.$MercuryParticipants4.fetchMulti(ea);return this.$MercuryParticipants11(da);};z.prototype.$MercuryParticipants7=function(ba){var ca=this.$MercuryParticipants3.getResource(ba);if(!ca){var da=o.tokenize(ba),ea=da.type,fa=da.value;if(ea==='email')ca=this.$MercuryParticipants10(ba,fa);}return ca;};z.prototype.$MercuryParticipants10=function(ba,ca){var da=new l(aa(ba,ca));this.$MercuryParticipants3.setResource(ba,da);return da;};z.prototype.$MercuryParticipants9=function(ba){this.$MercuryParticipants2.emit(y,ba);};z.prototype.$MercuryParticipants6=function(ba){var ca=ba.map(function(da){return da.id;});ba=ba.map((function(da){if(da.vanity)t.set(da.vanity,da.id);var ea=this.$MercuryParticipants3.getResource(da.id);return ea?l.set(ea,da):new l(this.$MercuryParticipants12(da));}).bind(this));this.$MercuryParticipants3.addResourcesAndExecute(w(ca,ba));this.$MercuryParticipants9(new v(ca));};z.prototype.$MercuryParticipants12=function(ba){var ca=ba.type===q.USER||ba.type===q.FRIEND;if(!ca)return ba;if(!ba.name&&!ba.href&&!ba.vanity){var da=x._("Facebook User");ba.name=da;ba.short_name=da;}return ba;};z.prototype.$MercuryParticipants11=function(ba){return {remove:(function(){this.$MercuryParticipants3.unsubscribe(ba);}).bind(this)};};function aa(ba,ca){return {gender:r.UNKNOWN_GENDER,href:null,id:ba,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ca,short_name:ca,employee:false};}f.exports=new z(h.getID());},null);
__d('GroupChatMessageBlockAlert',['DialogX','GenderConst','MercuryParticipants','React','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q={show:function(r,s,t){var u=new h({width:445},k.createElement('div',null,k.createElement(o,null,p._("See Conversations?")),k.createElement(l,null,this.dialogBodyText(r)),k.createElement(n,null,k.createElement(m,{action:'cancel',label:this.leaveGroupButton(),onClick:function(){return t();}}),k.createElement(m,{use:'confirm',action:'cancel',label:this.openChatButton(),onClick:function(){return s();}}))));u.show();},openChatButton:function(){return p._("See Conversation");},leaveGroupButton:function(){return p._("Leave Group");},dialogBodyText:function(r){if(r.length!==1){return p._("People you've blocked are in this conversation. If you see this conversation, you'll get each other's messages to the group.");}else{var s='';j.get(r.pop(),function(t){switch(t.gender){case i.FEMALE_SINGULAR:s=p._("{name} is in this group conversation but you've blocked her. If you see this conversation, you'll see her messages to the group and she'll see yours.",[p.param('name',t.short_name)]);break;case i.MALE_SINGULAR:s=p._("{name} is in this group conversation but you've blocked him. If you see this conversation, you'll see his messages to the group and he'll see yours.",[p.param('name',t.short_name)]);break;default:s=p._("{name} is in this group conversation but you've blocked them. If you see this conversation, you'll see their messages to the group and they'll see yours.",[p.param('name',t.short_name)]);}});return s;}}};f.exports=q;},null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','Set'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();'use strict';function m(n){this.$MercuryBlockedParticipants1=n;this.$MercuryBlockedParticipants2=new l();this.$MercuryBlockedParticipants3=j.getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',(function(o,p){if(p.message_blocked_ids)this.$MercuryBlockedParticipants2=new l(p.message_blocked_ids);var q=p.actions||p.global_actions;for(var r=q,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var u;if(s){if(t>=r.length)break;u=r[t++];}else{t=r.next();if(t.done)break;u=t.value;}var v=u;if(v.action_type!==i.UPDATE_BLOCKER_STATUS)continue;if(v.message_blocked){this.$MercuryBlockedParticipants4(v.thread_fbid);}else this.$MercuryBlockedParticipants5(v.thread_fbid);}}).bind(this));}m.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};m.prototype.setIDs=function(n){this.$MercuryBlockedParticipants2=n;};m.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};m.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};m.prototype.$MercuryBlockedParticipants4=function(n){this.$MercuryBlockedParticipants2.add(h.getParticipantIDFromUserID(n));};m.prototype.$MercuryBlockedParticipants5=function(n){this.$MercuryBlockedParticipants2['delete'](h.getParticipantIDFromUserID(n));};m.prototype.isMessageBlocked=function(n){if(!n.is_canonical)return false;var o=n.participants.filter((function(p){return p!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this));return !o.every((function(p){return !this.$MercuryBlockedParticipants2.has(p);}).bind(this));};m.prototype.isPresentInGroupThread=function(n){if(!n.is_canonical&&this.$MercuryBlockedParticipants7(n).length>0)return true;return false;};m.prototype.inGroupThread=function(n){if(n.is_canonical)return [];return this.$MercuryBlockedParticipants7(n);};m.prototype.$MercuryBlockedParticipants7=function(n){var o=n.participants.filter((function(q){return q!=h.getParticipantIDFromUserID(this.getFBID());}).bind(this)),p=o.filter((function(q){return this.$MercuryBlockedParticipants2.has(q)!==false;}).bind(this));return p;};Object.assign(m,k);f.exports=m;},null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j={generateMessageID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=h.getSessionID();return '<'+m+':'+n+'-'+o+'@mail.projektitan.com>';},generateThreadID:function(l){return 'root:'+j.generateOfflineThreadingID(l);},generateOfflineThreadingID:function(l){var m=l||Date.now(),n=i(0,4294967295),o=('0000000000000000000000'+n.toString(2)).slice(-22),p=m.toString(2)+o;return k(p);}};function k(l){var m='';while(l!='0'){var n=0,o='';for(var p=0;p<l.length;p++){n=2*n+parseInt(l[p],10);if(n>=10){o+='1';n-=10;}else o+='0';}m=n.toString()+m;l=o.slice(o.indexOf('1'));}return m;}f.exports=j;},null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j={canReply:function(l){return !!(l.is_subscribed&&(l.can_reply===undefined||l.can_reply)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));},getMuteSetting:function(l){return (l.mute_settings&&l.mute_settings[k(h.getID())]);},isEmptyLocalThread:function(l){return (i.tokenize(l.thread_id).type==='root'&&!l.timestamp);},isMuted:function(l){return j.getMuteSetting(l)!==undefined;},isNewEmptyLocalThread:function(l){return !!(j.isEmptyLocalThread(l)&&l.participants&&l.participants.length===0);},showComposer:function(l){return !!(l.is_subscribed&&(l.composer_enabled===undefined||l.composer_enabled)&&!l.has_email_participant&&!l.read_only&&(l.recipients_loadable||l.recipients_loadable===undefined));}};function k(l){return l+'@facebook.com';}f.exports=j;},null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';var i={renderFilteredContent:function(j){if(j.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(j.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(j.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(j.is_filtered_content_invalid_app)return h._("This message was removed because the app it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive.");}};f.exports=i;},null);
__d('MercuryThreads',['EventEmitter','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryLoggingHelper','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercuryThreadInfo','MercuryThreadInformer','MessagingTag','MercuryDisplayTimeFilterMessageRenderer','Set','emptyFunction','ifRequired','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){if(c.__markCompiled)c.__markCompiled();'use strict';var ga=new h(),ha=k.getInstance('mercury_threads');function ia(ka){this.$MercuryThreads1=ka;this.$MercuryThreads2=w.getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=z.getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=s.getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=q.getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=false;this.$MercuryThreads7=new j();this.$MercuryThreads8=new ca();this.$MercuryThreads9=false;this.$MercuryThreads10=new ca();this.$MercuryThreads11=new ca();this.$MercuryThreads12();}ia.getForFBID=function(ka){return ja.getForFBID(ka);};ia.get=function(){return ja.get();};ia.prototype.getThreadMetaNow=function(ka){n.isThreadID(ka);return this.$MercuryThreads7.getResource(ka);};ia.prototype.getOrFetch=function(ka){var la=this.getThreadMetaNow(ka);if(!la&&!this.$MercuryThreads11.has(ka))this.$MercuryThreads10.add(ka);if(this.$MercuryThreads10.size>0&&!this.$MercuryThreads9)this.$MercuryThreads13();return la;};ia.prototype.$MercuryThreads13=function(){if(this.$MercuryThreads9)return;this.$MercuryThreads9=true;fa((function(){this.$MercuryThreads9=false;this.$MercuryThreads10.forEach((function(ka){return this.$MercuryThreads11.add(ka);}).bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads10),(function(ka){for(var la in ka)ka.hasOwnProperty(la)&&this.$MercuryThreads11['delete'](la);}).bind(this));this.$MercuryThreads10.clear();}).bind(this));};ia.prototype.getThreadMeta=function(ka,la,ma){return this.getMultiThreadMeta([ka],function(na){return la(na[ka]);},ma);};ia.prototype.getMultiThreadMeta=function(ka,la,ma){n.allThreadID(ka);var na=this.$MercuryThreads7.executeOrEnqueue(ka,la),oa=this.$MercuryThreads7.getUnavailableResources(na);if(oa.length){var pa=[];for(var qa=0;qa<oa.length;qa++){var ra=oa[qa],sa=s.tokenize(ra),ta=sa.type,ua=sa.value;if(ta=='user'){var va=s.getParticipantIDFromUserID(ua);this.createNewLocalThread(ra,va===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,va]);}else pa.push(ra);}if(pa.length)this.$MercuryThreads2.fetchThreadData(pa,ma);}return na;};ia.addListener=function(ka,la){return ga.addListener(ka,la);};ia.prototype.unsubscribe=function(ka){this.$MercuryThreads7.unsubscribe(ka);};ia.prototype.getCanonicalThreadToParticipant=function(ka,la,ma,na){var oa=s.getThreadIDFromParticipantID(ka),pa=this.$MercuryThreads7.getResource(oa);if(typeof pa=='undefined'){pa=this.createNewLocalThread(oa,this.$MercuryThreads4===ka?[this.$MercuryThreads4]:[this.$MercuryThreads4,ka],la);!na&&this.$MercuryThreads2.fetchThreadData([oa],ma);}return pa;};ia.prototype.createNewLocalThread=function(ka,la,ma){var na=this.$MercuryThreads7.getResource(ka);if(!na){var oa=s.tokenize(ka),pa=oa.type,qa=oa.value;na=new i({thread_id:ka,last_action_id:null,participants:Array.from(la),name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ma?ma:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,other_user_fbid:pa==='user'?qa:null,is_canonical_user:pa=='user',is_canonical:this.$MercuryThreads14(la),is_subscribed:true,root_message_threading_id:null,folder:aa.INBOX,is_archived:false});this.$MercuryThreads7.setResource(ka,na);}return na;};ia.prototype.isEmptyLocalThread=function(ka){var la=this.$MercuryThreads7.getResource(ka);if(!la)return false;return y.isEmptyLocalThread(la);};ia.prototype.isNewEmptyLocalThread=function(ka){var la=this.$MercuryThreads7.getResource(ka);if(!la)return false;return y.isNewEmptyLocalThread(la);};ia.prototype.$MercuryThreads15=function(ka,la){if(!ka||!ka.length)return;var ma=new l(),na=new l(),oa=new l(),pa=[];for(var qa=0;qa<ka.length;qa++){var ra=ka[qa];if(ra.is_forward)continue;var sa=ra.action_type;if(sa==m.LOG_MESSAGE&&ra.log_message_type==t.SERVER_ERROR)continue;var ta=!!(ra.sync_id||ra.action_id),ua=ra.thread_id;n.isThreadID(ua);var va=this.$MercuryThreads7.getResource(ua);if(!va&&!ta&&sa==m.USER_GENERATED_MESSAGE){va=this.$MercuryThreads16(ra);this.$MercuryThreads7.setResource(ua,va);}if(!va)continue;if(sa==m.LOG_MESSAGE||sa==m.USER_GENERATED_MESSAGE)ta=!la;if(va.server_timestamp&&ra.timestamp<=va.server_timestamp&&ta)continue;if(!oa.has(ua))oa.set(ua,babelHelpers._extends({},va));this.$MercuryThreads17(oa.get(ua),ra,la);if(sa==m.USER_GENERATED_MESSAGE)ma.set(ua,ra);if(sa==m.USER_GENERATED_MESSAGE||sa==m.LOG_MESSAGE||sa==m.SEND_MESSAGE)if(ra&&ra.timestamp&&(!na.has(ua)||ra.timestamp>na.get(ua).timestamp))na.set(ua,ra);}oa.forEach((function(wa,xa){var ya=na.get(xa),za=ma.get(xa);if(za){this.$MercuryThreads18(wa,za);}else if(ya&&(ya.log_message_type==t.PHONE_CALL||ya.log_message_type==t.VIDEO_CALL)){var ab=babelHelpers._extends({},ya,{body:ya.log_message_body});this.$MercuryThreads18(wa,ab);}var bb=wa.timestamp;if(ya){if(ya.timestamp>bb)Object.assign(wa,{timestamp_absolute:ya.timestamp_absolute,timestamp_relative:ya.timestamp_relative,timestamp:ya.timestamp});var cb=wa.server_timestamp;if(!la&&ya.timestamp>cb)wa.server_timestamp=ya.timestamp;}var db=new i(wa);this.$MercuryThreads7.setResource(xa,db);pa.push(u.obfuscateThread(db));}).bind(this),this);pa.length&&this.$MercuryThreads6&&ha.debug('threads_updated',{threads:pa});};ia.prototype.$MercuryThreads17=function(ka,la,ma){var na=la.action_type;if(na==m.USER_GENERATED_MESSAGE||na==m.LOG_MESSAGE){la.is_unread&&ka.unread_count++;ka.message_count++;ka.is_archived=false;}switch(na){case m.DELETE_THREAD:ka.message_count=0;this.$MercuryThreads19(la.thread_id);break;case m.USER_GENERATED_MESSAGE:if(ka.last_read_timestamp>=la.timestamp)this.$MercuryThreads20(ka,la,true);if(la.offline_threading_id!==la.message_id){ka.last_message_id=la.message_id;ka.last_message_timestamp=la.timestamp;}this.$MercuryThreads21(ka,la.author);break;case m.SEND_MESSAGE:var oa=la.log_message_type;if(oa==t.THREAD_IMAGE){ka.image_src=la.log_message_data.image?la.log_message_data.image.preview_url:null;this.$MercuryThreads22(la.thread_id);}if(oa!==t.SUBSCRIBE&&oa!==t.UNSUBSCRIBE)ka.snippet_attachments=la.attachments;break;case m.LOG_MESSAGE:var oa=la.log_message_type;if(oa==t.SUBSCRIBE){this.$MercuryThreads23(ka,la.log_message_data.added_participants);this.$MercuryThreads22(la.thread_id);}else if(oa==t.UNSUBSCRIBE){this.$MercuryThreads24(ka,la.log_message_data.removed_participants);this.$MercuryThreads22(la.thread_id);}else if(oa==t.THREAD_IMAGE){if(!ma)ka.image_src=la.log_message_data.image?la.log_message_data.image.preview_url:null;}else if(oa==t.THREAD_NAME){if(ka.name!==la.log_message_data.name)this.$MercuryThreads22(la.thread_id);ka.name=la.log_message_data.name;}else if(oa==t.GENERIC_ADMIN_TEXT)if(this.$MercuryThreads25(ka,la))this.$MercuryThreads22(la.thread_id);break;case m.CHANGE_READ_STATUS:var pa=this.$MercuryThreads20(ka,la,la.mark_as_read);if(pa)ka.last_read_timestamp=ka.last_message_timestamp;var qa=!ka.read_only&&ka.folder===aa.INBOX;if(pa&&ma)this.$MercuryThreads2.changeThreadReadStatus(ka.thread_id,la.mark_as_read,la.source,ka.last_read_timestamp,ka.titan_originated_thread_id,qa);break;case m.CHANGE_ARCHIVED_STATUS:if(ka.is_archived!=la.archived){ka.is_archived=la.archived;this.$MercuryThreads22(la.thread_id);}break;case m.CHANGE_FOLDER:if(ka.folder!=la.new_folder){ka.folder=la.new_folder;this.$MercuryThreads22(la.thread_id);}break;case m.DELETE_MESSAGES:if(ma){ka.snippet='...';ka.snippet_has_attachment=false;ka.snippet_attachments=null;ka.snippet_sender=null;this.$MercuryThreads22(la.thread_id);}else if(la.message_ids){ka.message_count-=la.message_ids.length;if(!p.MessengerGlobalDeleteGK)break;ea('MercuryMessages',(function(ta){ta=ta.getForFBID(this.$MercuryThreads1);for(var ua=la.message_ids,va=Array.isArray(ua),wa=0,ua=va?ua:ua[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var xa;if(va){if(wa>=ua.length)break;xa=ua[wa++];}else{wa=ua.next();if(wa.done)break;xa=wa.value;}var ya=xa,za=ta.getMessagesFromIDs([ya]),ab=za[0];if(ab&&ab.timestamp>ka.last_read_timestamp)ka.unread_count=Math.max(0,ka.unread_count-1);}this.$MercuryThreads22(la.thread_id);}).bind(this),da);}break;case m.UPDATE_SNIPPET:ea('MercuryMessages',(function(ta){ta=ta.getForFBID(this.$MercuryThreads1);if(!p.MessengerGlobalDeleteGK)return;var ua=false;for(var va=la.deleted_ids,wa=Array.isArray(va),xa=0,va=wa?va:va[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ya;if(wa){if(xa>=va.length)break;ya=va[xa++];}else{xa=va.next();if(xa.done)break;ya=xa.value;}var za=ya;if(za==ka.last_message_id){ua=true;break;}}if(!ua)return;var ab=0,bb=1,cb=ta.getThreadMessagesRangeNow(la.thread_id,ab,bb),db=cb[0];if(db){ka.snippet=db.body;ka.snippet_has_attachment=db.has_attachment;ka.snippet_attachments=db.attachments;ka.snippet_sender=db.author;ka.last_message_id=ta.getServerMessageID(db.message_id);}else{ka.snippet='...';ka.snippet_has_attachment=false;ka.snippet_attachments=null;ka.snippet_sender=null;ta.getThreadMessagesRange(la.thread_id,ab,bb,(function(eb){if(eb.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:la.thread_id,action_type:m.UPDATE_SNIPPET,deleted_ids:la.deleted_ids}]});}).bind(this));}this.$MercuryThreads22(la.thread_id);}).bind(this),da);break;case m.UPDATE_BLOCKER_STATUS:ka.can_reply=!!(!la.message_blocked&&(la.is_blocked_by_recipient===undefined||!la.is_blocked_by_recipient)&&ka.is_subscribed&&!ka.has_email_participant&&!ka.read_only&&(ka.recipients_loadable||ka.recipients_loadable===undefined));this.$MercuryThreads22(la.thread_id);break;case m.UPDATE_BLOCKEE_STATUS:ka.can_reply=!!(!la.got_blocked&&ka.is_subscribed&&!ka.has_email_participant&&!ka.read_only&&(ka.recipients_loadable||ka.recipients_loadable===undefined));this.$MercuryThreads22(la.thread_id);break;case m.CHANGE_MUTE_SETTINGS:if(la.mute_settings!==undefined){var ra=this.$MercuryThreads1+'@facebook.com';if(ka.mute_settings){if(la.mute_settings){var sa={};sa[ra]=la.mute_settings;ka.mute_settings=babelHelpers._extends({},ka.mute_settings,sa);}else{ka.mute_settings=babelHelpers._extends({},ka.mute_settings);delete ka.mute_settings[ra];}this.$MercuryThreads22(ka.thread_id);}}break;case m.ADD_PARTICIPANTS:this.$MercuryThreads23(ka,la.participants);this.$MercuryThreads22(ka.thread_id);break;case m.CHANGE_FLAG:this.$MercuryThreads26(ka,la.mark_as_flag);this.$MercuryThreads22(ka.thread_id);break;case m.MOVE_PENDING_TO_INBOX:this.$MercuryThreads27(ka);this.$MercuryThreads22(ka.thread_id);break;}};ia.prototype.$MercuryThreads16=function(ka){var la=s.tokenize(ka.thread_id),ma=la.type,na=la.value,oa=this.$MercuryThreads14(ka.specific_to_list);return new i({thread_id:ka.thread_id,last_action_id:null,participants:ka.specific_to_list,name:null,snippet:ka.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ka.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:ka.timestamp_absolute,timestamp_relative:ka.timestamp_relative,timestamp:ka.timestamp,other_user_fbid:ma==='user'?na:null,is_canonical_user:ma==='user',is_canonical:oa,is_subscribed:true,root_message_threading_id:ka.message_id,folder:aa.INBOX,is_archived:false});};ia.prototype.$MercuryThreads20=function(ka,la,ma){if(la.timestamp)this.$MercuryThreads28(ka.thread_id,ma,la.timestamp);if(!ka||!ka.thread_id)return false;if(!ka.timestamp){this.$MercuryThreads8.add(ka.thread_id);return false;}var na=!ka.unread_count;if(ma==na)return false;ka.unread_count=ma?0:1;this.$MercuryThreads22(ka.thread_id);return true;};ia.prototype.$MercuryThreads29=function(ka){var la=this.$MercuryThreads7.getAllResources();for(var ma in la)if(la.hasOwnProperty(ma)){var na=la[ma];if(na.folder==ka){this.$MercuryThreads7.setResource(ma,i.setProperty(na,'unread_count',0));this.$MercuryThreads22(ma);}}};ia.prototype.$MercuryThreads23=function(ka,la){var ma=new ca(ka.participants);ka.participants=Array.from(ka.participants);la.forEach((function(na){if(!ma.has(na)){ka.participants.push(na);if(na===this.$MercuryThreads4){ka.is_subscribed=true;ka.can_reply=true;}}}).bind(this));};ia.prototype.$MercuryThreads25=function(ka,la){if(la.log_message_data&&la.log_message_data.untypedData){var ma=la.log_message_data.untypedData.ttl;if(ma!==null&&ka.ephemeral_ttl_mode!==ma){ka.ephemeral_ttl_mode=ma;return true;}}return false;};ia.prototype.$MercuryThreads24=function(ka,la){var ma=new ca(la);ka.participants=ka.participants.filter(function(na){return !ma.has(na);});if(ma.has(this.$MercuryThreads4))ka.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([ka.thread_id]);};ia.prototype.$MercuryThreads21=function(ka,la){if(ka.participants[0]!=la){ka.participants=ka.participants.filter(function(ma){return ma!=la;});ka.participants.unshift(la);}};ia.prototype.$MercuryThreads18=function(ka,la){var ma=la.body,na=la.subject,oa='';if(na){na=na.toLowerCase();if(ma.slice(0,na.length).toLowerCase()==na){oa=ma;}else if(ma){oa=na+' \u00B7 '+ma;}else oa=na;}else oa=ma;if(la.is_filtered_content)oa=ba.renderFilteredContent(la);ka.snippet=oa;ka.snippet_has_attachment=la.has_attachment;if(la.raw_attachments&&la.raw_attachments.length>0){var pa=o.convertRaw(la.raw_attachments);ka.snippet_attachments=pa;}else ka.snippet_attachments=la.attachments;ka.snippet_sender=la.author;};ia.prototype.$MercuryThreads26=function(ka,la){ka.page_thread_info=babelHelpers._extends({},ka.page_thread_info,{flagged:la});};ia.prototype.$MercuryThreads27=function(ka){if(ka.folder!==aa.PENDING)return;ka.folder=aa.INBOX;};ia.prototype.$MercuryThreads14=function(ka){return ka.filter((function(la){return la!=this.$MercuryThreads4;}).bind(this)).length<=1;};ia.prototype.$MercuryThreads12=function(){this.$MercuryThreads5.subscribe('update-threads',(function(ka,la){var ma=(la.actions||[]).filter(function(na){return na.thread_id;});if(la.threads&&la.payload_source==v.SERVER_FETCH_THREAD_INFO)la.threads.forEach((function(na){var oa=na.thread_id;if(this.$MercuryThreads8.has(oa)){this.$MercuryThreads8['delete'](oa);if(na.unread_count)this.$MercuryThreads2.changeThreadReadStatus(na.thread_id,true);}}).bind(this));this.$MercuryThreads30(la.threads);this.$MercuryThreads15(ma,la.from_client);la.threads&&la.threads.forEach((function(na){this.$MercuryThreads22(na.thread_id);}).bind(this));if(la.global_actions)la.global_actions.forEach((function(na){if(na.action_type==r.MARK_ALL_READ)this.$MercuryThreads29(na.folder);}).bind(this));if(this.$MercuryThreads6){this.$MercuryThreads6=false;ga.emit('change');}}).bind(this));};ia.prototype.$MercuryThreads30=function(ka){if(!ka||!ka.length)return;var la={},ma=[];ka.forEach(function(na){var oa=new i(na);la[na.thread_id]=oa;ma.push(u.obfuscateThread(oa));});ma.length&&ha.debug('threads_added',{threads:ma});this.$MercuryThreads7.addResourcesAndExecute(la);};ia.prototype.$MercuryThreads22=function(ka){this.$MercuryThreads6=true;this.$MercuryThreads3.updatedThread(ka);};ia.prototype.$MercuryThreads19=function(ka){this.$MercuryThreads6=true;this.$MercuryThreads3.deletedThread(ka);};ia.prototype.$MercuryThreads28=function(ka,la,ma){this.$MercuryThreads6=true;this.$MercuryThreads3.changedThreadReadState(ka,la,ma);};var ja=new x(ia);f.exports=ia;},null);
__d('MercuryMessageObject',['MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonMixin','MercurySourceType','MercuryThreads','MercuryTimePassed','MercurySendMessageFields','fbt','formatDate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();function u(x){'use strict';this.$MercuryMessageObject1=x;this.$MercuryMessageObject2=p.getForFBID(x);}u.prototype.constructUserGeneratedMessageObject=function(x,y,z,aa,ba){'use strict';var ca=v(this.$MercuryMessageObject1,i.USER_GENERATED_MESSAGE,y,z);if(typeof x=='string')x=x.replace(/^\s+/,'').replace(/\s+$/,'');ca.body=x;ca.has_attachment=false;ca.html_body=false;ca.attachments=[];ca.specific_to_list=aa||[];ca.creator_info=ba;return ca;};u.prototype.constructStickerMessageObject=function(x,y,z){'use strict';var aa=v(this.$MercuryMessageObject1,i.USER_GENERATED_MESSAGE,y,z);aa.has_attachment=true;aa.html_body=false;aa.attachments=[];aa.sticker_id=x;aa.specific_to_list=[];return aa;};u.prototype.constructAttachmentMessageObject=function(x,y){'use strict';var z=v(this.$MercuryMessageObject1,i.USER_GENERATED_MESSAGE,x,y);z.attachments=[];z.specific_to_list=[];return z;};u.prototype.constructLogMessageObject=function(x,y,z,aa){'use strict';var ba=v(this.$MercuryMessageObject1,i.LOG_MESSAGE,x,y);ba.log_message_type=z;ba.log_message_data=aa;return ba;};u.prototype.normalizeNewMessage=function(x){'use strict';if(x.status===undefined)x.status=h.UNSENT;x.timestamp_absolute=s._("Today");x.offline_threading_id=x.offline_threading_id||k.generateOfflineThreadingID(x.timestamp);x.message_id=x.message_id||x.offline_threading_id;var y=j.getParticipantIDFromUserID(this.$MercuryMessageObject1);x.specific_to_list=x.specific_to_list||[];if(x.specific_to_list.length&&x.specific_to_list.indexOf(y)===-1)x.specific_to_list.push(y);if(!x.thread_id){x.thread_id='root:'+x.offline_threading_id;}else{var z=this.$MercuryMessageObject2.getThreadMetaNow(x.thread_id);if(z&&z.ephemeral_ttl_mode)x.ephemeral_ttl_mode=z.ephemeral_ttl_mode;}if(x.specific_to_list.length==1){x.thread_id='user:'+this.$MercuryMessageObject1;}else if(x.specific_to_list.length==2){var aa=x.specific_to_list[0]==y?x.specific_to_list[1]:x.specific_to_list[0];x.thread_id=j.getThreadIDFromParticipantID(aa);}if(!x.specific_to_list.length){var ba=j.tokenize(x.thread_id),ca=ba.type,da=ba.value;if(ca=='user')x.specific_to_list=['fbid:'+da,y];}if(!x[r.MANUAL_RETRY_CNT])x[r.MANUAL_RETRY_CNT]=0;};u.prototype.normalizeResendMessage=function(x){'use strict';x.status=h.RESENDING;x.timestamp=Date.now();x[r.MANUAL_RETRY_CNT]+=1;};u.prototype.normalizeAddAttachmentPlaceholder=function(x,y,z){'use strict';if(z.preview_attachments.length>0){x.has_attachment=true;x.preview_attachments=z.preview_attachments;}x.client_state=l.DO_NOT_SEND_TO_SERVER;x.status=h.RESENDING;x.upload_id=y;};function v(x,y,z,aa){var ba=w(z)?[m.CHAT]:[],ca=Date.now(),da=t(new Date(ca),'g:ia'),ea={action_type:y,thread_id:aa,author:j.getParticipantIDFromUserID(x),author_email:null,timestamp:ca,timestamp_absolute:new Date(ca).toLocaleDateString(),timestamp_relative:da,timestamp_time_passed:q.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:z,source_tags:ba};return ea;}function w(x){switch(x){case o.CHAT_WEB:case o.CHAT_JABBER:case o.CHAT_IPHONE:case o.CHAT_MEEBO:case o.CHAT_ORCA:case o.CHAT_TEST:case o.CHAT:case o.DESKTOP:return true;default:return false;}}Object.assign(u,n);f.exports=u;},null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';function n(o){this.$MercuryMessageActions1=o;this.$MercuryMessageActions2=j.getForFBID(this.$MercuryMessageActions1);this.__serverRequests=l.getForFBID(this.$MercuryMessageActions1);this.__dispatcher=i.getForFBID(this.$MercuryMessageActions1);}n.prototype.send=function(o,p,q){p=p||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(o);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},o),k.CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(o,q);p(o.thread_id);};n.prototype.resend=function(o,p){var q=babelHelpers._extends({},o);this.$MercuryMessageActions2.normalizeResendMessage(q);this.send(q,undefined,p);};n.prototype.addAttachmentPlaceholder=function(o,p,q){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(o,p,q);this.$MercuryMessageActions2.normalizeNewMessage(o);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers._extends({},o),k.CLIENT_SEND_MESSAGE));};n.prototype.cancelAttachmentPlaceholder=function(o,p){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:o,upload_data:p,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},k.CLIENT_SEND_MESSAGE));};n.prototype.confirmAttachmentPlaceholder=function(o,p){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:o,upload_data:p,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},k.CLIENT_SEND_MESSAGE));};n.prototype['delete']=function(o,p,q){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(o,p,h.DELETE_MESSAGES,q||k.CLIENT_DELETE_MESSAGES));};n.prototype.__constructClientSingleMessagePayload=function(o,p){return {actions:[o],from_client:true,payload_source:p};};n.prototype.$MercuryMessageActions4=function(o,p){return {actions:[o],from_client:false,payload_source:p};};n.prototype.$MercuryMessageActions3=function(o,p,q,r){return {actions:[{action_type:q,action_id:null,thread_id:o,message_ids:p}],from_client:true,payload_source:r};};Object.assign(n,m);f.exports=n;},null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j='fbid:'+h.getID(),k={getID:function(){return j;},isViewer:function(l){i.isParticipantID(l);return l===j;}};f.exports=k;},null);
__d("XNFXMessengerBlockActionController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});},null,{});
__d("XMessengerNotificationsSettingsDialogController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/notifications\/settings\/dialog\/",{thread_key_id:{type:"String",required:true},modify:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}});},null,{});
__d('MercuryThreadActions',['AsyncDialog','AsyncRequest','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryViewer','MessagingTag','XNFXMessengerBlockActionController','URI','MercuryAssert','XMessengerNotificationsSettingsDialogController','MercuryMessageActions','MercuryMessageObject','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();'use strict';var z=c('MercuryMessageActions').get(),aa=c('MercuryMessageObject').get(),ba=c('MercuryThreads').get();function ca(da){this.$MercuryThreadActions1=da;this.__serverRequests=q.getForFBID(this.$MercuryThreadActions1);this.__dispatcher=l.getForFBID(this.$MercuryThreadActions1);}ca.prototype.markRead=function(da,ea){this.batchMarkRead([da],ea);};ca.prototype.batchMarkRead=function(da,ea){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(da,true,ea));};ca.prototype.markUnread=function(da,ea){this.batchMarkUnread([da],ea);};ca.prototype.batchMarkUnread=function(da,ea){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(da,false,ea));};ca.prototype.markSeen=function(da,ea){this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.MARK_THREAD_SEEN,p.CLIENT_MARK_THREAD_SEEN,{persistent:ea}));};ca.prototype.archive=function(da,ea){this.batchArchive([da],ea);};ca.prototype.batchArchive=function(da,ea){da.forEach((function(fa){this.__serverRequests.changeThreadArchivedStatus(fa,true,ea);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(da,true));};ca.prototype.unarchive=function(da,ea){this.batchUnarchive([da],ea);};ca.prototype.batchUnarchive=function(da,ea){da.forEach((function(fa){this.__serverRequests.changeThreadArchivedStatus(fa,false,ea);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(da,false));};ca.prototype.markSpam=function(da,ea){this.batchMarkSpam([da],ea);};ca.prototype.batchMarkSpam=function(da,ea){da.forEach((function(fa){this.__serverRequests.markThreadSpam(fa,ea);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(da,u.SPAM));};ca.prototype.unmarkSpam=function(da,ea){this.batchUnmarkSpam([da],ea);};ca.prototype.batchUnmarkSpam=function(da,ea){da.forEach((function(fa){this.__serverRequests.unmarkThreadSpam(fa,ea);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(da,u.INBOX));};ca.prototype.changeFolder=function(da,ea){this.batchChangeFolder([da],ea);};ca.prototype.batchChangeFolder=function(da,ea){da.forEach((function(fa){this.__serverRequests.changeThreadFolder(fa,ea);}).bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(da,ea));};ca.prototype['delete']=function(da,ea){this.batchDelete([da],ea);};ca.prototype.batchDelete=function(da,ea){da.forEach((function(fa){this.__serverRequests.deleteThread(fa,ea);}).bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(da,j.DELETE_THREAD,p.CLIENT_DELETE_THREAD));};ca.prototype.openNotificationSettings=function(da){x.isThreadID(da);this.__serverRequests.__threadIDMap.getServerIDFromClientID(da,function(ea){var fa=y.getURIBuilder().setString('thread_key_id',ea).setBool('modify',false).getURI();new i().setURI(fa).send();});};ca.prototype.unmute=function(da){this.updateMuteSetting(da,0);};ca.prototype.updateMuteSetting=function(da,ea){this.__serverRequests.changeMutingOnThread(da,ea);this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.CHANGE_MUTE_SETTINGS,p.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:ea}));};ca.prototype.blockMessages=function(da){var ea=v.getURIBuilder().setInt('thread_fbid',m.getUserIDFromThreadID(da)).setEnum('location','www_chat_head').getURI();h.send(new i(ea));};ca.prototype.unblockMessages=function(da){var ea=JSON.stringify({reportable_ent_token:m.getUserIDFromThreadID(da),initial_action_name:o.block_messages});new i(new w('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:ea})).send();};ca.prototype.leaveGroup=function(da){if(!ba.isEmptyLocalThread(da))z.send(aa.constructLogMessageObject(s.TITAN_WEB,da,n.UNSUBSCRIBE,{removed_participants:[t.getID()]}),null,k.WEBMESSENGER);};ca.prototype.addParticipants=function(da,ea){this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.ADD_PARTICIPANTS,p.CLIENT_ADD_PARTICIPANTS,{participants:ea}));};ca.prototype.unpinThread=function(da){this.__serverRequests.unpinThread(da);this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.UNPIN_THREAD,p.CLIENT_UNPIN_THREAD));};ca.prototype.movePendingToInbox=function(da){this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.MOVE_PENDING_TO_INBOX,p.CLIENT_MOVE_PENDING_TO_INBOX));};ca.prototype.updateSnippet=function(da,ea){this.__dispatcher.handleUpdate(this.__constructClientPayload([da],j.UPDATE_SNIPPET,p.CLIENT_UPDATE_SNIPPET,{deleted_ids:ea}));};ca.prototype.$MercuryThreadActions2=function(da,ea,fa){return this.__constructClientPayload(da,j.CHANGE_READ_STATUS,p.CLIENT_CHANGE_READ_STATUS,{mark_as_read:ea,source:fa});};ca.prototype.$MercuryThreadActions3=function(da,ea){return this.__constructClientPayload(da,j.CHANGE_ARCHIVED_STATUS,p.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:ea});};ca.prototype.$MercuryThreadActions4=function(da,ea){return this.__constructClientPayload(da,j.CHANGE_FOLDER,p.CLIENT_CHANGE_FOLDER,{new_folder:ea});};ca.prototype.__constructClientPayload=function(da,ea,fa,ga){return {actions:da.map(function(ha){return babelHelpers._extends({action_type:ea,action_id:null,thread_id:ha},ga);}),from_client:true,payload_source:fa};};Object.assign(ca,r);f.exports=ca;},null);
__d('ChatWelcomeMessage',['ImmutableObject'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';function i(){this.$ChatWelcomeMessage1={};}i.prototype.setWelcomeMessage=function(k,l,m){this.$ChatWelcomeMessage1[k]=new h({timestamp:Date.now(),thread_id:k,author:l,body:m});};i.prototype.getWelcomeMessage=function(k){return this.$ChatWelcomeMessage1[k];};var j=new i();f.exports=j;},null);
__d('WebMessengerPermalinkConstants',['MercuryConfig','URI'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',PENDING_PATH:'/messages/pending',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:h.CoreGraphEnabled?'(archived|other|pending|spam|new|search|conversation-.*)':'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(k,l){return (l||j.BASE_PATH)+j.TID_POSTFIX_PARTIAL_PATH+i.encodeComponent(i.encodeComponent(k));},getThreadIDFromURI:function(k){var l=k.getPath().match(j.BASE_PATH+'(/[^/]*)*'+j.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(l){var m=i.decodeComponent(i.decodeComponent(l[2]));return m;}},getURIPathForIDOrVanity:function(k,l){if(k.match('^'+j.overriddenVanities+'$'))k='.'+k;return (l||j.BASE_PATH)+'/'+k;},getUserIDOrVanity:function(k){var l=k.match(j.BASE_PATH+'.*/([^/]+)/?$'),m=l&&l[1],n=j.overriddenVanities;if(!m||m.match('^'+n+'$')){return false;}else if(m.match('^\\.'+n+'$')){return m.substr(1);}else return m;}};f.exports=j;},null);
__d('ChatTypeaheadConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',HEADER_TYPE:'header'};f.exports=h;},null);
__d('ChatOpenTab',['BusinessURI.brands','GroupChatMessageBlockAlert','MercuryThreads','Event','requireWeak','ChatWelcomeMessage','ContextualThing','DOM','csx','cx','MercuryIDs','Parent','curry','MercuryBlockedParticipants','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=c('MercuryBlockedParticipants').get(),v=c('MercuryThreadActions').get(),w=null;l('ChatApp',function(fa){return w=fa;});var x=null;l('ChatTabModel',function(fa){return x=fa;});var y='messaging_tracking';function z(){e(['Toggler'],function(fa){var ga=o.scry(document,"div._1z4y")[0],ha=fa.getInstance(ga);if(ha&&ha.getActive()&&ha.getActive()===ga)ha.hide();});}function aa(fa,ga,ha){e(['LogHistory','WebMessengerPermalinkConstants','goURI'],function(ia,ja,ka){j.get().getThreadMeta(fa,function(la){if(w&&w.isInitialized()){w.tabController.openTab(fa,w.tabsViewport,ga,ha);}else ka(h(ja.getURIPathForThreadID(fa)));if(!ea.canOpenTab())ia.getInstance('mercury').error('Unable to open chat tab',la);});});}function ba(fa,ga,ha,ia){k.listen(fa,'click',function(ja){if(ea.canOpenTab()){ia(ga,ha);return ja.kill();}});}function ca(fa,ga,ha,ia){var ja={referrer:fa||'',message_thread_id:ga,message_view:'chat',timestamp_send:Date.now()};if(ha!==undefined)ja.message_target_ids=[ha];e(['ChatImpressionLogger'],function(la){la.logImpression(fa,ha,ia);});e(['Banzai'],function(la){la.post(y,ja,{delay:0,retry:true});});var ka=r.getUserIDFromThreadID(String(ga));e(['Banzai'],function(la){la.post('page_message_button_click',{page_id:ka,ref:fa});});}function da(fa){var ga=n.getContext(fa);return ga&&s.byClass(ga,"_3qw")!==null;}var ea={canOpenTab:function(){return w&&!w.isHidden();},openEmptyTab:function(fa,ga,ha){if(ea.canOpenTab()&&x){var ia=x.getEmptyTab();aa(ia);ca(ga,ia,null,ha);z();return ia;}return null;},listenOpenEmptyTab:function(fa,ga){ba(fa,null,ga,ea.openEmptyTab);},openThread:function(fa,ga,ha,ia,ja){e(['MercuryThreadIDMap'],function(ka){if(!r.isValid(fa)){ka.get().getClientIDFromServerID(fa,function(la){ea.openThreadImpl(la,ga,ha,ia,ja);});}else ea.openThreadImpl(fa,ga,ha,ia,ja);});},openThreadImpl:function(fa,ga,ha,ia,ja){j.get().getThreadMeta(fa,function(ka){if(u.isPresentInGroupThread(ka)){i.show(u.inGroupThread(ka),function(){ea.openClientTab(fa,ga,ha,ia,ja);},function(){v.leaveGroup(fa);});}else ea.openClientTab(fa,ga,ha,ia,ja);});},openClientTab:function(fa,ga,ha,ia,ja){aa(fa,ia,ja);ca(ga,fa,null,ha);z();},listenOpenThread:function(fa,ga,ha){ba(fa,ga,ha,ea.openThread);},openUserTab:function(fa,ga,ha){var ia=r.getThreadIDFromUserID(fa);aa(ia);ca(ga,ia,fa,ha);return true;},openPageTab:function(fa,ga,ha){var ia=r.getThreadIDFromUserID(ga);j.get().getThreadMeta(ia,function(ja){if(fa&&fa.length>0){var ka=(Date.now()-ja.timestamp)/1000,la=ka/3600;if(ja.message_count===0||la>24)m.setWelcomeMessage(ia,r.getParticipantIDFromUserID(ga),fa);}});aa(ia);ca(ha,ia,ga);return true;},listenOpenUserTab:function(fa,ga,ha){if(!da(fa))ba(fa,ga,ha,ea.openUserTab);},listenOpenPageTab:function(fa,ga,ha,ia){if(!da(fa))ba(fa,ga,ia,t(ea.openPageTab,ha));},openTabByType:function(fa,ga,ha){e(['ChatTypeaheadConstants','MercuryParticipantTypes'],function(ia,ja){if(ga===ia.THREAD_TYPE){if(fa){ea.openThread(fa,ha);}else ea.openEmptyTab(null,ha);}else if(!ga||ga===ja.FRIEND||ga===ia.FRIEND_TYPE||ga===ia.PAGE_TYPE||ga===ia.USER_TYPE)ea.openUserTab(fa,ha);});}};f.exports=ea;},null);
__d("arrayStableSort",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){return i.map(function(k,l){return {data:k,index:l};}).sort(function(k,l){return j(k.data,l.data)||k.index-l.index;}).map(function(k){return k.data;});}f.exports=h;},null);
__d('RangedCallbackManager',['CallbackManagerController','arrayStableSort','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l,m,n){'use strict';this.$RangedCallbackManager1=[];this.$RangedCallbackManager2=false;this.$RangedCallbackManager3=false;this.$RangedCallbackManager4={};this.$RangedCallbackManager5=new h(this.$RangedCallbackManager6.bind(this));this.$RangedCallbackManager7=l;this.$RangedCallbackManager8=m;this.$RangedCallbackManager9=n;}k.prototype.executeOrEnqueue=function(l,m,n,o,p){'use strict';return this.$RangedCallbackManager5.executeOrEnqueue({start:l,limit:m},n,{strict:!!o,skipOnStrictHandler:p});};k.prototype.unsubscribe=function(l){'use strict';this.$RangedCallbackManager5.unsubscribe(l);};k.prototype.getUnavailableResources=function(l){'use strict';var m=this.$RangedCallbackManager5.getRequest(l),n=[];if(m&&!this.$RangedCallbackManager2){var o=m.request,p=this.$RangedCallbackManager10(m.options),q=o.start+o.limit;for(var r=p.length;r<q;r++)n.push(r);}return n;};k.prototype.addResources=function(l){'use strict';l.forEach((function(m){if(!this.$RangedCallbackManager4[m]){this.$RangedCallbackManager4[m]=true;this.$RangedCallbackManager1.push(m);this.$RangedCallbackManager3=null;}}).bind(this));this.resortResources();this.$RangedCallbackManager5.runPossibleCallbacks();};k.prototype.addResourcesWithoutSorting=function(l,m){'use strict';var n=this.$RangedCallbackManager1.slice(0,m);n=n.concat(l);n=n.concat(this.$RangedCallbackManager1.slice(m));this.$RangedCallbackManager1=n;Object.assign(this.$RangedCallbackManager4,j(l,true));this.$RangedCallbackManager3=null;this.$RangedCallbackManager5.runPossibleCallbacks();};k.prototype.removeResources=function(l){'use strict';l.forEach((function(m){if(this.$RangedCallbackManager4[m]){this.$RangedCallbackManager4[m]=false;var n=this.$RangedCallbackManager1.indexOf(m);if(n!=-1)this.$RangedCallbackManager1.splice(n,1);}}).bind(this));};k.prototype.removeAllResources=function(){'use strict';this.$RangedCallbackManager1=[];this.$RangedCallbackManager4={};};k.prototype.resortResources=function(){'use strict';this.$RangedCallbackManager1=i(this.$RangedCallbackManager1,(function(l,m){return (this.$RangedCallbackManager8(this.$RangedCallbackManager7(l),this.$RangedCallbackManager7(m)));}).bind(this));};k.prototype.setReachedEndOfArray=function(){'use strict';if(!this.$RangedCallbackManager2){this.$RangedCallbackManager2=true;this.$RangedCallbackManager3=null;this.$RangedCallbackManager5.runPossibleCallbacks();}};k.prototype.hasReachedEndOfArray=function(){'use strict';return this.$RangedCallbackManager2;};k.prototype.setError=function(l){'use strict';if(this.$RangedCallbackManager3!==l){this.$RangedCallbackManager3=l;this.$RangedCallbackManager5.runPossibleCallbacks();}};k.prototype.getError=function(l,m,n){'use strict';var o=this.$RangedCallbackManager10({strict:n});return l+m>o.length?this.$RangedCallbackManager3:null;};k.prototype.hasResource=function(l){'use strict';return this.$RangedCallbackManager4[l];};k.prototype.getResourceAtIndex=function(l){'use strict';return this.$RangedCallbackManager1[l];};k.prototype.getAllResources=function(){'use strict';return this.$RangedCallbackManager1.concat();};k.prototype.getCurrentArraySize=function(l){'use strict';return this.$RangedCallbackManager10(l).length;};k.prototype.$RangedCallbackManager10=function(l){'use strict';var m=this.$RangedCallbackManager1;if(l&&l.strict){var n=l.skipOnStrictHandler||this.$RangedCallbackManager9;if(n)m=m.filter(n);}return m;};k.prototype.$RangedCallbackManager6=function(l,m){'use strict';var n=this.$RangedCallbackManager10(m);if(!this.$RangedCallbackManager2&&!this.$RangedCallbackManager3&&l.start+l.limit>n.length){return false;}else{var o=n.slice(l.start,l.start+l.limit),p=l.start+l.limit>n.length?this.$RangedCallbackManager3:null;return [o,p];}};k.prototype.getElementsUntil=function(l){'use strict';var m=[];for(var n=0;n<this.$RangedCallbackManager1.length;n++){var o=this.$RangedCallbackManager7(this.$RangedCallbackManager1[n]);if(this.$RangedCallbackManager8(o,l)>0)break;m.push(this.$RangedCallbackManager1[n]);}return m;};f.exports=k;},null);
__d('MercuryFolders',['MercuryConfig','MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=[i.INBOX,i.OTHER,i.ACTION_ARCHIVED,i.SPAM],l=[i.INBOX,i.PENDING,i.OTHER,i.ACTION_ARCHIVED],m={getSupportedFolders:function(){return h.CoreGraphEnabled?l.concat():k.concat();},isSupportedFolder:function(n){return j(k,n);},getFromMeta:function(n){var o=n.folder;if(n.is_archived)o=i.ACTION_ARCHIVED;return o;}};f.exports=m;},null);
__d('MercuryUnreadState',['MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonMixin','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=(h.getSupportedFolders()||[]).filter(function(oa){return oa!=q.ACTION_ARCHIVED;}),x='unread_thread_hash',y='unseen_thread_list',z=o.MAX_UNREAD_COUNT,aa=i.getInstance('mercury_unread_state');function ba(oa){this._fbid=oa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};w.forEach((function(pa){this._initialUnreadCount[pa]=0;this._maxCount[pa]=false;this._unreadResources[pa]=new j();}).bind(this));this._dispatcher.subscribe('update-unread',(function(pa,qa){ga(this,qa);var ra=qa.global_actions||[];for(var sa=0;sa<ra.length;sa++){var ta=ra[sa];if(ta.action_type==m.MARK_ALL_READ)ja(this,ta.folder,ta.timestamp);}}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(pa,qa){la(this,qa);}).bind(this));}Object.assign(ba.prototype,{getUnreadCount:function(oa){if(this.exceedsMaxCount(oa)){aa.error('unguarded_unread_count_fetch',{});return 0;}return fa(this,oa);},exceedsMaxCount:function(oa){return this._maxCount[oa]||fa(this,oa)>z;},markFolderAsRead:function(oa){if(this._maxCount[oa]||fa(this,oa)>0)this._serverRequests.markFolderAsRead(oa);},getIsThreadUnread:function(oa,pa){var qa=pa||q.INBOX,ra=ea(this,qa);return ra&&ra[oa];}});Object.assign(ba,n);function ca(oa,pa,qa){oa._unreadResources[pa].setResource(x,qa);oa._unreadResources[pa].setResource(y,Object.keys(qa));}function da(oa,pa,qa){var ra=oa._unreadResources[pa].executeOrEnqueue(x,qa),sa=oa._unreadResources[pa].getUnavailableResources(ra);if(sa.length)oa._serverRequests.fetchUnreadThreadIDs(pa);}function ea(oa,pa){return oa._unreadResources[pa].getResource(x);}function fa(oa,pa){var qa=oa._unreadResources[pa].getResource(y);if(qa){return qa.length;}else return oa._initialUnreadCount[pa];}function ga(oa,pa){var qa;(pa.unread_thread_fbids||[]).forEach(function(ra){qa=ra.folder;if(!na(qa))return;var sa=ra.thread_fbids||[];sa=sa.concat(ra.other_user_fbids||[]);var ta=ka(oa,sa);ca(oa,qa,v(ta,true));if(ta.length>z)oa._maxCount[qa]=true;oa._threadInformer.updatedUnreadState();});(pa.message_counts||[]).forEach(function(ra){if(ra.unread_count===undefined)return;qa=ra.folder;if(ra.unread_count>z){oa._maxCount[qa]=true;ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}else{oa._initialUnreadCount[qa]=ra.unread_count;if(oa._initialUnreadCount[qa]===0)ca(oa,qa,{});oa._threadInformer.updatedUnreadState();}});(pa.actions||[]).forEach(function(ra){if(ra.is_forward)return;var sa=k,ta=ra.other_user_fbid?ra.other_user_fbid:ra.thread_fbid,ua=ra.thread_id?ra.thread_id:ta;if(ra.action_type==sa.DELETE_THREAD){w.forEach(function(wa){ia(oa,wa,ua);});}else if(ra.action_type==sa.CHANGE_ARCHIVED_STATUS||ra.action_type==sa.CHANGE_FOLDER){var va=oa._threads.getThreadMetaNow(ra.thread_id);qa=h.getFromMeta(va);if(na(qa)&&va.unread_count>0)ha(oa,qa,ua);w.forEach(function(wa){if(wa!=qa)ia(oa,wa,ua);});}else{qa=ma(oa,ra);if(!na(qa))return;if(ra.action_type==sa.CHANGE_READ_STATUS){if(ra.mark_as_read){ia(oa,qa,ua,ra.timestamp);}else ha(oa,qa,ua,ra.timestamp);}else if(ra.action_type==sa.USER_GENERATED_MESSAGE||ra.action_type==sa.LOG_MESSAGE)if(ra.is_unread)ha(oa,qa,ua,ra.timestamp);}});}function ha(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){var ta=oa._allReadTimestamp[pa]||0,ua=oa._threadReadTimestamp[qa]||0,va=ra||Number.POSITIVE_INFINITY;if(va>=ta&&va>=ua&&!sa[qa]){sa[qa]=ra||0;ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ia(oa,pa,qa,ra){if(oa._maxCount[pa])return;da(oa,pa,function(sa){if(ra){var ta=oa._threadReadTimestamp[qa];if(!ta||ta<ra)oa._threadReadTimestamp[qa]=ra;}var ua=sa[qa];if(ra&&typeof ua=='number'&&ra<ua)return;if(qa in sa){delete sa[qa];ca(oa,pa,sa);oa._threadInformer.updatedUnreadState();}});}function ja(oa,pa,qa){oa._maxCount[pa]=false;ca(oa,pa,{});oa._allReadTimestamp[pa]=Math.max(oa._allReadTimestamp[pa]||0,qa||0);oa._threadInformer.updatedUnreadState();}function ka(oa,pa){return pa.map(oa._threadIDMap.convertThreadIDIfAvailable,oa._threadIDMap);}function la(oa,pa){w.forEach(function(qa){var ra=ea(oa,qa);if(!ra)return;for(var sa in pa){var ta=pa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(oa,qa,ra);});}function ma(oa,pa){var qa=pa.thread_id?oa._threads.getThreadMetaNow(pa.thread_id):null;return qa?h.getFromMeta(qa):pa.folder;}function na(oa){return u(w,oa);}f.exports=ba;},null);
__d('MessagingReliabilityLogger',['PresenceUtil','MercuryServerDispatcher','MessagingReliabilityLoggerInitialData','isEmpty','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='/ajax/mercury/client_reliability.php',n=60000;function o(u,v){var w={app:j.app,categories:JSON.stringify(u)};if(!k(v))w.extra=JSON.stringify(v);return w;}function p(u,v,w,x){if(u[v]===undefined)u[v]={};if(u[v][w]===undefined)u[v][w]=0;u[v][w]+=x;}function q(u,v,w,x){if(u[v]===undefined)u[v]={};if(u[v][w]===undefined)u[v][w]=[];for(var y=0;y<x.length;++y)u[v][w].push(x[y]);}function r(u,v){if(u&&!u.categories||v&&!v.categories)return;var w=u?JSON.parse(u.categories):{},x=u&&u.extra?JSON.parse(u.extra):{},y=JSON.parse(v.categories),z=v.extra?JSON.parse(v.extra):{};for(var aa in y){var ba=y[aa],ca=z[aa];for(var da in ba){p(w,aa,da,ba[da]);if(ca!==undefined){var ea=ca[da];if(ea!==undefined)q(x,aa,da,ea);}}}return o(w,x);}var s={};s[m]={mode:i.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:r};i.registerEndpoints(s);var t={addEntry:function(u,v,w){if(!j.enabled)return;var x={};p(x,u,v,1);var y={};if(w!==undefined)q(y,u,v,[w]);i.trySend(m,o(x,y));}};(function u(){t.addEntry('page_event','active',h.getSessionID());l(u,n);})();f.exports=t;},null);