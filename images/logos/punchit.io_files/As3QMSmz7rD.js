/*!CK:1015527538!*//*1441981674,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["mkkj7"]); }

__d("FBRTCCallConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2}};},null,{});
__d("LinkshimCallsites",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={INTERNAL_WIKI:1,MZERO_UPSELL:2,EVENTS_TICKET:3,UNIT_TEST:4,WEB_RESULT:5,OG_COMMENT_NOTIF:6,M_DATA_UPSELL:7,FBURL:8,M_URI:9,THIRD_PARTY_URL:10,UI_LINK:11,LANDING_CAMPAIGN:12,STREAM_CONTENT_TICKER:13,SOCIAL_WIFI_DEPRECATED:14,TIMELINE_APP_COLLECTION:15,SAVED_LATER_VIEW_ITEM:16,REQUESTS_CONTROLLER:17,LOGIN_BUTTON:18,COMMENT_PLUGIN_REDIRECT_ENTAPP:19,COMMENT_PLUGIN_REDIRECT_APPOWNED:20,M_DEEPLINK:21,M_DEEPLINK_INVALID:22,EVENT_BUY_TICKET:23,PAGE_TYPEAHEAD:24,EGO_ACTION:25,INTERN_SURVEY:26,RETIRED_ENDPOINT:27,OG_COMMENT_FEEDBACK_TARGET:28,LIKE_COMMON_RENDERER:29,NOTIFICATIONS_LINK:30,COUPON_OFFSITE_LINK:31,MZERO_MAILTO:32,MZERO:33,MERCURY_SHARE_ATTACHMENT:34,EXTERNAL_TOKEN_SURVEY:35,FBURL_INTERN:36,LANDING_PAGE_EXPERIMENT:37,OG_FEEDBACK_TARGET:38,GAMEDAY:39,ENTISH:40,JS_ENV:41,LINKSHIM_AUTOMATION:42,HEADER_FLUSHER:43,PLUGIN_HEADER_FLUSHER:44,TASKS_APP:45,FEEDBACK_MODEL:46,JP_EMAIL_LINK:47,NOTIFICATION_REWRITE:48,OG_ACTION_PERMALINK:49,MALWARE_SCAN:50,EMAIL_LINK:51,EMAIL_ATTACHMENT:52,RENDER_EMAIL_LEGACY:53,TAGGED_WITH_STORY_EMAIL_NOTIF:54,MSG_INTRO_NOTIF:55,GROUP_COMMENT_NOTIF:56,EVENT_INVITE_LOCATION_EMAIL:57,EVENT_INVITE_MESSAGE_EMAIL:58,CLOSE_FRIEND_ACTIVITY:59,GROUP_DOC_CREATED_URL:60,GROUP_DOC_CREATED_NAME:61,MALL_POST_EMAIL_NOTIF:62,MALL_POST_SOCIAL_MSG:63,NOTIFICATION_REWRITE_RSS:64,WALL_POST_SOCIAL_MSG:65,TITAN_MSG_BODY_EMAIL:66,TITAN_MSG_BODY_SUBJECT:67,GROUP_POST_EMAIL:68,GROUP_POST_URL_EMAIL:69,GROUP_POST_PERMALINK_EMAIL:70,GROUP_POST_OPTOUT_EMAIL:71,GROUP_POST_TEXT_NOTIF:72,CLOSE_FRIEND_EMAIL_SHARE:73,PLACE_TAGGED_IN_CHECKIN:74,QUESTIONS_ANSWER_EMAIL:75,SUPPORT_TASK_COMMENT:76,INVITE_MESSAGE_EMAIL:77,GROUP_REQUEST_TO_JOIN_EMAIL:78,GROUP_POST_COMMENT_PERMALINK:79,GROUP_POST_COMMENT_OPTOUT:80,GROUP_POST_COMMENT_TEXT:81,EVENT_NAME_CHANGE_NOTIF:82,EVENT_NAME_CHANGE_OLD_NAME_NOTIF:83,EVENT_NAME_CHANGE_NEW_NAME_NOTIF:84,EVENT_CANCEL_NOTIFICATION:85,BASE_COMMENT_NOTIF:86,FBPAGE_FAN_INVITE_NAME:87,FBPAGE_FAN_INVITE_MSG:88,MESSAGING_HTML_EMAIL:89,ROLLOUT_TEXT_EMAIL:90,COMMENT_EMAIL_TEXT:91,SHARE_CONTENT_LEGACY_EMAIL:92,MZERO_UPSELL_NOTIF:93,INTERN_DEBUG:94,CALL_TO_ACTION:95,QUICK_PROMOTION_ACTION:96,COMPOSED_TEXT:97,GIF_SEARCH:98,OFFERS:99,MZERO_ATTACHMENTS:100,MZERO_UPLOADS:101,CCTA_LINK:102,M_CCTA_LINK:103,SAVED_ITEM_REDIRECT:104,ADS_PROMOTED_OBJECT:105,EMBEDS_MTOUCH_SELECT:106};},null,{});
__d("ScreenSharingWebDriverIDs",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"};},null,{});
__d('StarsInput.react',['React','TooltipLink.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.PropTypes,m=h.createClass({displayName:'StarsInput',propTypes:{allowMultipleSubmissions:l.bool,count:l.number,large:l.bool,onClick:l.func.isRequired,starLabels:l.array},getDefaultProps:function(){return {allowMultipleSubmissions:false,count:0,large:false,starLabels:[k._("Poor"),k._("Fair"),k._("Good"),k._("Very Good"),k._("Excellent")]};},getInitialState:function(){return {starRating:this.props.count,starsShown:this.props.count,canUpdate:true};},_getStarRating:function(n){return parseInt(n.split('.').pop(),10)+1;},onMouseEnter:function(event){if(this.state.canUpdate)this.setState({starsShown:this._getStarRating(event.dispatchMarker)});},onMouseLeave:function(event){if(this.state.canUpdate){var n=this.state.starRating;this.setState({starsShown:n});}},onClick:function(event){if(this.state.canUpdate){var n=this._getStarRating(event.dispatchMarker);this.setState({starRating:n,starsShown:n,canUpdate:this.props.allowMultipleSubmissions});this.props.onClick(n);}},getStars:function(){var n=this.props.starLabels.length,o=[];for(var p=0;p<n;p++)o.push(h.createElement(i,{className:"mls"+(' '+"_22mm")+(this.props.large?' '+"_1vr2":'')+(p>=this.state.starsShown?' '+"_22mn":'')+(p<this.state.starsShown?' '+"_22mo":'')+(!this.state.canUpdate?' '+"_1g87":''),tooltip:this.props.starLabels[p],onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick,position:'above',alignH:'center'}));return o;},render:function(){return (h.createElement('div',null,this.getStars()));}});f.exports=m;},null);
__d('LinkshimURI',['AsyncRequest','XLinkshimLinkAsyncController','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';var k={asyncGet:function(l,m,n){if(j(l)){n(l);return;}var o=i.getURIBuilder().setString('href',l.toString()).setEnum('callsite',m).getURI();new h(o).setHandler(function(p){var q=p.getPayload();n(q.uri);}).send();}};f.exports=k;},null);
__d('LinkshimLink.react',['Link.react','LinkshimURI','React','URI','areEqual'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();'use strict';var m=j.PropTypes,n=j.createClass({displayName:'LinkshimLink',propTypes:{uri:m.instanceOf(k).isRequired,callsite:m.number.isRequired,loadingPlaceholder:m.element},getInitialState:function(){return {shimURI:undefined};},componentWillMount:function(){this._asyncGetLinkShimURI(this.props);},componentWillReceiveProps:function(o){if(!l(this.props,o))this._asyncGetLinkShimURI(o);},_asyncGetLinkShimURI:function(o){i.asyncGet(o.uri,o.callsite,(function(p){return this.setState({shimURI:p});}).bind(this));},render:function(){if(!this.state.shimURI)return this.props.loadingPlaceholder?this.props.loadingPlaceholder:null;var o=this.props,p=o.children,q=babelHelpers.objectWithoutProperties(o,['children']);return (j.createElement(h,babelHelpers._extends({href:this.state.shimURI},q),p));}});f.exports=n;},null);
__d('MessengerProfileImageWrapper.react',['ReactComponentWithPureRenderMixin','React','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l=i.PropTypes,m=i.createClass({displayName:'MessengerProfileImageWrapper',mixins:[h],propTypes:{isMessengerUser:l.bool,showBadge:l.bool,size:l.number},render:function(){return (i.createElement('div',{className:k("_4ldz",this.props.className),style:{width:this.props.size+'px',height:this.props.size+'px'}},i.createElement('div',{className:"_4ld-",style:{width:this.props.size+'px',height:this.props.size+'px'}},this.props.children),this._renderBadge()));},_renderBadge:function(){if(!this.props.showBadge||this.props.isMessengerUser==null)return null;return (i.createElement(n,{className:"_4ld_",isMessengerUser:this.props.isMessengerUser}));}}),n=i.createClass({displayName:'MessengerBadge',mixins:[h],propTypes:{isMessengerUser:l.bool,size:l.number},render:function(){return (i.createElement('div',{className:k(this.props.className,"_2pom")},i.createElement('div',{className:"_2pon"+(this.props.isMessengerUser?' '+"_2poo":'')+(!this.props.isMessengerUser?' '+"_2pop":'')})));}});f.exports=m;},null);
__d('MessengerContactImage.react',['Image.react','MessengerProfileImageWrapper.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=k.PropTypes,m=k.createClass({displayName:'MessengerContactImage',mixins:[j],propTypes:{isMessengerUser:l.bool,size:l.number.isRequired,src:l.string.isRequired},render:function(){return (k.createElement('div',{className:this.props.className},k.createElement(i,{isMessengerUser:this.props.isMessengerUser,size:this.props.size,showBadge:true},k.createElement(h,{alt:'',height:this.props.size,src:this.props.src,width:this.props.size}))));}});f.exports=m;},null);
__d('MessengerSpinner.react',['Image.react','ReactComponentWithPureRenderMixin','React','cx','fbt','ix','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();'use strict';var o=j.PropTypes,p=m('/images/mercury/clients/messenger/core/LoadingSpinner.png'),q=m('/images/mercury/clients/messenger/core/LoadingSpinnerGrey.png'),r=m('/images/mercury/clients/messenger/core/LoadingSpinnerExtraLarge.png'),s=24,t=32,u=j.createClass({displayName:'MessengerSpinner',mixins:[i],propTypes:{color:o.oneOf(['blue','grey']),size:o.oneOf([s,t])},getDefaultProps:function(){return {color:'blue',size:s};},render:function(){return (j.createElement(h,{'aria-label':l._("Loading..."),'aria-busy':true,className:n(this.props.className,"_3u55 _3qh2"),height:this.props.size,src:this._getSpinnerSrc(),width:this.props.size}));},_getSpinnerSrc:function(){return this.props.size===s?this.props.color==='blue'?p:q:r;}});u.Sizes={LARGE:t,MEDIUM:s};f.exports=u;},null);
__d("XVideoCallAdminMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/admin_msg\/",{});},null,{});
__d('FBRTCAdminMessage',['FBRTCConstants','FBRTCCallConstants','FBRTCLogger','FBRTCUtils','XVideoCallAdminMessageController','emptyFunction','performanceNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p,q){'use strict';this.$FBRTCAdminMessage1=p;this.$FBRTCAdminMessage2=q;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null;}o.prototype.onCallConnected=function(){'use strict';if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=n();};o.prototype.onCallEnded=function(){'use strict';if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=n();};o.prototype.submit=function(p,q){'use strict';if(!this.$FBRTCAdminMessage5)this.onCallEnded();var r=0,s=i.FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4){r=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);s=i.FBRTCCallConnectionType.CONNECTED_CALL;}var t=s===i.FBRTCCallConnectionType.CONNECTED_CALL||q===h.CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:r,message_type:s,call_category:p,call_acknowledged:t});};o.prototype.$FBRTCAdminMessage6=function(p){'use strict';var q=l.getURIBuilder().getURI();k.sendServerRequest(q,m,this.$FBRTCAdminMessage7.bind(this,p.peer_id,p.call_id),false,null,p);};o.prototype.$FBRTCAdminMessage7=function(p,q,r){'use strict';var s;if(r){s='Fail to log admin message, error '+r.error;}else s='Server timed out on logging admin message';j.getInstance().logError(p,q,s);};f.exports=o;},null);
__d('FBRTCPCConfig',['FBRTCVersionDetection'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i="stun:stun.fbsbx.com:3478",j=function(l,m,n){if(h.isChrome()&&h.webrtcVersion()>=34){var o={urls:l};if(m&&n){o.username=m;o.credential=n;}return [o];}var p=[];for(var q=0;q<l.length;q++)if(m&&n){p.push({url:l[q],username:m,credential:n});}else p.push({url:l[q]});return p;},k={setTurnCredentials:function(l){this.turnIP=l.ip;this.udpPort=l.udp_port;this.tcpPort=l.tcp_port;this.sslPort=l.ssl_tcp_port;this.turnUsername=l.username;this.turnPassword=l.password;},getConfig:function(){var l=j([i]).concat(j(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:l};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(h.isFirefox()&&h.webrtcVersion()<27){return ['turn:'+this.turnIP+':'+this.udpPort];}else return ['turn:'+this.turnIP+':'+this.udpPort+'?transport=udp','turn:'+this.turnIP+':'+this.tcpPort+'?transport=tcp','turn:'+this.turnIP+':'+this.sslPort+'?transport=tcp'];}};f.exports=k;},null);
__d('FBRTCSdpUtils',['UserAgent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='m=video 0',j=function(m){return m.match(/^a=rtpmap:(\d+)\s/)[1];},k=function(m,n,o){var p=j(m[n]),q=m[o].split('RTP/SAVPF'),r=q[1].split(/\s+/),s=r.indexOf(p);r.splice(s,1);q[1]=r.join(' ');m[o]=q.join('RTP/SAVPF');m.splice(n,1);},l={addIceOptionToSdp:function(m,n){"use strict";var o="a=ice-options:",p=m.indexOf(o);if(p>=0){var q=m.indexOf("\r",p);return [m.slice(0,q)," ",n,m.slice(q)].join('');}var r=o+n,s=m.split("\r\n"),t=false,u=-1;for(var v=0;v<s.length;v++){var w=s[v].slice(0,2);if(w=="s="){t=true;continue;}if(t&&w=="a="){u=v;break;}}if(u>=0){s.splice(u,0,r);return s.join("\r\n");}return [m,r,"\r\n"].join('');},preferIsac:function(m){var n=m.split("\r\n"),o=-1,p=-1,q=-1;for(var r=0;r<n.length;r++){var s=n[r];if(s.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))o=r;if(q===-1&&o>-1&&s.match(/^a=rtpmap:/))q=r;if(s.match(/^a=rtpmap:\d+\s+ISAC\/16000/))p=r;}if(o===-1||p===-1||q===-1)return n.join("\r\n");var t=n[p];k(n,p,o);n.splice(q,0,t);n[o]=n[o].replace('RTP/SAVPF','RTP/SAVPF '+j(t));return n.join("\r\n");},disableVideo:function(m){var n=/m=video\s+\S+/;m=m.replace(n,i);if(h.isBrowser('Firefox <= 37'))m=this._makeDisabledVideoReceiveOnly(m);return m;},_makeDisabledVideoReceiveOnly:function(m){if(m.indexOf(i)>-1){var n=m.split(i);n[1]=n[1].replace(/send(recv|only)/,'recvonly');m=n.join(i);}return m;},fixMobileIceSdp:function(m){m=m.replace(/^a=/,'');m=m.split(/\s+username\s+.+password.+/)[0];var n=m.match(/\s+relay\s+|\s+srflx\s+/),o=m.match(/raddr.+rport.+/);if(n&&!o){n=n[0];var p=m.split(n),q=p[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),r,s;if(q){r=q[1];s=q[2];p[1]=p[1].replace(q[0],'');}else{q=p[0].split(/\s+/);r=q[4];s=q[5];}m=''+p[0]+n+'raddr '+r+' rport '+s+' '+p[1];}return m;},removeFEC:function(m){var n=m.split('\r\n'),o,p;for(var q=0;q<n.length;q++){if(n[q].match(/^a=rtpmap:\d+\s+red\//))o=q;if(n[q].match(/^m=video/))p=q;}if(o&&p)k(n,o,p);return n.join('\r\n');},isVideoSupported:function(m){return (m&&m.indexOf('m=video')>-1&&m.indexOf(i)===-1);},setDtlsRole:function(m,n){if(!m.match(/setup:(active|passive|actpass)/)){return m.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+n);}else return m.replace(/setup:actpass/g,'setup:'+n);},setVideoBitrateConstraint:function(m){var n=720;if(m.match(/^b=AS:/m))return m;m=m.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+n+'\r\n');return m;},removeSdparta:function(m){var n=m.split('\r\n'),o='audio',p=false,q=-1;for(var r=0;r<n.length;r++){var s=n[r];if(s.indexOf('m=audio')===0)o='audio';if(s.indexOf('m=video')===0){p=true;o='video';}if(s.indexOf('a=mid:sdparta_')===0)n[r]='a=mid:'+o;if(s.indexOf('a=group:BUNDLE sdparta_')===0)q=r;}if(q>-1)if(p){n[q]='a=group:BUNDLE audio video';}else n[q]='a=group:BUNDLE audio';return n.join('\r\n');}};f.exports=l;},null);
__d('FBRTCStatsHelpers',['FBRTCLogger'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function(k){if(k==='host'||k==='local')return 'local';if(k==='serverreflexive')return 'srflx';if(k==='peerreflexive')return 'prflx';if(k==='relayed'||k==='relay')return 'relay';return 'unknown';},j={connectionType:function(k,l,m,n){return ['l:',i(k),'-',l,';','r:',i(m),'-',n].join('');},logReport:function(k){var l=h.getInstance(),m=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var n=0;n<m.length;n++){var o=k[m[n]].call(k);l.logToConsole(m[n]+' => '+o);}}};f.exports=j;},null);
__d('FBRTCMozStatsReport',['Map','FBRTCLogger','FBRTCStatsHelpers'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){'use strict';this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new h();this.candidatePairs=new h();this.$FBRTCMozStatsReport5=i.getInstance();}k.prototype.parseReport=function(l){'use strict';l.forEach((function(m){switch(m.type){case 'inboundrtp':if(!m.remoteId)break;var n={inbound:m,outbound:l[m.remoteId]};if(m.isRemote){if(n.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport2=n;}else this.$FBRTCMozStatsReport1=n;}else if(n.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport4=n;}else this.$FBRTCMozStatsReport3=n;break;case 'outboundrtp':break;case 'candidatepair':if(m.state==='succeeded')this.candidatePairs.set(m.id,m);break;case 'localcandidate':this.candidates.set(m.id,m);break;case 'remotecandidate':this.candidates.set(m.id,m);break;default:this.$FBRTCMozStatsReport5.logToConsole('unrecognized webrtc stats type '+m.type);break;}}).bind(this));};k.prototype.isConnected=function(){'use strict';return !!this.$FBRTCMozStatsReport1;};k.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};k.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt;};k.prototype.audioCodec=function(){'use strict';return 'opus';};k.prototype.videoCodec=function(){'use strict';return 'VP8';};k.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};k.prototype.setVideoPacketsLost=function(l){'use strict';};k.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost;};k.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};k.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent;};k.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};k.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent;};k.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean;};k.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return 30;};k.prototype.connectionType=function(){'use strict';var l='unknown',m='unknown',n='unknown',o='unknown';this.candidatePairs.forEach((function(p){var q=this.candidates.get(p.localCandidateId),r=this.candidates.get(p.remoteCandidateId);l=q.transport;n=r.transport;m=q.candidateType;o=r.candidateType;}).bind(this));return j.connectionType(m,l,o,n);};f.exports=k;},null);
__d('FBRTCChromeStatsReport',['FBRTCStatsHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function(k,l){return parseInt(k.stat(l),10);};function j(){'use strict';this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null;}j.prototype.parseReport=function(k){'use strict';k.result().forEach((function(l){if(l.type==="googCandidatePair"&&l.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport1.push(l);if(this.$FBRTCChromeStatsReport7(l))this.$FBRTCChromeStatsReport2=l;if(this.$FBRTCChromeStatsReport8(l))this.$FBRTCChromeStatsReport3=l;if(this.$FBRTCChromeStatsReport9(l))this.$FBRTCChromeStatsReport4=l;if(this.$FBRTCChromeStatsReport10(l))this.$FBRTCChromeStatsReport5=l;if(l.type==='VideoBwe')this.$FBRTCChromeStatsReport6=l;}).bind(this));};j.prototype.isConnected=function(){'use strict';return true;};j.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'googRtt');};j.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googRtt');};j.prototype.audioCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};j.prototype.videoCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 'unknown';return this.$FBRTCChromeStatsReport3.stat('googCodecName');};j.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'packetsLost');};j.prototype.setVideoPacketsLost=function(k){'use strict';this.$FBRTCChromeStatsReport11=k;};j.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return i(this.$FBRTCChromeStatsReport3,'packetsLost');};j.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'bytesSent');};j.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'bytesSent');};j.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'packetsSent');};j.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'packetsSent');};j.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googFrameRateSent');};j.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googFrameRateInput');};j.prototype.connectionType=function(){'use strict';var k='unknown',l='unknown',m='unknown';for(var n=0;n<this.$FBRTCChromeStatsReport1.length;n++){var o=this.$FBRTCChromeStatsReport1[n];l=o.stat('googLocalCandidateType');m=o.stat('googRemoteCandidateType');k=o.stat('googTransportType');}return h.connectionType(l,k,m,k);};j.prototype.$FBRTCChromeStatsReport7=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('audioInputLevel')>-1;};j.prototype.$FBRTCChromeStatsReport8=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('googFrameHeightInput')>-1;};j.prototype.$FBRTCChromeStatsReport9=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('audioOutputLevel')>-1;};j.prototype.$FBRTCChromeStatsReport10=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('googFrameHeightReceived')>-1;};f.exports=j;},null);
__d('FBRTCStatsReportFactory',['FBRTCMozStatsReport','FBRTCChromeStatsReport','FBRTCLogger','FBRTCVersionDetection'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=function(o,p){o.getStats(null,function(q){var r=new h();r.parseReport(q);p(r);},function(){j.getInstance().logToConsole('Firefox stats collection failed');});},m=function(o,p){o.getStats(function(q){var r=new i();r.parseReport(q);p(r);});},n={getStats:function(o,p){if(k.isFirefox())l(o,p);if(k.isChrome())m(o,p);}};f.exports=n;},null);
__d('FBRTCCallConnection',['Base64','FBRTCConfig','FBRTCLogger','FBRTCPCConfig','FBRTCSdpUtils','FBRTCStatsReportFactory','Queue','UserAgent','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=300000,s=12000,t=10000,u='data',v=1000,w=100;function x(){'use strict';this.$FBRTCCallConnection1=j.getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new n({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13='passive';this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};}x.prototype.init=function(y){'use strict';this.$FBRTCCallConnection1.logToConsole('Creating a new peer connection with: '+JSON.stringify(k.getConfig())+', '+JSON.stringify(k.getConstraints()));this.$FBRTCCallConnection17=y;};x.prototype.setStream=function(y){'use strict';this.$FBRTCCallConnection17=y;};x.prototype.addScreenStream=function(y){'use strict';if(y&&y.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream added');this.$FBRTCCallConnection18=y;}else this.$FBRTCCallConnection1.logToConsole('Trying to add invalid stream');};x.prototype.removeScreenStream=function(y){'use strict';if(y&&y.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream removed');this.$FBRTCCallConnection3.removeStream(y.getStream());}else this.$FBRTCCallConnection1.logToConsole('Trying to remove invalid stream');this.$FBRTCCallConnection18=null;};x.prototype.setPeerSupportsVideo=function(y){'use strict';this.$FBRTCCallConnection14=y;};x.prototype.getRemoteStreamsCount=function(){'use strict';return this.$FBRTCCallConnection3.getRemoteStreams().length;};x.prototype.$FBRTCCallConnection19=function(y,z){'use strict';this.$FBRTCCallConnection20(null);y.onaddstream=null;y.onremovestream=null;y.onicecandidate=null;y.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var aa=z?5000:1;setTimeout(function(){if(y.iceConnectionState!=='closed')y.close();},aa);};x.prototype.$FBRTCCallConnection21=function(){'use strict';if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection19(this.$FBRTCCallConnection3,true);var y=new this.nativePeerConnection(k.getConfig(),k.getConstraints());this.$FBRTCCallConnection13='passive';y.onaddstream=this.$FBRTCCallConnection22.bind(this);y.onremovestream=this.$FBRTCCallConnection23.bind(this);y.onicecandidate=this.$FBRTCCallConnection24.bind(this);y.oniceconnectionstatechange=this.$FBRTCCallConnection25.bind(this);y.addStream(this.$FBRTCCallConnection17.getStream());return y;};x.prototype.$FBRTCCallConnection20=function(y){'use strict';this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=y;if(!y)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection26.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection27.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection28.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection29.bind(this);};x.prototype.$FBRTCCallConnection26=function(event){'use strict';this.$FBRTCCallConnection5.start();this.emit('data_opened',event);};x.prototype.$FBRTCCallConnection27=function(event){'use strict';this.$FBRTCCallConnection20(null);this.emit('data_closed',event);};x.prototype.$FBRTCCallConnection28=function(event){'use strict';this.$FBRTCCallConnection20(null);this.emit('data_error',event);};x.prototype.$FBRTCCallConnection29=function(event){'use strict';var y=JSON.parse(event.data);if(y.batchID===undefined){this.emit('data_message',y.data);return;}if(this.$FBRTCCallConnection16[y.batchID]===undefined)this.$FBRTCCallConnection16[y.batchID]=[];var z=this.$FBRTCCallConnection16[y.batchID];z.push(y.data);if(!y.isLast)return;var aa=h.decodeObject(z.join(''));delete this.$FBRTCCallConnection16[y.batchID];this.emit('data_message',aa.data);};x.prototype.isDataChannelOpen=function(){'use strict';return !!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==='open';};x.prototype.sendData=function(y){'use strict';this.$FBRTCCallConnection5.enqueue({data:y});};x.prototype.$FBRTCCallConnection6=function(y){'use strict';if(!this.isDataChannelOpen()){p(0);return;}if(y.batchID!==undefined){this.$FBRTCCallConnection30(y);return;}var z=JSON.stringify(y);try{this.$FBRTCCallConnection4.send(z);return;}catch(aa){}if(z.length<v){setTimeout((function(){this.$FBRTCCallConnection5.enqueue(y);}).bind(this),w);return;}var ba={batchID:this.$FBRTCCallConnection15.toString(),dataStr:h.encode(z)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection30(ba);};x.prototype.$FBRTCCallConnection30=function(y){'use strict';while(this.isDataChannelOpen()&&y.dataStr.length>0){var z={batchID:y.batchID,data:y.dataStr.slice(0,v)},aa=y.dataStr.slice(v);if(aa.length<=0)z.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(z));}catch(ba){setTimeout((function(){this.$FBRTCCallConnection5.enqueue(y);}).bind(this),w);return;}y.dataStr=aa;}};x.prototype.createOffer=function(){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection21();if(i.shouldCreateDataChannel())this.$FBRTCCallConnection20(this.$FBRTCCallConnection3.createDataChannel(u));this.$FBRTCCallConnection31('offer');this.$FBRTCCallConnection13='active';};x.prototype.createSdpUpdate=function(){'use strict';var y=this.$FBRTCCallConnection3.getLocalStreams();for(var z=0;z<y.length;z++)this.$FBRTCCallConnection3.removeStream(y[z]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection17.getStream());if(this.$FBRTCCallConnection18)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());this.$FBRTCCallConnection31('sdp_update');};x.prototype.$FBRTCCallConnection31=function(y){'use strict';this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection32.bind(this,y),this.$FBRTCCallConnection33.bind(this,'CreateOfferFailed'),this.$FBRTCCallConnection34());};x.prototype.$FBRTCCallConnection34=function(){'use strict';if(o.isBrowser('Chrome <= 37')||o.isBrowser('Opera <= 25'))return {mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return {offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14};};x.prototype.end=function(){'use strict';this.$FBRTCCallConnection1.logToConsole('Ending connection...');if(this.$FBRTCCallConnection3){this.emit('isEnding');this.$FBRTCCallConnection19(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null;}};x.prototype.onReceivedOfferSDP=function(y){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection21();if(i.shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=(function(event){this.$FBRTCCallConnection20(event.channel);}).bind(this);var z=new this.nativeSessionDescription({type:'offer',sdp:y});this.$FBRTCCallConnection3.setRemoteDescription(z,this.$FBRTCCallConnection35.bind(this,z),this.$FBRTCCallConnection33.bind(this,'SetRemoteOfferFailed'));};x.prototype.onReceivedAnswerSDP=function(y){'use strict';var z=new this.nativeSessionDescription({type:'answer',sdp:y});this.$FBRTCCallConnection3.setRemoteDescription(z,this.$FBRTCCallConnection35.bind(this,z),this.$FBRTCCallConnection33.bind(this,'SetRemoteAnswerFailed'));};x.prototype.onReceivedSdpUpdate=function(y){'use strict';if(this.$FBRTCCallConnection12)setTimeout((function(){this.onReceivedSdpUpdate(y);}).bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case 'stable':this.$FBRTCCallConnection36(y,'offer');break;case 'have-local-offer':y=l.setDtlsRole(y,this.$FBRTCCallConnection13);this.$FBRTCCallConnection36(y,'answer');break;case 'have-remote-offer':setTimeout((function(){this.onReceivedSdpUpdate(y);}).bind(this),1000);break;case 'have-local-pranswer':case 'have-remote-pranswer':break;case 'closed':break;}};x.prototype.$FBRTCCallConnection36=function(y,z){'use strict';var aa=new this.nativeSessionDescription({type:z,sdp:y});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.setRemoteDescription(aa,(function(){this.$FBRTCCallConnection1.logToConsole('sdp update '+aa.type+' set');if(this.$FBRTCCallConnection3&&aa.type==='offer'){this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection32.bind(this,'sdp_update'),this.$FBRTCCallConnection33.bind(this,'CreateSdpUpdateFailed'));}else this.$FBRTCCallConnection12=false;}).bind(this),this.$FBRTCCallConnection33.bind(this,'SetRemoteSdpUpdateFailed'));};x.prototype.onReceivedRemoteIceCandidate=function(y){'use strict';y.sdp=l.fixMobileIceSdp(y.sdp);var z=new this.nativeIceCandidate({sdpMLineIndex:y.label,candidate:y.sdp,sdpMid:y.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(z);};x.prototype.getStats=function(y){'use strict';m.getStats(this.$FBRTCCallConnection3,y);};x.prototype.getCreatedIceCandidates=function(){'use strict';return this.$FBRTCCallConnection11;};x.prototype.$FBRTCCallConnection32=function(y,z){'use strict';this.$FBRTCCallConnection1.logToConsole('Created '+y+' sdp');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onSDPCreated: pc has been deallocated');return;}if(!this.$FBRTCCallConnection14&&y==='sdp_update')z.sdp=l.disableVideo(z.sdp);z.sdp=l.addIceOptionToSdp(z.sdp,"fb-force-5245");z.sdp=l.preferIsac(z.sdp);z.sdp=l.removeSdparta(z.sdp);this.$FBRTCCallConnection3.setLocalDescription(z,(function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole('Local '+y+' set');this.emit('sdpCreated',{type:y,sdp:z.sdp});}).bind(this),this.$FBRTCCallConnection33.bind(this,'SetLocalDescriptionFailed:'+y));};x.prototype.$FBRTCCallConnection35=function(y){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote '+y.type+' set');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(y.type==='offer')this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection32.bind(this,'answer'),this.$FBRTCCallConnection33.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};x.prototype.$FBRTCCallConnection22=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};x.prototype.$FBRTCCallConnection23=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream removed');this.emit('remoteStreamRemoved',{stream:event.stream});};x.prototype.$FBRTCCallConnection24=function(event){'use strict';if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit('localIceCandidateCreated',event.candidate);}};x.prototype.$FBRTCCallConnection25=function(event){'use strict';var y=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection7+' to '+y);if(y===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection37();if(this.$FBRTCCallConnection38(y)){if(!this.$FBRTCCallConnection9){this.emit('connected');this.$FBRTCCallConnection9=true;}}else if(y==='disconnected'){this.$FBRTCCallConnection39();}else if(y==='failed')this.$FBRTCCallConnection40();this.$FBRTCCallConnection7=y;};x.prototype.$FBRTCCallConnection38=function(y){'use strict';return y==='completed'||y==='connected';};x.prototype.$FBRTCCallConnection39=function(){'use strict';if(this.$FBRTCCallConnection38(this.$FBRTCCallConnection7)){var y=Date.now();if(this.$FBRTCCallConnection41-y>=r)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection41=y;if(this.$FBRTCCallConnection10>=2)this.emit('connectionUnstable');}var z=this;this.$FBRTCCallConnection8=setTimeout(function(){z.emit('disconnected');},s);};x.prototype.$FBRTCCallConnection40=function(){'use strict';var y=this;this.$FBRTCCallConnection8=setTimeout(function(){var z={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};y.emit('connectionError',z);},t);};x.prototype.$FBRTCCallConnection37=function(){'use strict';if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null;};x.prototype.$FBRTCCallConnection33=function(y,z){'use strict';var aa={details:z,endCallSubreason:y};this.emit('connectionError',aa);};x.prototype.$FBRTCCallConnection2=function(){'use strict';if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection1.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};q(x,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=x;},null);
__d("RingBuffer",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[];}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i;};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length;};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2];};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()];};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k]);}};h.prototype.$RingBuffer4=function(){"use strict";return (this.$RingBuffer2+1)%this.$RingBuffer3.length;};f.exports=h;},null);
__d('FBRTCRttAggregator',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}h.prototype.addRtt=function(i){'use strict';var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1;};h.prototype.toString=function(){'use strict';return [this.$FBRTCRttAggregator4('50',this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4('100',this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4('200',this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4('0',this.$FBRTCRttAggregator1[3])].join('|');};h.prototype.$FBRTCRttAggregator4=function(i,j){'use strict';return i+'='+j.count+','+Math.round(j.ave);};h.prototype.$FBRTCRttAggregator2=function(i){'use strict';if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3;};h.prototype.$FBRTCRttAggregator3=function(i,j,k){'use strict';return (i*j+k)/(j+1);};f.exports=h;},null);
__d('FBRTCStatsInterpreter',['FBRTCLogger'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function j(k){'use strict';this.$FBRTCStatsInterpreter1=babelHelpers._extends({},i,k);this.$FBRTCStatsInterpreter2=h.getInstance();this.$FBRTCStatsInterpreter3=0;}j.prototype.interpretStats=function(k,l){'use strict';var m=k.videoRtt(),n=this.$FBRTCStatsInterpreter4(k),o=this.$FBRTCStatsInterpreter5(k,l),p=this.$FBRTCStatsInterpreter6(m,n,o);if(p>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(p<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1;};j.prototype.isNetworkPoor=function(){'use strict';return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count;};j.prototype.$FBRTCStatsInterpreter6=function(k,l,m){'use strict';return k*this.$FBRTCStatsInterpreter1.rtt_weight+l*this.$FBRTCStatsInterpreter1.frr_weight+m*this.$FBRTCStatsInterpreter1.plr_weight;};j.prototype.$FBRTCStatsInterpreter5=function(k,l){'use strict';var m,n;if(l){m=k.videoPacketsLost()-l.videoPacketsLost();n=k.videoPacketsSent()-l.videoPacketsSent();}else{m=k.videoPacketsLost();n=k.videoPacketsSent();}if(m<0||n===0)return 0;return m/n;};j.prototype.$FBRTCStatsInterpreter4=function(k){'use strict';if(k.videoFrameRateCaptured()===0)return 0;return 1-k.videoFrameRateSent()/k.videoFrameRateCaptured();};f.exports=j;},null);
__d('FBRTCCallConnectionMonitor',['RingBuffer','FBRTCRttAggregator','FBRTCStatsInterpreter','FBRTCConfig','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=3000,n=1,o=0,p=3;function q(r,s){'use strict';this.$FBRTCCallConnectionMonitor1=new j(k.statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new i();this.$FBRTCCallConnectionMonitor3=new i();this.$FBRTCCallConnectionMonitor4=r;this.$FBRTCCallConnectionMonitor5=s;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new h(n);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener('connected',this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener('isEnding',this.$FBRTCCallConnectionMonitor11,this);}q.prototype.$FBRTCCallConnectionMonitor10=function(){'use strict';var r=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(r,m);this.$FBRTCCallConnectionMonitor12();};q.prototype.$FBRTCCallConnectionMonitor11=function(){'use strict';if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null;}};q.prototype.$FBRTCCallConnectionMonitor12=function(){'use strict';this.$FBRTCCallConnectionMonitor4.getStats((function(r){var s;if(this.$FBRTCCallConnectionMonitor8.size()>0){s=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(r,s);}if(this.$FBRTCCallConnectionMonitor7.length<o)this.$FBRTCCallConnectionMonitor7.push(r);if(s&&s.isConnected()&&!r.isConnected())this.$FBRTCCallConnectionMonitor9+=1;if(this.$FBRTCCallConnectionMonitor9>=p)this.$FBRTCCallConnectionMonitor4.emit('disconnected');if(r.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(r);this.$FBRTCCallConnectionMonitor2.addRtt(r.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(r.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(r,s);}}).bind(this));};q.prototype.$FBRTCCallConnectionMonitor14=function(){'use strict';var r=this.$FBRTCCallConnectionMonitor8.head();return {end:{conn_type:r.connectionType()},sender:{bytes:r.audioBytesSent(),codec:{'0':r.audioCodec()},plost:r.audioPacketsLost(),psent:r.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:r.videoBytesSent(),codec:{'0':r.videoCodec()},plost:r.videoPacketsLost(),psent:r.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}};};q.prototype.$FBRTCCallConnectionMonitor13=function(r,s){'use strict';if(s.videoPacketsLost()>r.videoPacketsLost())r.setVideoPacketsLost(s.videoPacketsLost());};q.prototype.$FBRTCCallConnectionMonitor15=function(r,s){'use strict';this.$FBRTCCallConnectionMonitor1.interpretStats(r,s);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit('connectionPoor');};l(q,{connectionPoor:true});f.exports=q;},null);
__d('FBRTCCallControlActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j=i({ACCEPT_ESCALATION:null,HANG_UP:null,PARENT_WINDOW_START_CALL:null,TOGGLE_FULL_SCREEN:null,TOGGLE_MUTE_AUDIO:null,TOGGLE_MUTE_VIDEO:null,TOGGLE_SCREEN_SHARING:null,SHOW_SETTINGS:null,DECLINE_ESCALATION:null,RECEIVED_SIGNALING_MESSAGE:null,RESET_CALL:null}),k={Types:j,hangUp:function(){h.dispatch({type:j.HANG_UP});},toggleMuteAudio:function(){h.dispatch({type:j.TOGGLE_MUTE_AUDIO});},toggleMuteVideo:function(){h.dispatch({type:j.TOGGLE_MUTE_VIDEO});},toggleFullScreen:function(){h.dispatch({type:j.TOGGLE_FULL_SCREEN});},showSettings:function(){h.dispatch({type:j.SHOW_SETTINGS});},toggleScreenSharing:function(){h.dispatch({type:j.TOGGLE_SCREEN_SHARING});},receivedSignalingMessage:function(l){h.dispatch({type:j.RECEIVED_SIGNALING_MESSAGE,message_type:l.msgType,message:l});},acceptEscalation:function(){h.dispatch({type:j.ACCEPT_ESCALATION});},declineEscalation:function(){h.dispatch({type:j.DECLINE_ESCALATION});},resetCall:function(l){h.dispatch({type:j.RESET_CALL,trigger:l});},parentWindowStartCall:function(){h.dispatch({type:j.PARENT_WINDOW_START_CALL});}};f.exports=k;},null);
__d('FBRTCFullScreenController',['FBRTCCallControlActions','FBRTCStore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k,l,m,n=document.documentElement;if(n.requestFullscreen){l=n.requestFullscreen.bind(n);m='fullscreenchange';}else if(n.msRequestFullscreen){l=n.msRequestFullscreen.bind(n);m='msfullscreenchange';}else if(n.mozRequestFullScreen){l=n.mozRequestFullScreen.bind(n);m='mozfullscreenchange';}else if(n.webkitRequestFullscreen){l=n.webkitRequestFullscreen.bind(n,Element.ALLOW_KEYBOARD_INPUT);m='webkitfullscreenchange';}var o;if(document.exitFullscreen){o=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){o=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){o=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)o=document.webkitExitFullscreen.bind(document);j=babelHelpers.inherits(p,i);k=j&&j.prototype;function p(){'use strict';k.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(m,this.$FBRTCFullScreenController1);}p.prototype.destroy=function(){'use strict';document.removeEventListener(m,this.$FBRTCFullScreenController1);k.destroy.call(this);};p.prototype.$FBRTCFullScreenController2=function(){'use strict';this.__emitChange();};p.prototype.supportsFullScreen=function(){'use strict';return l&&o;};p.prototype.isFullScreen=function(){'use strict';return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);};p.prototype.$FBRTCFullScreenController3=function(){'use strict';if(this.isFullScreen()){o();}else l();};p.prototype.__onDispatch=function(q){'use strict';switch(q.type){case h.Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break;}};f.exports=new p();},null);
__d("XVideoCallUserInfoController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null,{});
__d('FBRTCPeerInfo',['ix','XVideoCallUserInfoController','FBRTCUtils'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this.peerID=l;this.peerPicUrl=null;this.selfPicUrl=h('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';this.peerShortName=null;}k.prototype.fetch=function(l,m){'use strict';var n=i.getURIBuilder().setInt('user_id',this.peerID).getURI(),o=this;j.sendServerRequest(n,function(p){o.peerPicUrl=p.payload.profile_pic_url;o.backgroundUrl=p.payload.cover_pic_url;o.peerName=p.payload.name;o.peerShortName=p.payload.peer_short_name;if(p.payload.self_profile_pic_url)o.selfPicUrl=p.payload.self_profile_pic_url;if(l)l();},m);};f.exports=k;},null);
__d('FBRTCStreamWrapper',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=100,k=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,l;function m(){'use strict';this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=m.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}m.prototype.setStream=function(n){'use strict';var o=arguments.length<=1||arguments[1]===undefined?true:arguments[1],p=this.hasStream();this.stopStream();this.$FBRTCStreamWrapper3=n;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(o){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(p)this.emit('tracksChanged');}};m.prototype.getStream=function(){'use strict';return this.$FBRTCStreamWrapper3;};m.prototype.hasStream=function(){'use strict';return !!this.$FBRTCStreamWrapper3;};m.isScreenStream=function(n){'use strict';if(n&&n.getAudioTracks().length===0)return true;return false;};m.prototype.stopStream=function(){'use strict';if(this.$FBRTCStreamWrapper3){if(this.$FBRTCStreamWrapper3.stop)this.$FBRTCStreamWrapper3.stop();this.$FBRTCStreamWrapper3=null;}};m.prototype.hasVideoTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3)return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true;};m.prototype.hasVideo=function(){'use strict';return this.$FBRTCStreamWrapper2&&this.hasVideoTracks();};m.prototype.hasAudioTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true;};m.prototype.hasAudio=function(){'use strict';return this.$FBRTCStreamWrapper1&&this.hasAudioTracks();};m.prototype.attachToVideoTag=function(n){'use strict';if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=n;i.attachMediaStream(n,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(n);}};m.prototype.getAudioAnalyser=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper10(),o=n.createMediaStreamSource(this.$FBRTCStreamWrapper3),p=n.createAnalyser();p.fftSize=2048;o.connect(p);return p;}};m.prototype.$FBRTCStreamWrapper10=function(){'use strict';if(!l)l=new k();return l;};m.prototype.toggleMuteAudio=function(){'use strict';if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5();};m.prototype.$FBRTCStreamWrapper5=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper3.getAudioTracks();for(var o=0;o<n.length;o++)n[o].enabled=this.$FBRTCStreamWrapper1;}};m.prototype.toggleMuteVideo=function(){'use strict';this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2){this.$FBRTCStreamWrapper6();}else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7();};m.prototype.$FBRTCStreamWrapper6=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper3.getVideoTracks();for(var o=0;o<n.length;o++)n[o].enabled=this.$FBRTCStreamWrapper2;}};m.prototype.setVideoEnabled=function(n){'use strict';this.$FBRTCStreamWrapper2=n;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7();};m.prototype.$FBRTCStreamWrapper9=function(n){'use strict';if(!this.hasVideo()||n.currentTime>0){this.$FBRTCStreamWrapper11(n);}else setTimeout(this.$FBRTCStreamWrapper9.bind(this,n),j);};m.prototype.$FBRTCStreamWrapper12=function(n){'use strict';this.videoWidth=n.videoWidth;this.videoHeight=n.videoHeight;var o=n.videoWidth/n.videoHeight;if(i.aboutEqual(o,16/9))return m.aspectRatios['16:9'];if(i.aboutEqual(o,4/3))return m.aspectRatios['4:3'];return m.aspectRatios.other;};m.prototype.$FBRTCStreamWrapper11=function(n){'use strict';if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper12(n);}else this.aspectRatio=m.aspectRatios.other;this.emit('streamStarted');};m.prototype.$FBRTCStreamWrapper8=function(){'use strict';this.emit('streamEnded');};m.prototype.$FBRTCStreamWrapper7=function(event){'use strict';if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit('tracksChanged');};m.prototype.$FBRTCStreamWrapper13=function(n){'use strict';return this.$FBRTCStreamWrapper4&&n&&n.type==='addtrack'&&n.track.kind==='video';};m.aspectRatios={'16:9':1,'4:3':2,other:3};h(m,{streamStarted:true,streamEnded:true,tracksChanged:true});f.exports=m;},null);
__d('FBRTCVideoDurationTracker',['performanceNow'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';var i=0;function j(k){this.$FBRTCVideoDurationTracker1=k;this.$FBRTCVideoDurationTracker2=0;this.$FBRTCVideoDurationTracker3=i;}j.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker1.hasVideo())this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker4();this.$FBRTCVideoDurationTracker5=this.$FBRTCVideoDurationTracker1.addListener('tracksChanged',(function(){if(this.$FBRTCVideoDurationTracker1.hasVideo()&&!this.$FBRTCVideoDurationTracker3){this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker4();}else if(!this.$FBRTCVideoDurationTracker1.hasVideo()){this.$FBRTCVideoDurationTracker2=this.getDuration();this.$FBRTCVideoDurationTracker3=i;}}).bind(this));};j.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker2=this.getDuration();this.$FBRTCVideoDurationTracker3=i;if(this.$FBRTCVideoDurationTracker5){this.$FBRTCVideoDurationTracker5.remove();this.$FBRTCVideoDurationTracker5=null;}};j.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker3!==i){var k=this.$FBRTCVideoDurationTracker4()-this.$FBRTCVideoDurationTracker3;return this.$FBRTCVideoDurationTracker2+k;}return this.$FBRTCVideoDurationTracker2;};j.prototype.$FBRTCVideoDurationTracker4=function(){return h();};f.exports=j;},null);
__d('FBRTCCallModel',['FBRTCAdminMessage','FBRTCCallConstants','FBRTCCallControlActions','FBRTCConfig','FBRTCFullScreenController','FBRTCLogger','FBRTCPCConfig','FBRTCPeerInfo','FBRTCScreenSharingUtils','FBRTCStore','FBRTCStreamWrapper','FBRTCStruct','FBRTCUtils','FBRTCVideoDurationTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v,w;v=babelHelpers.inherits(x,q);w=v&&v.prototype;function x(y){'use strict';w.constructor.call(this);this.$FBRTCCallModel1=m.getInstance();this.isCaller=y.isCaller;this.peerID=y.peerID;this.$FBRTCCallModel2=new o(y.peerID);this.$FBRTCCallModel3=false;this.$FBRTCCallModel4(y.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true);}x.prototype.resetForReconnect=function(y){'use strict';this.isCaller=false;this.$FBRTCCallModel4(y);this.$FBRTCCallModel6(false);};x.prototype.fetchPeerInfo=function(){'use strict';if(t.isCollabCallable(this.peerID))return;var y=this,z=function(){y.__emitChange();},aa=function(){y.$FBRTCCallModel1.logError(y.peerID,y.callID,'Failed to get remote photos');};this.$FBRTCCallModel2.fetch(z,aa);};x.prototype.setSignalingExperiments=function(y){'use strict';if(y||y===[])this.$FBRTCCallModel7=y;};x.prototype.supportsSdpUpdate=function(){'use strict';return this.$FBRTCCallModel7.indexOf('sdp_update')>-1&&k.supportedSignalingExperiments().indexOf('sdp_update')>-1;};x.prototype.canPeerReceiveScreenSharing=function(){'use strict';return this.$FBRTCCallModel7.indexOf('screen_sharing')>-1;};x.prototype.onSDPMessageFromPeer=function(y){'use strict';this.isRemoteVideoSupported=y.isRemoteVideoSupported();this.isPeerOnMobile=y.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false);};x.prototype.$FBRTCCallModel5=function(){'use strict';this.remoteStream=new r();this.localStream=new r();this.localStream.addListener('tracksChanged',(function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.__emitChange();}).bind(this));this.$FBRTCCallModel10=new u(this.remoteStream);this.$FBRTCCallModel11=new u(this.localStream);};x.prototype.$FBRTCCallModel4=function(y){'use strict';this.callID=y;this.$FBRTCCallModel12=new h(this.peerID,y);this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel13=null;};x.prototype.$FBRTCCallModel6=function(y){'use strict';this.selfViewOpen=true;this.uiState=x.UIState.INIT;this.__emitChange();};x.prototype.getLocalVideoDuration=function(){'use strict';return this.$FBRTCCallModel11.getDuration();};x.prototype.getRemoteVideoDuration=function(){'use strict';return this.$FBRTCCallModel10.getDuration();};x.prototype.setLocalStream=function(y){'use strict';this.localStream.setStream(y);};x.prototype.setRemoteStream=function(y){'use strict';this.remoteStream.setStream(y);this.remoteStream.once('streamStarted',(function(){this.setStateFrom(x.UIState.CALL_CONNECTING,x.UIState.CALL_CONNECTED);}).bind(this));this.remoteStream.addListener('tracksChanged',(function(){this.__emitChange();}).bind(this));this.__emitChange();};x.prototype.setRemoteScreenStream=function(y){'use strict';this.$FBRTCCallModel13=y;this.__emitChange();};x.prototype.getRemoteScreenStream=function(){'use strict';return this.$FBRTCCallModel13;};x.prototype.canStartCall=function(){'use strict';return this.localStream.hasStream()&&n.turnIP;};x.prototype.isAwaitingUserStart=function(){'use strict';return this.uiState===x.UIState.AWAITING_USER_START;};x.prototype.canBeStartedByParentWindow=function(){'use strict';return k.shouldParentWindowStartCall()&&this.uiState===x.UIState.INIT;};x.prototype.isInProgress=function(){'use strict';return this.uiState>=x.UIState.CONTACTING&&this.uiState<x.UIState.CALL_ENDED;};x.prototype.isUserMediaPending=function(){'use strict';return this.uiState===x.UIState.PENDING_LOCAL_MEDIA;};x.prototype.isUserMediaDenied=function(){'use strict';return this.uiState===x.UIState.USER_MEDIA_DENIED;};x.prototype.isConnected=function(){'use strict';return this.uiState===x.UIState.CALL_CONNECTED;};x.prototype.isRemoteVideoActive=function(){'use strict';return this.uiState===x.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo();};x.prototype.isEnded=function(){'use strict';return this.uiState>=x.UIState.CALL_ENDED;};x.prototype.isAwaitingAnswer=function(){'use strict';return this.uiState==x.UIState.CONTACTING||this.uiState==x.UIState.RINGING;};x.prototype.isFullScreen=function(){'use strict';return l.isFullScreen();};x.prototype.isScreenSharingEnabled=function(){'use strict';return this.$FBRTCCallModel3;};x.prototype.setScreenSharingStatus=function(y){'use strict';this.$FBRTCCallModel3=y;};x.prototype.peerPicUrl=function(){'use strict';return this.$FBRTCCallModel2.peerPicUrl;};x.prototype.selfPicUrl=function(){'use strict';return this.$FBRTCCallModel2.selfPicUrl;};x.prototype.backgroundUrl=function(){'use strict';return this.$FBRTCCallModel2.backgroundUrl;};x.prototype.peerName=function(){'use strict';return this.$FBRTCCallModel2.peerName;};x.prototype.peerShortName=function(){'use strict';if(this.$FBRTCCallModel2.peerShortName)return this.$FBRTCCallModel2.peerShortName;return this.$FBRTCCallModel2.peerName;};x.prototype.autoDisableVideo=function(){'use strict';if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};x.prototype.videoIsAutoDisabled=function(){'use strict';return !this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo();};x.prototype.$FBRTCCallModel14=function(){'use strict';this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_MUTE,!this.localStream.hasAudio()?'true':'false');this.__emitChange();};x.prototype.$FBRTCCallModel15=function(y){'use strict';this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange();};x.prototype.toggleSelfView=function(){'use strict';this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?'true':'false');this.__emitChange();};x.prototype.setState=function(y){'use strict';if(y===this.uiState)return;var z=this.uiState;this.uiState=y;switch(y){case x.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel12.onCallConnected();this.$FBRTCCallModel10.startTracking();this.$FBRTCCallModel11.startTracking();break;case x.UIState.CALL_ENDED:this.$FBRTCCallModel12.onCallEnded();this.$FBRTCCallModel10.stopTracking();this.$FBRTCCallModel11.stopTracking();if(this.isCaller&&z>x.UIState.MORE_INIT){var aa=this.isRemoteVideoSupported?i.FBRTCCallType.VIDEO_CALL:i.FBRTCCallType.VOICE_CALL;this.$FBRTCCallModel12.submit(aa,this.endCallReason);}break;}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+x.UIState.strNames[z]+'" to "'+x.UIState.strNames[y]+'"');this.__emitChange();};x.prototype.setStateFrom=function(y,z){'use strict';if(this.uiState===y){this.setState(z);}else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+x.UIState.strNames[y]+'", not moving to "'+x.UIState.strNames[z]+'"');};x.prototype.__onDispatch=function(y){'use strict';switch(y.type){case j.Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel14();break;case j.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel15();break;case p.ActionTypes.OPEN_IN_NEW:case p.ActionTypes.WINDOW_CLOSED:this.__emitChange();break;}};x.UIState=new s(['INIT','AWAITING_USER_START','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);f.exports=x;},null);
__d('FBRTCCallMonitor',['FBRTCCallSummaryStore'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=10000,j=3000;function k(l){'use strict';this.$FBRTCCallMonitor1=l;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=h.getInstance();}k.prototype.startHeartbeat=function(l){'use strict';if(this.$FBRTCCallMonitor1.isEnded())return;var m=l();if(m)this.onCallHeartbeat(m);var n=this;setTimeout(function(){n.startHeartbeat(l);},i);};k.prototype.onCallHeartbeat=function(l){'use strict';var m=new Date().valueOf();if(!this.$FBRTCCallMonitor2||m-this.$FBRTCCallMonitor2>j)l.save(this.$FBRTCCallMonitor3);};f.exports=k;},null);
__d('FBRTCExperiment',['FBRTCExperimentsConfig','QE'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';j.gen=function(k){var l={params:{},in_experiment:false,auto_exposure:false},m=h[k]||l,n=new j(k,m.params,m.in_experiment);if(m.auto_exposure)n.logExposure(k);return n;};function j(k,l,m){this.$FBRTCExperiment1=k;this.$FBRTCExperiment2=l;this.$FBRTCExperiment3=m;}j.prototype.logExposure=function(){if(this.$FBRTCExperiment3)i.logExposure(this.$FBRTCExperiment1);};j.prototype.getParam=function(k,l){if(this.$FBRTCExperiment2[k])return this.$FBRTCExperiment2[k].toString();return l;};j.prototype.getInt=function(k,l){if(this.$FBRTCExperiment2[k])return parseInt(this.$FBRTCExperiment2[k],10);return l;};j.prototype.getBool=function(k,l){var m=this.$FBRTCExperiment2;if(m[k])return m[k]==='1'||m[k]===1||m[k]==='true';return l;};f.exports=j;},null);
__d("FBRTCIceCache",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this.$FBRTCIceCache1={};}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[];};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k);};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l);}}};f.exports=h;},null);
__d('FBRTCLocalMessageQueue',['CacheStorage','FBRTCLogger'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='localstorage',k='RTC_',l='offer',m='offer_msg',n='data_',o=30*1000,p=15*1000,q=500;function r(){'use strict';this.$FBRTCLocalMessageQueue1=i.getInstance();}r.prototype.enqueueOffer=function(s,t){'use strict';var u=this.$FBRTCLocalMessageQueue2(s,m);this.$FBRTCLocalMessageQueue3(u,l,t);};r.prototype.getOffer=function(s){'use strict';var t=this.$FBRTCLocalMessageQueue2(s,m);return this.$FBRTCLocalMessageQueue4(t,l);};r.prototype.removeOffer=function(s){'use strict';var t=this.$FBRTCLocalMessageQueue2(s,m);t.remove(l);};r.prototype.enqueueMessage=function(s,t,u,v){'use strict';var w=this.$FBRTCLocalMessageQueue2(s,t),x=n+u.toString();this.$FBRTCLocalMessageQueue3(w,x,v);this.$FBRTCLocalMessageQueue1.logToConsole('Queued '+x);};r.prototype.enableDequeuing=function(s,t,u,v){'use strict';if(v===undefined)v=p;this.$FBRTCLocalMessageQueue5(s,t,u,v);};r.prototype.$FBRTCLocalMessageQueue5=function(s,t,u,v){'use strict';var w=this.$FBRTCLocalMessageQueue2(s,t),x=w.keys(),y=x.length;for(var z=0;z<y;z++){var aa=this.$FBRTCLocalMessageQueue6(w,x[z]);if(aa&&u)u(aa);}this.$FBRTCLocalMessageQueue1.logToConsole('Dequeued '+y+' ('+s+') with '+v+' left)');if(v>0){v-=q;setTimeout((function(){this.$FBRTCLocalMessageQueue5(s,t,u,v);}).bind(this),q);}};r.prototype.$FBRTCLocalMessageQueue3=function(s,t,u){'use strict';var v={__t:Date.now(),__d:u};s.set(t,v);};r.prototype.$FBRTCLocalMessageQueue4=function(s,t){'use strict';var u=s.get(t);if(u&&this.$FBRTCLocalMessageQueue7(u)){return u.__d;}else if(u)s.remove(t);return null;};r.prototype.$FBRTCLocalMessageQueue6=function(s,t){'use strict';var u=this.$FBRTCLocalMessageQueue4(s,t);if(u!==null){s.remove(t);return u;}return null;};r.prototype.$FBRTCLocalMessageQueue7=function(s){'use strict';return Date.now()-s.__t<o;};r.prototype.$FBRTCLocalMessageQueue2=function(s,t){'use strict';return new h(j,''+k+s+'_'+t+'_');};f.exports=r;},null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCSdpUtils','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='mobile';function l(m){'use strict';if(!this.$FBRTCMessage1(m))throw 'invalid webrtc message';this.originalMessageData=m;this.peerID=m.from;this.callID=parseInt(m.call_id,10);this.msg=JSON.parse(m.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=m.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();}l.prototype.$FBRTCMessage1=function(m){'use strict';return m.from&&m.call_id&&m.payload;};l.prototype.$FBRTCMessage2=function(){'use strict';if(j.isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};l.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=i.disableVideo(this.msg.sdp);if(this.msgType===h.PayloadType.SET_VIDEO||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.ANSWER||this.msgType===h.PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};l.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==h.PayloadType.ICE_CANDIDATE)this.msg.sdp=i.removeFEC(this.msg.sdp);};l.prototype.isOffer=function(){'use strict';return this.msgType===h.PayloadType.OFFER;};l.prototype.isFromMobile=function(){'use strict';return this.source===k;};l.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===h.PayloadType.ICE_CANDIDATE)return true;return i.isVideoSupported(this.msg.sdp);};l.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};l.prototype.isForCall=function(m){'use strict';return !m.callID||m.callID===this.callID||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.PCRESTART_OFFER||this.msgType===h.PayloadType.ICE_CANDIDATE;};l.prototype.getSignalingExperiments=function(){'use strict';if(this.isFromMobile()&&!this.msg.experiments)return ['sdp_update'];return this.msg.experiments;};f.exports=l;},null);
__d("FBRTCMessageDedup",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={check:function(j,k,l){if(!h[j])h[j]={};if(!h[j][k])h[j][k]={};if(h[j][k][l])return false;h[j][k][l]=true;return true;}};f.exports=i;},null);
__d("XVideoCallSendMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null,{});
__d('FBRTCMessageSender',['CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController','errorCode'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=0;function u(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=k.getInstance();}u.prototype.sendOffer=function(v,w,x,y){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.OFFER,v,w,x,y);};u.prototype.sendAnswer=function(v,w,x,y){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.ANSWER,v,w,x,y);};u.prototype.sendPCRestartOffer=function(v,w,x,y){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.PCRESTART_OFFER,v,w,x,y);};u.prototype.sendSdpUpdate=function(v,w,x,y){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.SDP_UPDATE,v,w,x,y);};u.prototype.resendSdpMessage=function(v,w){'use strict';w.flag=1;this.$FBRTCMessageSender3(v,w);};u.prototype.resendPayload=function(v,w){'use strict';w.flag=1;this.$FBRTCMessageSender4(v,w);};u.prototype.$FBRTCMessageSender2=function(v,w,x,y,z){'use strict';var aa=this.$FBRTCMessageSender5(x,v);aa.sdp=y;if(v===j.PayloadType.OFFER){aa.handlescollision=true;aa.pranswer=false;}if(v===j.PayloadType.OFFER||v===j.PayloadType.ANSWER){aa.icerestart=false;aa.experiments=i.supportedSignalingExperiments();}aa.videoon=z;this.$FBRTCMessageSender3(w,aa);return aa;};u.prototype.sendIceCandidate=function(v,w,x){'use strict';var y=this.$FBRTCMessageSender5(w,j.PayloadType.ICE_CANDIDATE);y.sdp_mid=x.sdpMid;y.label=x.sdpMLineIndex;y.sdp=x.candidate;this.$FBRTCMessageSender4(v,y);};u.prototype.sendHangup=function(v,w,x,y,z){'use strict';var aa=this.$FBRTCMessageSender5(w,j.PayloadType.HANGUP);aa.reason=j.callEndReasonString(x);aa.subreason=z||'';this.$FBRTCMessageSender4(v,aa,y);};u.prototype.sendOtherDismiss=function(v){'use strict';var w=this.$FBRTCMessageSender5(v,j.PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(h.getID(),w);};u.prototype.sendOfferAck=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.OFFER_ACK);};u.prototype.sendOfferNack=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.OFFER_NACK,new n([['error_code',1356043]]));};u.prototype.sendAnswerAck=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.ANSWER_ACK);};u.prototype.sendAck=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.ACK,new n([['ack_type',x.type]]));};u.prototype.sendMuteStateUpdate=function(v,w,x){'use strict';var y=this.$FBRTCMessageSender5(w,j.PayloadType.SET_VIDEO);y.videoon=x;this.$FBRTCMessageSender4(v,y);};u.prototype.sendVideoEscalationRequest=function(v,w,x){'use strict';return this.sendVideoRequestResponse(v,w,0,x);};u.prototype.sendVideoRequestResponse=function(v,w,x,y){'use strict';var z=this.$FBRTCMessageSender5(w,j.PayloadType.VIDEO_REQUEST);z.ack_id=x;z.videoon=y;z.capability=p.getCapabilities();this.$FBRTCMessageSender4(v,z);return z;};u.prototype.sendMsgAck=function(){'use strict';};u.prototype.sendOk=function(){'use strict';};u.prototype.sendPranswer=function(){'use strict';};u.prototype.sendIcerestartAnswer=function(){'use strict';};u.prototype.$FBRTCMessageSender5=function(v,w){'use strict';var x=l.generateRandomInt(),y={version:t,type:w,call_id:v,msg_id:x};if(this.$FBRTCMessageSender7(w))y.supports_video_interop=true;return y;};u.prototype.$FBRTCMessageSender7=function(v){'use strict';if(p.isVideoInteropSupported())return (v===j.PayloadType.OFFER||v===j.PayloadType.ANSWER||v===j.PayloadType.PRANSWER||v===j.PayloadType.ICERESTART_OFFER||v===j.PayloadType.ICERESTART_ANSWER||v===j.PayloadType.PCRESTART_OFFER||v===j.PayloadType.PCRESTART_ANSWER||v===j.PayloadType.SDP_UPDATE||v===j.PayloadType.SET_VIDEO||v===j.PayloadType.VIDEO_REQUEST);return false;};u.prototype.$FBRTCMessageSender3=function(v,w){'use strict';this.$FBRTCMessageSender4(v,w,false,true,true);};u.prototype.$FBRTCMessageSender6=function(v,w,x,y){'use strict';var z=arguments[4]||new n(),aa=this.$FBRTCMessageSender5(w,y);aa.ack_id=x.msg_id;if(x.flag===1)aa.flag=1;z.forEach(function(ba,ca,da){aa[ca]=ba;});this.$FBRTCMessageSender4(v,aa);};u.prototype.$FBRTCMessageSender4=function(v,w,x,y,z){'use strict';var aa=w.msg_id,ba={peer_id:v,call_id:w.call_id,msg_id:aa,msg_type:w.type},ca={call_id:w.call_id,msg_id:aa,user_id:h.getID(),recipient_id:v,msg_type:w.type,app_id:256281040558,app_version:String(o.revision||'dev'),op:'sendServerRequest:'+w.type,policy:'WebRTC'},da=m.requestReceive('browser',String(o.revision||'dev'),ca),ea=(l.isCollabCallable(v)?r:q).getURIBuilder().setInt('recipient_id',v).setInt('msg_id',aa).setString('message_info',JSON.stringify(w)).setInt('webrtc_fbtrace',da.isOn()?1:0).getURI();if(y)var fa=this.$FBRTCMessageSender4.bind(this,v,w,x,false,z);var ga=this.$FBRTCMessageSender8.bind(this,ba),ha=this.$FBRTCMessageSender9.bind(this,ba,fa,z);m.withDefaultNode(da,function(){l.sendServerRequest(ea,ga,ha,x);});if(this.onMessageSent)this.onMessageSent(v,w);this.$FBRTCMessageSender1.logSentMessage(v,w.call_id,w);};u.prototype.$FBRTCMessageSender8=function(v){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(v.peer_id,v.call_id,v.msg_type,v.msg_id);};u.prototype.$FBRTCMessageSender9=function(v,w,x,y){'use strict';if(y)var z=y.getError?y.getError():y;this.$FBRTCMessageSender1.logSentMessageFailure(v.peer_id,v.call_id,v.msg_type,v.msg_id,z);var aa=null;if(z===1356001||z===1356049){aa=j.CallEndReason.NO_PERMISSION;}else if(z===1356046||z===1356045){aa=j.CallEndReason.CALLER_NOT_VISIBLE;}else if(z===1356003||z===1356002||z===1356044)aa=j.CallEndReason.OTHER_NOT_CAPABLE;if(!aa&&w){w();return;}if(x&&this.onSendFailure){if(!aa)aa=j.CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(aa,z,v.msg_type);}};f.exports=u;},null);
__d("XVideoCallTurnDiscoveryController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});},null,{});
__d('FBRTCTurnDiscovery',['FBRTCLogger','FBRTCUtils','XVideoCallTurnDiscoveryController','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=3,m={requestTurnCreds:function(n,o){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(o===undefined)o=l;var p=1,q=j.getURIBuilder().setInt('version',p).getURI();i.sendServerRequest(q,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,n,o));},_onServerRequestSuccess:function(n){this._turnCreds=n.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(n,o,p){if(o>0){h.getInstance().logError(n.peerID,n.callID,'Failed turn; going to retry');this.requestTurnCreds(n,o-1);}else this.emit('failed');}};k(m,{receivedTurnCreds:true,failed:true});f.exports=m;},null);
__d('FBRTCStreamTester',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=100,k=30;function l(m){'use strict';if(!m)m={};this.$FBRTCStreamTester1=m.retries||k;this.$FBRTCStreamTester2=m.testInterval||j;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false;}l.prototype.testStream=function(m,n){'use strict';this.$FBRTCStreamTester3=m;if(!n){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement('video');this.$FBRTCStreamTester4.muted=true;i.attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play();}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=n;}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1);};l.prototype.$FBRTCStreamTester6=function(m){'use strict';if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit('streamWorking');}else if(m<1){this.$FBRTCStreamTester7();this.emit('streamBroken');}else setTimeout(this.$FBRTCStreamTester6.bind(this,m-1),this.$FBRTCStreamTester2);};l.prototype.$FBRTCStreamTester7=function(){'use strict';if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null;};h(l,{streamWorking:true,streamBroken:true});f.exports=l;},null);
__d('FBRTCUserMediaRequest',['FBRTCStruct','UserAgent','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=720,l=480,m=180,n=30,o=15,p=function(){return !!navigator.mediaDevices&&i.isBrowser('Firefox >= 38');},q=function(x,y,z){var aa=x===v.SCREEN_SHARING;return {audio:r(aa,y),video:s(x,z)};},r=function(x,y){if(x&&navigator.webkitGetUserMedia)return false;if(!y)return true;return {optional:[{sourceId:y}]};},s=function(x,y){if(x===v.NO_VIDEO)return false;if(x===v.SCREEN_SHARING&&y)return {mandatory:{chromeMediaSource:'desktop',chromeMediaSourceId:y,minHeight:720,maxHeight:1080,minWidth:1280,maxWidth:1920,minFrameRate:n,maxFrameRate:n}};var z,aa;switch(x){case v.HD_VIDEO:z=k;aa=n;break;case v.LQ_VIDEO:z=m;aa=o;break;default:z=l;aa=n;break;}if(p())return t(z,aa,y);var ba={mandatory:{},optional:[{minHeight:z},{maxHeight:z},{minFrameRate:aa},{maxFrameRate:aa},{googLeakyBucket:true}]};if(y)ba.optional.push({sourceId:y});return ba;},t=function(x,y,z){return {height:{min:m,max:k,ideal:x},width:{min:320,max:1280,ideal:x*16/9},frameRate:{min:10,max:30,ideal:y}};},u=function(x,y,z){if(p()){navigator.mediaDevices.getUserMedia(x).then(y)['catch'](z);}else if(navigator.getUserMedia){navigator.getUserMedia(x,y,z);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(x,y,z);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(x,y,z);}else if(navigator.msGetUserMedia)navigator.msGetUserMedia(x,y,z);},v=new h(['NO_VIDEO','LQ_VIDEO','SD_VIDEO','HD_VIDEO','SCREEN_SHARING']);function w(x){'use strict';if(x===undefined)x=v.SD_VIDEO;this.streamType=x;this.audioSource=null;this.videoSource=null;}w.prototype.request=function(){'use strict';var x=q(this.streamType,this.audioSource,this.videoSource);u(x,(function(y){this.emit('success',y);}).bind(this),(function(y){this.emit('failed',y);}).bind(this));};w.STREAM_TYPE=v;w.HD_HEIGHT=k;w.SD_HEIGHT=l;w.LQ_HEIGHT=m;j(w,{success:true,failed:true});f.exports=w;},null);
__d('FBRTCUserMedia',['mixInEventEmitter','FBRTCLogger','FBRTCStreamTester','FBRTCUserMediaRequest'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l={STREAM_TYPE:k.STREAM_TYPE,_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function(m,n,o){if(this._localStream&&!n&&!o){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new k(m);this._pendingRequest.audioSource=n;this._pendingRequest.videoSource=o;this._pendingRequest.addListener('success',this._onRequestSuccess,this);this._pendingRequest.addListener('failed',this._onRequestFailure,this);this._pendingRequest.request();}},end:function(){this._stopEventListeners();if(this._localStream){this._localStream.stop();this._localStream=null;}},_startRequestListeners:function(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function(){this._promptTimeout=setTimeout((function(){if(!this._accessGranted&&this._pendingRequest)this._pendingRequest.request();}).bind(this),1500);},_onRequestSuccess:function(m){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}m.videoMediaSourceId=this._pendingRequest.videoSource;m.audioMediaSourceId=this._pendingRequest.audioSource;var n=new j();n.addListener('streamWorking',(function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==m)this._localStream.stop();this._localStream=m;this.emit('streamReady',this._localStream);}).bind(this));n.addListener('streamBroken',(function(){m.stop();this._onRequestFailure('StreamFailedToStart');}).bind(this));n.testStream(m);},_onRequestFailure:function(m){this._stopEventListeners();var n=this._getErrorName(m);if(this._shouldRetryRequest(n,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,n);return;}if(n==='InvalidStateError'){i.getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(n==='PERMISSION_DENIED'||n==='PermissionDeniedError'||n==='PermissionDismissedError'){this.emit('accessDenied',n);}else{if(n==='NO_DEVICES_FOUND')n='DevicesNotFoundError';i.getInstance().logErrorWithoutID('getUserMedia error: '+n);this.emit('accessFailed',n);}},_getErrorName:function(m){if(m.name)return m.name;return m;},_shouldRetryRequest:function(m,n){return n.streamType!==this.STREAM_TYPE.NO_VIDEO&&(m==='DevicesNotFoundError'||m==='StreamFailedToStart');},_configureRequestForRetry:function(m,n){if(n==='StreamFailedToStart'&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(m.videoSource)this._failedVideoSources.push(m.videoSource);window.MediaStreamTrack.getSources((function(o){for(var p=0;p<o.length;p++){var q=o[p];if(q.kind==='video'&&this._failedVideoSources.indexOf(q.id)===-1){m.videoSource=q.id;m.request();return;}}m.streamType=this.STREAM_TYPE.NO_VIDEO;m.request();}).bind(this));}else{m.streamType=this.STREAM_TYPE.NO_VIDEO;m.request();}}};h(l,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=l;},null);
__d('FBRTCRingback',['RTCConfig','Sound','FBRTCCallModel'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=[h.ringback_mp3_url,h.ringback_ogg_url],l={monitorCallModel:function(m){if(this._subscription)this._subscription.remove();this._callModel=m;this._subscription=m.addListener(this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===j.UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){i.play(k,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){i.stop(k);this._soundIsPlaying=false;}}};f.exports=l;},null);
__d('FBRTCScreenStreamWrapper',['FBRTCStreamWrapper'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;'use strict';i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.toggleMuteAudio=function(){return;};k.prototype.toggleMuteVideo=function(){return;};function k(){i.apply(this,arguments);}f.exports=k;},null);
__d('FBRTCVideo.react',['React','ReactDOM','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.createClass({displayName:'FBRTCVideo',hideContextMenu:function(m){m.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(m,n){return this._streamDidChange();},componentDidUpdate:function(m,n){this._attachStream();},_attachStream:function(){if(this.props.stream){var m=i.findDOMNode(this);this.props.stream.attachToVideoTag(m);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var m=this.props.stream?this.props.stream.getStream():null;return m!==this._currentStream;},render:function(){return (h.createElement('video',{className:k(this.props.className,"_4bad"),autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});f.exports=l;},null);
__d('FBRTCScreenSharingView.react',['FBRTCConstants','FBRTCScreenStreamWrapper','FBRTCVideo.react','React','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=k.PropTypes,o=k.createClass({displayName:'FBRTCScreenSharingView',propTypes:{isStandalone:n.bool,publishFn:n.func,screenStream:n.instanceOf(i),screenSrc:n.string},getDefaultProps:function(){return {isStandalone:false,publishFn:m};},render:function(){var p=this.props.isStandalone,q=this.props.screenStream,r=this.props.screenSrc;if(q&&q.hasStream()){return (k.createElement('div',{className:this._baseClasses()},this._renderOpenInNewButton(),k.createElement('div',{className:this._wrapperClass()},k.createElement(j,{stream:q}))));}else if(p&&r){return this._renderStandalone(r);}else return k.createElement('div',{className:"_2uql"});},_baseClasses:function(){return "_2uqm"+(this.props.isStandalone?' '+"_2uqn":'');},_buttonClasses:function(){return "_2uqo";},_buttonIconClasses:function(){return "_2uqp";},_wrapperClass:function(){return "_2uqq";},_renderOpenInNewButton:function(){if(!this.props.isStandalone)return (k.createElement('button',{className:this._buttonClasses(),onClick:this._openInNewWindow},k.createElement('i',{className:this._buttonIconClasses()})));},_openInNewWindow:function(p){if(this.props.publishFn)this.props.publishFn(h.UIEventType.OPEN_SCREEN_IN_NEW);},_renderStandalone:function(p){return (k.createElement('div',{className:this._baseClasses()},k.createElement('div',{className:this._wrapperClass()},k.createElement('video',{className:"_4bad",autoPlay:'true',muted:false,onContextMenu:function(q){q.preventDefault();},src:decodeURIComponent(p)}))));}});f.exports=o;},null);
__d("XScreenSharingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true}});},null,{});
__d('FBRTCScreenSharingUI',['FBRTCDispatcher','FBRTCScreenSharingUtils','FBRTCScreenSharingView.react','React','ReactDOM','XScreenSharingController'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=null,o=false,p={open:function(q){var r=this._windowPosition(),s=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',r.height,r.width,r.top,r.left].join(','),t=this._getUnsignedUri(q);n=window.open(t,'Screen Sharing',s);if(n){h.dispatch({type:i.ActionTypes.OPEN_IN_NEW});if(window.focus)n.focus();this._renderView(q,5);}},close:function(){if(n){var q=null;if(n.opener&&!n.opener.closed)q=n.opener;n.close();n=null;if(q)q.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},isOpen:function(){return n!==null;},_onUnload:function(q){p.close();h.dispatch({type:i.ActionTypes.WINDOW_CLOSED});},_renderView:function(q,r){setTimeout((function(){setTimeout((function(){if(n!==null){var s='FBRTCScreenSharingView/container',t=n.document.getElementById(s);if(t){l.render(k.createElement(j,{isStandalone:true,screenStream:q.getRemoteScreenStream()}),t);o=true;n.onunload=this._onUnload;}}}).bind(this),1);if(r>1&&!o)this._renderView(q,r-1);}).bind(this),500);},_windowPosition:function(){var q=screen.availLeft,r=screen.availTop,s=Math.min(960,screen.width-q),t=Math.min(540,screen.height-r);return {height:'height='+t.toString(),width:'width='+s.toString(),top:'top='+r.toString(),left:'left='+q.toString()};},_getUnsignedUri:function(q){return m.getURIBuilder().setInt('peer_id',q.peerID).getURI();}};f.exports=p;},null);
__d('FBRTCStarRatingActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j=i({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),k={Types:j,submitRating:function(l){h.dispatch({type:j.SUBMIT_RATING,rating:l});},submitFeedback:function(l){h.dispatch({type:j.SUBMIT_FEEDBACK,feedback:l});},ratingShown:function(){h.dispatch({type:j.RATING_SHOWN});},feedbackShown:function(){h.dispatch({type:j.FEEDBACK_SHOWN});}};f.exports=k;},null);
__d('FBRTCStarRatingStore',['FBRTCLogger','FBRTCStore','FBRTCStarRatingActions'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=babelHelpers.inherits(m,i);l=k&&k.prototype;function m(n,o){l.constructor.call(this);this.$FBRTCStarRatingStore1=n;this.$FBRTCStarRatingStore2=o;}m.prototype.setCallSummary=function(n){this.$FBRTCStarRatingStore1=n;};m.prototype.__onDispatch=function(n){switch(n.type){case j.Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(n.rating);break;case j.Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(n.feedback);break;case j.Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break;}};m.prototype.$FBRTCStarRatingStore3=function(n){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.RATING,n);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};m.prototype.$FBRTCStarRatingStore4=function(n){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.SURVEY_DETAILS,n);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};m.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.RATING_SHOWN,'1');this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};f.exports=m;},null);
__d('FBRTCViewController',['FBRTCCallModel','FBRTCConstants','FBRTCLogger','FBRTCRingback','FBRTCScreenSharingUI','FBRTCStarRatingStore'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=500;function o(p,q,r){'use strict';this.$FBRTCViewController1=p;this.$FBRTCViewController2=new m(q,r);this.$FBRTCViewController3=false;this.$FBRTCViewController4=j.getInstance();}o.prototype.init=function(){'use strict';k.monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo();};o.prototype.onLocalStreamReady=function(p){'use strict';this.$FBRTCViewController1.setLocalStream(p);if(this.$FBRTCViewController1.uiState>h.UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller){this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);}else this.$FBRTCViewController1.setState(h.UIState.MORE_INIT);};o.prototype.waitForUserInput=function(){'use strict';this.$FBRTCViewController1.setStateFrom(h.UIState.INIT,h.UIState.AWAITING_USER_START);};o.prototype.userMediaRequested=function(){'use strict';setTimeout((function(){this.$FBRTCViewController1.setStateFrom(h.UIState.INIT,h.UIState.PENDING_LOCAL_MEDIA);}).bind(this),n);};o.prototype.userMediaGranted=function(){'use strict';this.$FBRTCViewController1.setState(h.UIState.MORE_INIT);};o.prototype.userMediaDenied=function(){'use strict';this.$FBRTCViewController1.setState(h.UIState.USER_MEDIA_DENIED);};o.prototype.onTurnCredentialsReady=function(p){'use strict';if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(h.UIState.MORE_INIT,h.UIState.CALL_CONNECTING);};o.prototype.onMessageTypeSent=function(p){'use strict';if(p!==i.PayloadType.OFFER&&p!==i.PayloadType.PCRESTART_OFFER)return;if(p===i.PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(p===i.PayloadType.OFFER)this.$FBRTCViewController1.setState(h.UIState.CONTACTING);};o.prototype.onMessageTypeReceived=function(p){'use strict';if(this.$FBRTCViewController3){if(p===i.PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(h.UIState.CONTACTING,h.UIState.CALL_CONNECTING);}else if(p===i.PayloadType.OFFER_ACK){this.$FBRTCViewController1.setStateFrom(h.UIState.CONTACTING,h.UIState.RINGING);}else if(p===i.PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===h.UIState.CONTACTING||this.$FBRTCViewController1.uiState===h.UIState.RINGING)this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);};o.prototype.onRemoteStreamAdded=function(event){'use strict';this.$FBRTCViewController1.setRemoteStream(event.stream);};o.prototype.end=function(p,q){'use strict';this.$FBRTCViewController1.endCallReason=p;this.$FBRTCViewController1.isRemoteEnded=q;this.$FBRTCViewController1.setState(h.UIState.CALL_ENDED);};o.prototype.reset=function(p,q){'use strict';this.$FBRTCViewController1.resetForReconnect(p);this.$FBRTCViewController2.setCallSummary(q);this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);};o.prototype.publish=function(p,q){'use strict';switch(p){case i.UIEventType.TOGGLE_SELF_VIEW:this.$FBRTCViewController5(q);break;case i.UIEventType.START_CALL:if(this.onStartCall)this.onStartCall(j.Trigger.POPUP_CALL_START_BUTTON);break;case i.UIEventType.OPEN_SCREEN_IN_NEW:this.$FBRTCViewController6();break;default:break;}};o.prototype.$FBRTCViewController5=function(p){'use strict';this.$FBRTCViewController1.toggleSelfView();};o.prototype.$FBRTCViewController6=function(){'use strict';l.open(this.$FBRTCViewController1);};o.prototype.$FBRTCViewController7=function(p,q){'use strict';this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,p,q?'true':'false');};f.exports=o;},null);
__d('FBRTCCallModelStatePusher',['FBRTCCallModel','FBRTCConstants','FBRTCDispatcher','FBRTCStarRatingActions'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=30000,m=10000;function n(o){'use strict';this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=o;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));j.register(this.$FBRTCCallModelStatePusher4.bind(this));}n.prototype.$FBRTCCallModelStatePusher5=function(){'use strict';return this.$FBRTCCallModelStatePusher2.uiState===h.UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===i.CallEndReason.HANGUP_CALL;};n.prototype.$FBRTCCallModelStatePusher3=function(){'use strict';if(this.$FBRTCCallModelStatePusher2.uiState===h.UIState.CALL_ENDED){if(this.$FBRTCCallModelStatePusher5()){this.$FBRTCCallModelStatePusher6(3000,h.UIState.CALL_ENDED,h.UIState.COLLECT_RATING);}else this.$FBRTCCallModelStatePusher7(m);}else if(this.$FBRTCCallModelStatePusher2.uiState===h.UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(l);};n.prototype.$FBRTCCallModelStatePusher4=function(o){'use strict';if(o.type===k.Types.FEEDBACK_SHOWN)this.$FBRTCCallModelStatePusher8();};n.prototype.$FBRTCCallModelStatePusher7=function(o){'use strict';this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close();},o);};n.prototype.$FBRTCCallModelStatePusher8=function(){'use strict';clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null;};n.prototype.$FBRTCCallModelStatePusher6=function(o,p,q){'use strict';var r=this.$FBRTCCallModelStatePusher2;setTimeout(function(){r.setStateFrom(p,q);},o);};f.exports=n;},null);
__d('FBRTCDialog.react',['MessengerDialog.react','XUIDialog.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogBody.react',['MessengerDialogBody.react','XUIDialogBody.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogFooter.react',['MessengerDialogFooter.react','XUIDialogFooter.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogTitle.react',['FBRTCConfig','MessengerDialogTitle.react','MessengerDialogHeader.react','ReactComponentWithPureRenderMixin','React','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=l.PropTypes,o=l.createClass({displayName:'FBRTCDialogTitle',mixins:[k],propTypes:{showCloseButton:n.bool.isRequired},render:function(){var p=this.props,q=p.className,r=p.showCloseButton,s=babelHelpers.objectWithoutProperties(p,['className','showCloseButton']);if(h.isMessengerDotCom())return (l.createElement(j,null,l.createElement(i,babelHelpers._extends({className:q,showCloseButton:r},s),this.props.children)));return (l.createElement(m,babelHelpers._extends({className:q,showCloseButton:r},s),this.props.children));}});f.exports=o;},null);
__d('FBRTCAudioSpectrumAnalyser.react',['React','ReactDOM','cancelAnimationFrame','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=7,m=3,n=9,o='#3B5998',p='#CCCCCC',q=function(t,u,v,w){var x=w?p:o;u+=m;v-=m;t.beginPath();t.arc(u,v,m,0,2*Math.PI,false);t.fillStyle=x;t.strokeStyle=x;t.fill();},r=function(t,u,v){var w,x,y=u.width/n,z=Math.floor(u.height/l),aa=new Uint8Array(2048);t.getByteFrequencyData(aa);v.clearRect(0,0,u.width,u.height);var ba=Math.floor(aa.length/(n*3));for(var ca=0;ca<n;ca+=1){w=0;for(var da=0;da<ba;da+=1)w+=aa[ca*ba+da];x=w*l/(ba*256);if(x<1)x=.6;for(var ea=0;ea<Math.floor(x);ea++)q(v,ca*y,u.height-ea*z);if(x-Math.floor(x)>=.5)q(v,ca*y,u.height-ea*z,true);}},s=h.createClass({displayName:'FBRTCAudioSpectrumAnalyser',_isAnimating:false,_animationLoop:null,componentDidMount:function(){this._startAnimation();},componentWillUnmount:function(){this._stopAnimation();},shouldComponentUpdate:function(t,u){return this._streamDidChange();},componentDidUpdate:function(t,u){this._stopAnimation();this._startAnimation();},_streamDidChange:function(){var t=this.props.stream?this.props.stream.getStream():null;return t!==this._currentStream;},_stopAnimation:function(){this._isAnimating=false;j(this._animationLoop);},_startAnimation:function(){var t=this.props.stream.getAudioAnalyser();if(!this._isAnimating&&t){this._isAnimating=true;var u=i.findDOMNode(this),v=u.getContext('2d');this._animate(t,u,v);}},render:function(){return h.createElement('canvas',{width:'106',height:'80'});},_animate:function(t,u,v){this._animationLoop=k((function(){if(!this._isAnimating)return;r(t,u,v);this._animate(t,u,v);}).bind(this));}});f.exports=s;},null);
__d('FBRTCUserSettings',['mixInEventEmitter','FBRTCConfig','FBRTCUserMediaRequest','FBRTCStreamWrapper'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=window.MediaStreamTrack,m=null,n={stream:new k(),audioSources:[],videoSources:[],selectedCamera:null,savedCamera:null,selectedMic:null,savedMic:null,isLoading:false,_cameraLabel:null,_micLabel:null,isEnabled:function(){return i.settingsEnabled()&&l&&!!l.getSources;},isDirty:function(){return this.savedCamera!==this.selectedCamera||this.savedMic!==this.selectedMic;},refresh:function(){if(l&&l.getSources){l.getSources((function(o){for(var p=0;p<o.length;p++){var q=o[p];if(q.kind==='audio')this.audioSources.push(q);if(q.kind==='video')this.videoSources.push(q);}this._refreshSelectedOptions();this._getUserMedia();this.isLoading=false;this._scheduleChangeEvent();}).bind(this));this.isLoading=true;this.audioSources=[];this.videoSources=[];}this._scheduleChangeEvent();},cleanUp:function(){this.selectedMic=this.savedMic;this.selectedCamera=this.savedCamera;this.stream.stopStream();},_refreshSelectedOptions:function(){if(this.selectedMic===null)if(this.savedMic){this.selectedMic=this.savedMic;}else if(this.audioSources.length>0){for(var o=0;o<this.audioSources.length;o++)if(this._micLabel&&this._micLabel===this.audioSources[o].label){this.selectedMic=this.audioSources[o].id;break;}if(!this.selectedMic)this.selectedMic=this.audioSources[0].id;this.savedMic=this.selectedMic;}if(this.selectedCamera===null)if(this.savedCamera){this.selectedCamera=this.savedCamera;}else if(this.videoSources.length>0){for(var p=0;p<this.videoSources.length;p++)if(this._cameraLabel&&this._cameraLabel===this.videoSources[p].label){this.selectedCamera=this.videoSources[p].id;break;}if(!this.selectedCamera)this.selectedCamera=this.videoSources[0].id;this.savedCamera=this.selectedCamera;}},save:function(){this.savedMic=this.selectedMic;this.savedCamera=this.selectedCamera;this.emit('saved');this.cleanUp();},selectCameraOption:function(o){this.selectedCamera=o;this._scheduleChangeEvent();this._getUserMedia();},selectMicOption:function(o){this.selectedMic=o;this._scheduleChangeEvent();this._getUserMedia();},updateForLocalStream:function(o){if(o.videoMediaSourceId){this.savedCamera=o.videoMediaSourceId;}else{var p=o.getVideoTracks()[0];if(p)this._cameraLabel=p.label;}if(o.audioMediaSourceId){this.savedMic=o.audioMediaSourceId;}else{var q=o.getAudioTracks()[0];if(q)this._micLabel=q.label;}},_scheduleChangeEvent:function(){if(m!==null)clearTimeout(m);m=setTimeout((function(){this.emit('changed');m=null;}).bind(this),50);},_getUserMedia:function(){var o=new j();o.videoSource=this.selectedCamera;o.audioSource=this.selectedMic;o.addListener('success',this._gumSuccess,this);o.addListener('failed',this._gumFailed,this);o.request();},_gumSuccess:function(o){this.stream.setStream(o);this._scheduleChangeEvent();},_gumFailed:function(o){}};h(n,{changed:true,saved:true});f.exports=n;},null);
__d('FBRTCSettingsDialog.react',['React','cx','fbt','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','XUIDialogSaveButton.react','XUIDialogCancelButton.react','XUIGrayText.react','XUISelector.react','FBRTCAudioSpectrumAnalyser.react','FBRTCConfig','FBRTCUserSettings','FBRTCVideo.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=s.Option,y=function(aa){var ba=[],ca=0;for(var da=0;da<aa.length;da++){var ea=aa[da],fa=ea.label;if(!fa){var ga=ea.kind==='audio'?'Microphone':'Camera';fa=j._({"Camera":"Camera{number}","Microphone":"Microphone{number}"},[j['enum'](ga,{Camera:'Camera',Microphone:'Microphone'}),j.param('number',++ca)]);}ba.push(h.createElement(x,{value:ea.id,key:ea.id},fa));}return ba;},z=h.createClass({displayName:'FBRTCSettingsDialog',componentDidMount:function(){this._renderSubscription=v.addListener('changed',(function(){this.forceUpdate();}).bind(this));v.refresh();},componentWillUnmount:function(){this._renderSubscription.remove();v.cleanUp();},render:function(){return (h.createElement(l,{width:365,shown:true,onToggle:this.props.onToggle},h.createElement(o,{showCloseButton:true},h.createElement('span',null,j._("Settings"))),h.createElement(m,null,this._dialogBody()),h.createElement(n,{leftContent:this._helpLink()},h.createElement(q,null),h.createElement(p,{use:'confirm',disabled:!v.isDirty(),onClick:this._onConfirmClicked}))));},_dialogBody:function(){if(v.isLoading)return h.createElement('div',{className:"_48fc"});return (h.createElement('div',{className:"_48fc"},this._cameraOptions(),this._microphoneOptions(),h.createElement(r,{shade:'light'},j._("Tip: Try restarting your browser if you're having trouble with your camera or microphone."))));},_cameraOptions:function(){if(v.videoSources.length<1)return null;return (h.createElement('div',{className:"_48fd"},h.createElement(r,{display:'block',size:'medium',shade:'medium',className:"_48fe"},j._("Camera")),h.createElement(s,{name:'camera_selection',onChange:this._onCamSelectionChanged,defaultValue:v.selectedCamera,width:'200px'},y(v.videoSources)),h.createElement('div',{className:"_48ff"},h.createElement(w,{stream:v.stream,muted:true,className:"_48fg"}))));},_microphoneOptions:function(){if(v.audioSources.length<1)return null;return (h.createElement('div',{className:"_48fd"},h.createElement(r,{display:'block',size:'medium',shade:'medium',className:"_48fe"},j._("Microphone")),h.createElement(s,{name:'microphone_selection',onChange:this._onMicSelectionChanged,defaultValue:v.selectedMic,width:'200px'},y(v.audioSources)),h.createElement('div',{className:"_48fh"},h.createElement(t,{stream:v.stream}))));},_onCamSelectionChanged:function(aa){v.selectCameraOption(aa.value);},_onMicSelectionChanged:function(aa){v.selectMicOption(aa.value);},_onConfirmClicked:function(aa){v.save();},_helpLink:function(){return (h.createElement('div',null,h.createElement(r,{shade:'light'},h.createElement(k,{href:u.userMediaErrorUrl(),target:'_blank'},j._("Get help")))));}});f.exports=z;},null);
__d('FBRTCMediaAccessErrorDialog.react',['React','fbt','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=h.createClass({displayName:'FBRTCMediaAccessErrorDialog',render:function(){return (h.createElement(k,{shown:true,width:440,layerHideOnBlur:false},h.createElement(n,{showCloseButton:false},h.createElement('span',null,i._("Can't Make Call"))),h.createElement(l,null,this._dialogBody()),h.createElement(m,{leftContent:this._footerContent()})));},_dialogBody:function(){return (h.createElement('p',null,i._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone.")));},_footerContent:function(){return (h.createElement('span',null,i._("Still need help? See our {troubleShootingGuideLink}",[i.param('troubleShootingGuideLink',h.createElement(j,{href:o.userMediaErrorUrl(),target:'_blank'},i._("Troubleshooting Guide")))])));}});f.exports=p;},null);
__d('FBRTCPeerBrowserUnsupportedDialog.react',['React','fbt','Link.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=h.createClass({displayName:'FBRTCPeerBrowserUnsupportedDialog',render:function(){return (h.createElement(k,{shown:true,width:440},h.createElement(n,{showCloseButton:false},h.createElement('span',null,i._("Can't Connect Call"))),h.createElement(l,null,this._dialogBody()),h.createElement(m,{leftContent:this._footerContent()})));},_dialogBody:function(){var q=this.props.peerName;return (h.createElement('p',null,i._("{name} isn't using a browser that supports video calling yet.",[i.param('name',q)])));},_footerContent:function(){return (h.createElement('span',null,i._("Still need help? See our {troubleShootingGuideLink}",[i.param('troubleShootingGuideLink',h.createElement(j,{href:o.unsupportedBrowserUrl(),target:'_blank'},i._("Troubleshooting Guide")))])));}});f.exports=p;},null);
__d('FBRTCScreenSharingUnsupportedBrowserDialog.react',['React','Image.react','Link.react','Layout.react','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','XUIText.react','FBRTCVersionDetection','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();'use strict';var t=k.Column,u=h.createClass({displayName:'FBRTCScreenSharingUnsupportedBrowserDialog',render:function(){return (h.createElement(l,{shown:true,width:440,layerHideOnBlur:false},h.createElement(n,{showCloseButton:true},this._title()),h.createElement(m,null,this._dialogBody(),this._installLinks())));},_title:function(){var v=null;if(p.isChrome()){v=r._("Update Browser to Share Your Screen");}else v=r._("Switch Browsers to Share Your Screen");return (h.createElement('span',null,v));},_dialogBody:function(){var v=null;if(p.isChrome()){v=this._updateBrowserMessage();}else v=this._switchBrowserMessage();return (h.createElement('p',null,v));},_updateBrowserMessage:function(){return r._("Screen sharing doesn't work in the older version of Google Chrome you're using. To share your screen, please update Google Chrome.");},_switchBrowserMessage:function(){if(p.isFirefox()){return r._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");}else return r._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.");},_installLinks:function(){return (h.createElement(k,null,h.createElement(t,{style:{width:'100%',textAlign:'center'}},h.createElement(j,{href:'https://www.google.com/chrome/index.html',target:'_blank'},h.createElement(i,{className:"_4_if",src:s('/images/chat/webrtc/chrome.png'),alt:'Chrome',width:'64'}),h.createElement(o,{display:'block'},'Google Chrome')))));}});f.exports=u;},null);
__d('FBRTCScreenSharingInstallExtensionDialog.react',['React','FBRTCCallControlActions','FBRTCLogger','FBRTCScreenSharingLogger','LinkshimCallsites','ScreenSharingWebDriverIDs','URI','FBRTCDialogFooter.react','Link.react','LinkshimLink.react','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();'use strict';var x=h.PropTypes,y='https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm',z=h.createClass({displayName:'FBRTCScreenSharingInstallExtensionDialog',propTypes:{onToggle:x.func.isRequired,peerID:x.number.isRequired,sessionID:x.number.isRequired},componentDidMount:function(){k.getInstance().logAction(this.props.peerID,this.props.sessionID,k.Action.SCREEN_SHARING_EXT_DIALOG);},render:function(){return (h.createElement(r,{shown:true,width:440,layerHideOnBlur:false},h.createElement(v,{showCloseButton:true},h.createElement('span',null,w._("Please Install Screen Sharing Extension"))),h.createElement(s,{'data-testid':m.INSTALL_EXT_DIALOG},this._dialogBody()),h.createElement(o,null,h.createElement(u,null),h.createElement(t,{label:w._("Call Again"),use:'confirm',onClick:this._onResetCall}))));},_dialogBody:function(){return (h.createElement('div',null,h.createElement('p',null,w._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),h.createElement(q,{uri:new n(y),callsite:l.THIRD_PARTY_URL,target:'_blank',onClick:this._onExtLinkClick},w._("Install Screen Sharing Extension"))));},_onExtLinkClick:function(){k.getInstance().logAction(this.props.peerID,this.props.sessionID,k.Action.SCREEN_SHARING_EXT_LINK);},_onResetCall:function(){i.resetCall(j.Trigger.RESET_CALL);}});f.exports=z;},null);
__d('FBRTCVideoEscalationDialog.react',['FBRTCCallControlActions','React','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=i.PropTypes,p=i.createClass({displayName:'FBRTCVideoEscalationDialog',propTypes:{peerName:o.string.isRequired,hideDialog:o.func.isRequired},render:function(){var q=this.props.peerName;return (i.createElement(j,{layerHideOnBlur:false,shown:true,width:440},i.createElement(k,null,i.createElement('p',null,n._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[n.param('name',q)]))),i.createElement(m,null,i.createElement(l,{action:'cancel',label:n._("Decline"),onClick:this._onDeclineClicked}),i.createElement(l,{action:'confirm',label:n._("Accept"),onClick:this._onAcceptClicked,use:'confirm'}))));},_onDeclineClicked:function(q){h.declineEscalation();},_onAcceptClicked:function(q){this.props.hideDialog();h.acceptEscalation();}});f.exports=p;},null);
__d('FBRTCCallDialogController',['FBRTCSettingsDialog.react','FBRTCStruct','FBRTCMediaAccessErrorDialog.react','FBRTCPeerBrowserUnsupportedDialog.react','FBRTCScreenSharingUnsupportedBrowserDialog.react','FBRTCScreenSharingInstallExtensionDialog.react','FBRTCUserSettings','FBRTCVideoEscalationDialog.react','React','ReactDOM','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=new i(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS','SCREEN_SHARING_UNSUPPORTED','INSTALL_SCREEN_SHARING_EXT','VIDEO_ESCALATION']),t=p.createClass({displayName:'DialogOwner',mixins:[r],renderLayers:function(){if(this.props.dialogType===s.ERROR_ACCESSING_MEDIA)return {dialog:p.createElement(j,null)};if(this.props.dialogType===s.PEER_BROWSER_UNSUPPORTED){var v=this.props.callModel.peerName();return {dialog:p.createElement(k,{peerName:v})};}if(this.props.dialogType===s.SETTINGS)return {dialog:p.createElement(h,{onToggle:this._onToggle})};if(this.props.dialogType===s.SCREEN_SHARING_UNSUPPORTED)return {dialog:p.createElement(l,{onToggle:this._onToggle})};if(this.props.dialogType===s.INSTALL_SCREEN_SHARING_EXT)return {dialog:p.createElement(m,{onToggle:this._onToggle,peerID:this.props.callModel.peerID,sessionID:this.props.callModel.callID})};if(this.props.dialogType===s.VIDEO_ESCALATION)return {dialog:p.createElement(o,{hideDialog:function(){u.hideDialog();},onToggle:this._onToggle,peerName:this.props.callModel.peerName()})};return {};},_onToggle:function(v){setTimeout(function(){if(!v)u.hideDialog();},0);},render:function(){return p.createElement('div',null);}}),u={dialogTypes:s,setDialogContainer:function(v){this.container=v;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(v,w){this.currentDialogType=v;this._setCallModel(w);this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},hideDialogType:function(v){if(v===this.currentDialogType)this.hideDialog();},_render:function(){q.render(p.createElement(t,{dialogType:this.currentDialogType,callModel:this.callModel}),this.container);},_setCallModel:function(v){if(v!==this.callModel){this.callModel=v;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this));}},_onCallModelChanged:function(){var v=[s.SETTINGS,s.SCREEN_SHARING_UNSUPPORTED,s.INSTALL_SCREEN_SHARING_EXT,s.VIDEO_ESCALATION];if(this.callModel.isEnded()&&v.indexOf(this.currentDialogType)>-1)this.hideDialog();}};n.addListener('saved',u.hideDialog,u);f.exports=u;},null);
__d('FBRTCRetriableMessage',['mixInEventEmitter','FBRTCConstants'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=10000,k=7000,l=1;function m(n){'use strict';this.$FBRTCRetriableMessage1=n;this.$FBRTCRetriableMessage2=j;this.$FBRTCRetriableMessage3=l;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}m.prototype.sendMessage=function(n,o,p,q,r){'use strict';this.$FBRTCRetriableMessage4=o;switch(n){case i.PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(o,p,q,r);break;case i.PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(o,p,q,r);break;case i.PayloadType.ANSWER:this.$FBRTCRetriableMessage2=k;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(o,p,q,r);break;}this.$FBRTCRetriableMessage7();};m.prototype.isAckMsg=function(n){'use strict';return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===n.ack_id;};m.prototype.stopRetrying=function(){'use strict';if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}};m.prototype.$FBRTCRetriableMessage7=function(){'use strict';this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2);};m.prototype.$FBRTCRetriableMessage8=function(){'use strict';if(this.$FBRTCRetriableMessage3<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1;}};h(m,{sendingRetry:true,timeoutFailure:true});f.exports=m;},null);
__d('FBRTCScreenMedia',['FBRTCDispatcher','FBRTCUserMediaRequest','keyMirror'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';var k=j({STREAM_READY:null,STREAM_FAILED:null}),l={STREAM_TYPE:i.STREAM_TYPE.SCREEN_SHARING,Types:k,requestScreenMedia:function(m){var n=new i(this.STREAM_TYPE);n.videoSource=m;n.addListener('success',this._onRequestSuccess,this);n.addListener('failed',this._onRequestFailure,this);n.request();},_onRequestSuccess:function(m){h.dispatch({type:k.STREAM_READY,stream:m});},_onRequestFailure:function(m){var n=m.name?m.name:m;h.dispatch({type:k.STREAM_FAILED,error:n});}};f.exports=l;},null);
__d('FBRTCScreenSharingModel',['FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper','FBRTCStore'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=babelHelpers.inherits(m,j);l=k&&k.prototype;function m(){l.constructor.call(this);this.$FBRTCScreenSharingModel1=null;this.$FBRTCScreenSharingModel2=new i();this.$FBRTCScreenSharingModel3=h.getInstance();}m.prototype.isEnabled=function(){return !!this.$FBRTCScreenSharingModel1;};m.prototype.setStream=function(n){var o=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(n&&!o)n.getVideoTracks()[0].onended=(function(){this.__emitChange();}).bind(this);if(this.$FBRTCScreenSharingModel2===null)this.$FBRTCScreenSharingModel2=new i();this.$FBRTCScreenSharingModel2.setStream(n,!o);};m.prototype.getStream=function(){return this.$FBRTCScreenSharingModel2;};m.prototype.onStart=function(n){if(!n){this.$FBRTCScreenSharingModel3.logToConsole(null,null,'Invalid stream id');return;}this.$FBRTCScreenSharingModel3.logToConsole(null,null,'Enabling screen sharing');this.$FBRTCScreenSharingModel1=n;};m.prototype.onStop=function(){this.$FBRTCScreenSharingModel1=null;if(this.$FBRTCScreenSharingModel2)this.$FBRTCScreenSharingModel2.stopStream();};m.prototype.__onDispatch=function(n){};f.exports=m;},null);
__d('FBRTCScreenSharingController',['FBRTCCallDialogController','FBRTCScreenSharingLogger','FBRTCScreenMedia','FBRTCScreenSharingModel','FBRTCScreenSharingUI','FBRTCScreenSharingUtils','FBRTCStore'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o,p;'use strict';o=babelHelpers.inherits(q,n);p=o&&o.prototype;function q(r,s){p.constructor.call(this);this.$FBRTCScreenSharingController1=false;this.$FBRTCScreenSharingController2=i.getInstance();this.$FBRTCScreenSharingController3=new k();this.$FBRTCScreenSharingController4=r;this.$FBRTCScreenSharingController5=s;if(m.isScreenSharingSupported()){this.$FBRTCScreenSharingController3.addListener(this.$FBRTCScreenSharingController6.bind(this));m.checkExtensionInstalled();}}q.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController1&&this.$FBRTCScreenSharingController3.isEnabled();};q.prototype.getStream=function(){return this.$FBRTCScreenSharingController3.getStream();};q.prototype.onStop=function(){this.$FBRTCScreenSharingController3.onStop();};q.prototype.onEndCall=function(){l.close();};q.prototype.setRemoteStream=function(r){if(!r){l.close();this.$FBRTCScreenSharingController3.setStream(r,true);}else this.$FBRTCScreenSharingController3.setStream(r,true);};q.prototype.toggleScreenSharing=function(r){if(!m.isSupportedBrowser()){h.showDialog(h.dialogTypes.SCREEN_SHARING_UNSUPPORTED,r);}else if(!m.isExtensionInstalled()){h.showDialog(h.dialogTypes.INSTALL_SCREEN_SHARING_EXT,r);}else{var s=this.$FBRTCScreenSharingController3.isEnabled()?'SC_CANCEL':'SC_REQUEST';window.postMessage({recipient:m.RECIPIENT,type:s,text:'toggle screen sharing'},'*');window.addEventListener('message',this.$FBRTCScreenSharingController7.bind(this));}this.$FBRTCScreenSharingController2.logAction(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,i.Action.SCREEN_SHARING_TOGGLED,'status: '+(this.isEnabled()?'enabled':'disabled'));};q.prototype.$FBRTCScreenSharingController7=function(event){if(event.origin!=window.location.origin){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'Different origin for this event, do nothing');return;}if(!event.data.recipient||event.data.recipient!='SC_DOM'){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'Wrong recipient, do nothing');return;}if(!event.data.type){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'No event type, exiting');return;}window.removeEventListener('message',this.$FBRTCScreenSharingController7.bind(this));switch(event.data.type){case 'SC_DIALOG_SUCCESS':this.$FBRTCScreenSharingController8(event.data.streamId);break;case 'SC_DIALOG_CANCEL':break;case 'SC_CANCELLED':this.$FBRTCScreenSharingController2.logAction(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,i.Action.SCREEN_SHARING_CANCELLED);this.$FBRTCScreenSharingController6();break;default:this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'Unexpected event type');}};q.prototype.$FBRTCScreenSharingController8=function(r){if(this.$FBRTCScreenSharingController1){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'Screen sharing already enabled, do nothing');return;}this.$FBRTCScreenSharingController3.onStart(r);if(this.$FBRTCScreenSharingController3.isEnabled())j.requestScreenMedia(r);};q.prototype.$FBRTCScreenSharingController6=function(){if(!this.$FBRTCScreenSharingController1){this.$FBRTCScreenSharingController2.logToConsole(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,'Screen sharing already disabled, do nothing');return;}this.$FBRTCScreenSharingController2.logAction(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,i.Action.SCREEN_SHARING_DISABLED);this.$FBRTCScreenSharingController1=false;this.__emitChange();};q.prototype.__onDispatch=function(r){switch(r.type){case j.Types.STREAM_READY:this.$FBRTCScreenSharingController1=!!r.stream;this.$FBRTCScreenSharingController3.setStream(r.stream,false);this.$FBRTCScreenSharingController2.logAction(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,i.Action.SCREEN_SHARING_ENABLED);this.__emitChange();break;case j.Types.STREAM_FAILED:this.$FBRTCScreenSharingController2.logError(this.$FBRTCScreenSharingController4,this.$FBRTCScreenSharingController5,"Failed retrieving the screen stream with error: "+r.error);break;default:break;}};f.exports=q;},null);
__d('FBRTCVideoEscalationStore',['FBRTCCallControlActions','FBRTCConstants','FBRTCStore','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l,m;'use strict';var n=25000,o=10000,p=k({direct_video:null,escalated:null,escalation_declined:null,voip:null});l=babelHelpers.inherits(q,j);m=l&&l.prototype;function q(r,s,t){m.constructor.call(this);this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore2=s;this.$FBRTCVideoEscalationStore3=t;this.$FBRTCVideoEscalationStore4=t;this.$FBRTCVideoEscalationStore5=false;this.$FBRTCVideoEscalationStore6=null;this.$FBRTCVideoEscalationStore7=null;}q.prototype.isPending=function(){return !!this.$FBRTCVideoEscalationStore6;};q.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore3;};q.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported){return p.voip;}else if(this.$FBRTCVideoEscalationStore4){return p.direct_video;}else if(this.$FBRTCVideoEscalationStore3){return p.escalated;}else if(this.$FBRTCVideoEscalationStore5)return p.escalation_declined;return p.voip;};q.prototype.__onDispatch=function(r){switch(r.type){case h.Types.RECEIVED_SIGNALING_MESSAGE:var s=r.message;if(r.message_type===i.PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore5=true;if(s.ackID){this.$FBRTCVideoEscalationStore8(s);}else this.$FBRTCVideoEscalationStore9(s);}if(r.message_type===i.PayloadType.ACK&&s.msg.ack_type===i.PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore10(s);break;case h.Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore11(true);break;case h.Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore11(false);break;case h.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore5=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore12();break;}};q.prototype.$FBRTCVideoEscalationStore10=function(r){if(this.$FBRTCVideoEscalationStore7&&this.$FBRTCVideoEscalationStore7.msg_id===r.ackID)this.$FBRTCVideoEscalationStore13();};q.prototype.$FBRTCVideoEscalationStore13=function(){clearTimeout(this.$FBRTCVideoEscalationStore14);};q.prototype.$FBRTCVideoEscalationStore15=function(){this.$FBRTCVideoEscalationStore14=setTimeout((function(){if(!this.$FBRTCVideoEscalationStore7)return;this.$FBRTCVideoEscalationStore1.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore7);}).bind(this),o);};q.prototype.$FBRTCVideoEscalationStore8=function(r){if(!this.$FBRTCVideoEscalationStore7||r.ackID!==this.$FBRTCVideoEscalationStore7.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore16);this.$FBRTCVideoEscalationStore13();var s=r.msg,t=r.peerID,u=r.callID,v=this.$FBRTCVideoEscalationStore17(s);this.$FBRTCVideoEscalationStore1.sendAck(t,u,s);this.$FBRTCVideoEscalationStore7=null;this.$FBRTCVideoEscalationStore3=v;this.$FBRTCVideoEscalationStore18(v);if(!v&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore9=function(r){if(this.$FBRTCVideoEscalationStore3){if(this.$FBRTCVideoEscalationStore17(r.msg)){this.$FBRTCVideoEscalationStore6=r;this.$FBRTCVideoEscalationStore11(true);}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return;}var s=r.msg,t=r.peerID,u=r.callID;this.$FBRTCVideoEscalationStore1.sendAck(t,u,s);if(this.$FBRTCVideoEscalationStore17(s)){this.$FBRTCVideoEscalationStore6=r;this.$FBRTCVideoEscalationStore16=setTimeout(function(){h.declineEscalation();},n);}else this.$FBRTCVideoEscalationStore6=null;this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore11=function(r){clearTimeout(this.$FBRTCVideoEscalationStore16);if(this.$FBRTCVideoEscalationStore6){var s=this.$FBRTCVideoEscalationStore6,t=s.peerID,u=s.callID,v=s.msgID;this.$FBRTCVideoEscalationStore7=this.$FBRTCVideoEscalationStore1.sendVideoRequestResponse(t,u,v,r);this.$FBRTCVideoEscalationStore15();this.$FBRTCVideoEscalationStore3=r;this.$FBRTCVideoEscalationStore6=null;this.__emitChange();}};q.prototype.$FBRTCVideoEscalationStore12=function(){if(this.$FBRTCVideoEscalationStore3){this.$FBRTCVideoEscalationStore19();return;}this.$FBRTCVideoEscalationStore7=this.$FBRTCVideoEscalationStore1.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore15();this.$FBRTCVideoEscalationStore16=setTimeout((function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())h.toggleMuteVideo();}).bind(this),n);}else{this.$FBRTCVideoEscalationStore13();clearTimeout(this.$FBRTCVideoEscalationStore16);this.$FBRTCVideoEscalationStore7=null;}this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore1.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());};q.prototype.$FBRTCVideoEscalationStore18=function(r){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(r);};q.prototype.$FBRTCVideoEscalationStore17=function(r){return !!(r.reqVideoOn||r.videoon);};f.exports=q;},null);
__d("FBRTCWindowManager",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={height:0,width:0,top:0,left:0},i={height:452,width:534,bottomRightOffset:50},j={init:function(k,l){this._window=k;this._callModel=l;l.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition();},updatePosition:function(k){if(!this._window)return;if(k&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return;}this._storePosition();this._window.resizeTo(i.width,i.height);var l=screen.width-i.width-i.bottomRightOffset,m=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(l,m);},reload:function(){if(this._window&&!this._window.closed)this._window.location.reload();},close:function(){if(this._window&&!this._window.closed)this._window.close();},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)try{this._window.opener.addEventListener("unload",(function(event){this._passWindowToOpener(10);}).bind(this));}catch(k){}},_passWindowToOpener:function(k){setTimeout((function(){setTimeout((function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}).bind(this),1);if(k>1)this._passWindowToOpener(k-1);}).bind(this),1000);},_storePosition:function(){if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth;}else{h.height=this._window.screen.height;h.width=this._window.screen.width;}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop;}else{h.left=this._window.screenX;h.top=this._window.screenY;}}}};f.exports=j;},null);
__d('FBRTCCallController',['ErrorUtils','Run','FBRTCCallConnection','FBRTCCallConnectionMonitor','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallMonitor','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConfig','FBRTCConstants','FBRTCDispatcher','FBRTCExperiment','FBRTCIceCache','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageListener','FBRTCMessageSender','FBRTCPCConfig','FBRTCTurnDiscovery','FBRTCUserMedia','FBRTCViewController','FBRTCCallModelStatePusher','FBRTCCallDialogController','FBRTCRetriableMessage','FBRTCUserMediaRequest','FBRTCUserSettings','FBRTCScreenSharingController','FBRTCScreenSharingUtils','FBRTCSdpUtils','FBRTCStreamWrapper','FBRTCUrlManager','FBRTCVideoEscalationStore','FBRTCWindowManager','fbt','randomInt','AvailableList'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){if(c.__markCompiled)c.__markCompiled();c('AvailableList');var ta=60000;function ua(){return sa(0,4294967295);}function va(wa,xa,ya,za){'use strict';this.$FBRTCCallController1=w.getInstance();this.$FBRTCCallController2=new v();this.$FBRTCCallController3=p.getInstance();this.$FBRTCCallController4=null;this.$FBRTCCallController5=false;if(!ya){var ab=this.$FBRTCCallController2.getOffer(wa);if(ab){this.$FBRTCCallController4=new x(ab);y.check(wa,this.$FBRTCCallController4.callID,this.$FBRTCCallController4.msgID);}else ya=true;}if(!xa)xa=this.$FBRTCCallController4?this.$FBRTCCallController4.callID:ua();this.$FBRTCCallController1.logCallAction(wa,xa,w.CallAction.POPUP_OPENED);this.$FBRTCCallController6=new m({peerID:wa,callID:xa,isCaller:ya});if(this.$FBRTCCallController4)this.$FBRTCCallController6.onSDPMessageFromPeer(this.$FBRTCCallController4);this.$FBRTCCallController6.localStream.setVideoEnabled(!za);this.$FBRTCCallController7=new fa(this.$FBRTCCallController6);this.$FBRTCCallController8=o.restoreOrInitialize(this.$FBRTCCallController3,wa,xa,ya,this.$FBRTCCallController4&&this.$FBRTCCallController4.msg);this.$FBRTCCallController8.onPopupOpened();oa.init(this.$FBRTCCallController6.peerID);qa.init(window,this.$FBRTCCallController6);this.$FBRTCCallController9=new ka(wa,xa);if(la.isScreenSharingSupported())this.$FBRTCCallController9.addListener(this.$FBRTCCallController10.bind(this));this.$FBRTCCallController11=new ea(this.$FBRTCCallController6,this.$FBRTCCallController8,this.$FBRTCCallController3);this.$FBRTCCallController11.onStartCall=this.$FBRTCCallController12.bind(this);this.$FBRTCCallController11.init();this.$FBRTCCallController13=new j();this.$FBRTCCallController13.addListener('remoteStreamAdded',this.$FBRTCCallController14,this);this.$FBRTCCallController13.addListener('remoteStreamRemoved',this.$FBRTCCallController15,this);this.$FBRTCCallController13.addListener('sdpCreated',this.$FBRTCCallController16,this);this.$FBRTCCallController13.addListener('localIceCandidateCreated',this.$FBRTCCallController17,this);this.$FBRTCCallController13.addListener('remoteDescriptionSet',this.$FBRTCCallController18,this);this.$FBRTCCallController13.addListener('connected',this.$FBRTCCallController19,this);this.$FBRTCCallController13.addListener('disconnected',this.$FBRTCCallController20,this);this.$FBRTCCallController13.addListener('connectionUnstable',this.$FBRTCCallController21,this);this.$FBRTCCallController13.addListener('connectionError',this.$FBRTCCallController22,this);this.$FBRTCCallController23=false;this.$FBRTCCallController24=new k(this.$FBRTCCallController13,this.$FBRTCCallController8);this.$FBRTCCallController24.addListener('connectionPoor',this.$FBRTCCallController25,this);this.$FBRTCCallController26=new aa();this.$FBRTCCallController26.onMessageSent=this.$FBRTCCallController27.bind(this);this.$FBRTCCallController26.onSendFailure=this.$FBRTCCallController28.bind(this);this.$FBRTCCallController29=null;this.$FBRTCCallController30=null;this.$FBRTCCallController31=new pa(this.$FBRTCCallController26,this.$FBRTCCallController6,!za);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController31.getCallType());this.$FBRTCCallController31.addListener(this.$FBRTCCallController32.bind(this));this.$FBRTCCallController33=new u();this.$FBRTCCallController34=false;i.onBeforeUnload(this.$FBRTCCallController35.bind(this),false);i.onUnload(this.$FBRTCCallController36.bind(this));h.addListener(this.$FBRTCCallController37.bind(this),true);z.init(true);z.setMessageHandler(this.$FBRTCCallController38,this);var bb=this;this.$FBRTCCallController39=new n(this.$FBRTCCallController6);this.$FBRTCCallController39.startHeartbeat(function(){return bb.$FBRTCCallController8;});this.$FBRTCCallController40=null;ja.addListener('saved',this.$FBRTCCallController41,this);ca.addListener('receivedTurnCreds',this.$FBRTCCallController42,this);ca.addListener('failed',this.$FBRTCCallController43,this);ca.requestTurnCreds(this.$FBRTCCallController6);s.register(this.__onDispatch.bind(this));this.$FBRTCCallController44=setTimeout((function(){this.waitForUserInput();}).bind(this),1500);}va.prototype.__onDispatch=function(wa){'use strict';switch(wa.type){case l.Types.HANG_UP:this.$FBRTCCallController45(r.CallEndReason.HANGUP_CALL,false,true,false);break;case l.Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController9)this.$FBRTCCallController9.toggleScreenSharing(this.$FBRTCCallController6);break;case l.Types.SHOW_SETTINGS:ga.showDialog(ga.dialogTypes.SETTINGS,this.$FBRTCCallController6);break;case l.Types.ACCEPT_ESCALATION:this.$FBRTCCallController6.localStream.setVideoEnabled(true);this.$FBRTCCallController46(true);break;case l.Types.RESET_CALL:this.$FBRTCCallController47(wa);break;case l.Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController6.canBeStartedByParentWindow())this.startCallProcess();break;}};va.prototype.getCallModel=function(){'use strict';return this.$FBRTCCallController6;};va.prototype.getViewController=function(){'use strict';return this.$FBRTCCallController11;};va.prototype.getConnection=function(){'use strict';return this.$FBRTCCallController13;};va.prototype.sendData=function(wa,xa){'use strict';this.$FBRTCCallController13.sendData({topic:wa,data:xa});};va.prototype.addDataChannelListener=function(wa,xa){'use strict';return this.$FBRTCCallController13.addListener('data_message',wa,xa);};va.prototype.$FBRTCCallController12=function(wa){'use strict';this.$FBRTCCallController8.onCallStarted(wa);this.startCallProcess();};va.prototype.startCallProcess=function(){'use strict';this.$FBRTCCallController48();this.$FBRTCCallController11.userMediaRequested();};va.prototype.waitForUserInput=function(){'use strict';this.$FBRTCCallController11.waitForUserInput();};va.prototype.$FBRTCCallController48=function(){'use strict';da.once('streamReady',this.$FBRTCCallController49,this);da.addListener('accessDenied',this.$FBRTCCallController50,this);da.addListener('accessFailed',this.$FBRTCCallController51,this);da.addListener('accessGranted',this.$FBRTCCallController52,this);this.$FBRTCCallController6.localStream.addListener('streamStarted',(function(){var wa=this.$FBRTCCallController6.localStream.videoWidth,xa=this.$FBRTCCallController6.localStream.videoHeight;this.$FBRTCCallController8.setVideoCaptureStats(wa,xa);var ya=this.$FBRTCCallController6.isRemoteVideoSupported;}).bind(this));this.$FBRTCCallController53();};va.prototype.$FBRTCCallController53=function(){'use strict';var wa;if(!this.$FBRTCCallController6.isRemoteVideoSupported){wa=da.STREAM_TYPE.NO_VIDEO;}else if(this.$FBRTCCallController6.isPeerOnMobile){wa=da.STREAM_TYPE.LQ_VIDEO;}else{var xa=t.gen('rtc_web_video_quality'),ya=xa.getParam('quality','HD');if(ya==='SD'){wa=da.STREAM_TYPE.SD_VIDEO;}else if(ya==='LQ'){wa=da.STREAM_TYPE.LQ_VIDEO;}else wa=da.STREAM_TYPE.HD_VIDEO;}da.requestUserMedia(wa,ja.savedMic,ja.savedCamera);};va.prototype.$FBRTCCallController41=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,w.CallAction.USER_SETTINGS_CHANGED);da.once('streamReady',(function(wa){ja.updateForLocalStream(wa);this.$FBRTCCallController6.setLocalStream(wa);this.$FBRTCCallController54();}).bind(this));this.$FBRTCCallController53();};va.prototype.$FBRTCCallController10=function(){'use strict';var wa=this.$FBRTCCallController9.isEnabled(),xa=this.$FBRTCCallController9.getStream();if(wa){this.$FBRTCCallController13.addScreenStream(xa);}else{this.$FBRTCCallController13.removeScreenStream(xa);this.$FBRTCCallController9.onStop();}this.$FBRTCCallController54();this.$FBRTCCallController6.selfViewOpen=!wa;qa.updatePosition(!wa);this.$FBRTCCallController6.setScreenSharingStatus(wa);};va.prototype.$FBRTCCallController14=function(event){'use strict';if(na.isScreenStream(event.stream)&&this.$FBRTCCallController13.getRemoteStreamsCount()>1){this.$FBRTCCallController9.setRemoteStream(event.stream);this.$FBRTCCallController6.setRemoteScreenStream(this.$FBRTCCallController9.getStream());}else this.$FBRTCCallController11.onRemoteStreamAdded(event);};va.prototype.$FBRTCCallController15=function(event){'use strict';if(na.isScreenStream(event.stream)){this.$FBRTCCallController6.setRemoteScreenStream(null);this.$FBRTCCallController9.setRemoteStream(null);}};va.prototype.$FBRTCCallController21=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network unstable');};va.prototype.$FBRTCCallController25=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network poor');if(q.shouldAutoDisableVideo())this.$FBRTCCallController6.autoDisableVideo();};va.prototype.$FBRTCCallController37=function(wa){'use strict';var xa=wa.message+'; '+wa.stackFrames[0].identifier;this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'JSError: '+xa);};va.prototype.$FBRTCCallController35=function(){'use strict';if(this.$FBRTCCallController6.isInProgress())return ra._("Leaving this page will end your call.");};va.prototype.$FBRTCCallController36=function(){'use strict';if(this.$FBRTCCallController6.isEnded())return;var wa=this.$FBRTCCallController6.isUserMediaPending(),xa=this.$FBRTCCallController6.isUserMediaDenied(),ya=r.CallEndReason.HANGUP_CALL,za='BrowserClosed';if(wa||xa){ya=r.CallEndReason.CLIENT_ERROR;za=wa?'MediaPending':'MediaDenied';}else if(this.$FBRTCCallController6.isAwaitingUserStart())za='AwaitingUserStart';this.$FBRTCCallController45(ya,false,true,true,za);};va.prototype.$FBRTCCallController42=function(wa){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Received Turn Creds');ba.setTurnCredentials(wa);this.$FBRTCCallController11.onTurnCredentialsReady(wa);this.$FBRTCCallController55();};va.prototype.$FBRTCCallController43=function(){'use strict';this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Failed to get turn creds');this.$FBRTCCallController45(r.CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController6.isCaller,false,'NoTurnCreds');};va.prototype.$FBRTCCallController55=function(){'use strict';if(this.$FBRTCCallController6.canStartCall()){oa.onCallStarted();var wa=this.$FBRTCCallController6.localStream;this.$FBRTCCallController13.init(wa);if(!this.$FBRTCCallController4){this.$FBRTCCallController13.createOffer();}else{if(this.$FBRTCCallController4.isFromMobile()&&!wa.hasVideoTracks())this.$FBRTCCallController4.disableVideo();if(this.$FBRTCCallController4.msg.hasOwnProperty('videoon'))this.$FBRTCCallController46(this.$FBRTCCallController4.msg.videoon);this.$FBRTCCallController6.setSignalingExperiments(this.$FBRTCCallController4.getSignalingExperiments());this.$FBRTCCallController56(this.$FBRTCCallController4.msg.sdp,true);this.$FBRTCCallController2.removeOffer(this.$FBRTCCallController6.peerID);this.$FBRTCCallController4=null;}this.$FBRTCCallController2.enableDequeuing(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,this.$FBRTCCallController38.bind(this));}};va.prototype.$FBRTCCallController54=function(){'use strict';if(this.$FBRTCCallController6.isAwaitingAnswer()){this.$FBRTCCallController23=true;}else{this.$FBRTCCallController23=false;if(this.$FBRTCCallController6.supportsSdpUpdate()){this.$FBRTCCallController13.createSdpUpdate();}else{this.$FBRTCCallController5=true;this.$FBRTCCallController33.reset(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID);this.$FBRTCCallController34=false;this.$FBRTCCallController13.createOffer();}}};va.prototype.$FBRTCCallController49=function(wa){'use strict';ja.updateForLocalStream(wa);this.$FBRTCCallController11.onLocalStreamReady(wa);this.$FBRTCCallController55();};va.prototype.$FBRTCCallController50=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,w.CallAction.DENIED_PERMISSION);this.$FBRTCCallController11.userMediaDenied();};va.prototype.$FBRTCCallController51=function(wa){'use strict';this.$FBRTCCallController45(r.CallEndReason.CLIENT_ERROR,false,true,false,wa);ga.showDialog(ga.dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController6);};va.prototype.$FBRTCCallController52=function(){'use strict';this.$FBRTCCallController11.userMediaGranted();};va.prototype.$FBRTCCallController16=function(wa){'use strict';switch(wa.type){case 'offer':this.$FBRTCCallController57(wa.sdp);break;case 'answer':this.$FBRTCCallController58(wa.sdp);break;case 'sdp_update':this.$FBRTCCallController59(wa.sdp);break;default:break;}};va.prototype.$FBRTCCallController59=function(wa){'use strict';this.$FBRTCCallController26.sendSdpUpdate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,wa,this.$FBRTCCallController6.localStream.hasVideo());};va.prototype.$FBRTCCallController57=function(wa){'use strict';var xa;if(!this.$FBRTCCallController5){xa=r.PayloadType.OFFER;}else{xa=r.PayloadType.PCRESTART_OFFER;this.$FBRTCCallController5=false;}this.$FBRTCCallController29=new ha(this.$FBRTCCallController26);this.$FBRTCCallController29.addListener('sendingRetry',this.$FBRTCCallController60.bind(this));this.$FBRTCCallController29.addListener('timeoutFailure',this.$FBRTCCallController61.bind(this));this.$FBRTCCallController29.sendMessage(xa,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,wa,this.$FBRTCCallController6.localStream.hasVideo());this.$FBRTCCallController40=setTimeout((function(){this.$FBRTCCallController45(r.CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}).bind(this),ta);};va.prototype.$FBRTCCallController61=function(){'use strict';var wa;if(this.$FBRTCCallController6.receivedNack){wa=r.CallEndReason.UNSUPPORTED_VERSION;ga.showDialog(ga.dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController6);}else wa=r.CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController45(wa,false,true,false,'TimedOut');};va.prototype.$FBRTCCallController46=function(wa){'use strict';this.$FBRTCCallController6.remoteStream.setVideoEnabled(wa);};va.prototype.$FBRTCCallController58=function(wa){'use strict';var xa=this.$FBRTCCallController6.localStream.hasVideo()&&this.$FBRTCCallController6.isRemoteVideoSupported;this.$FBRTCCallController30=new ha(this.$FBRTCCallController26);this.$FBRTCCallController30.addListener('sendingRetry',this.$FBRTCCallController60.bind(this));this.$FBRTCCallController30.sendMessage(r.PayloadType.ANSWER,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,wa,xa);};va.prototype.$FBRTCCallController60=function(){'use strict';var wa=this.$FBRTCCallController13.getCreatedIceCandidates();for(var xa=0;xa<wa.length;xa++)this.$FBRTCCallController62(wa[xa]);};va.prototype.$FBRTCCallController62=function(wa){'use strict';this.$FBRTCCallController26.sendIceCandidate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,wa);};va.prototype.$FBRTCCallController56=function(wa,xa){'use strict';this.$FBRTCCallController13.setPeerSupportsVideo(this.$FBRTCCallController6.isRemoteVideoSupported);if(this.$FBRTCCallController6.isPeerOnMobile)wa=ma.setVideoBitrateConstraint(wa);if(xa){this.$FBRTCCallController13.onReceivedOfferSDP(wa);}else this.$FBRTCCallController13.onReceivedAnswerSDP(wa);};va.prototype.$FBRTCCallController17=function(wa){'use strict';this.$FBRTCCallController62(wa);};va.prototype.$FBRTCCallController18=function(){'use strict';this.$FBRTCCallController34=true;var wa=this;this.$FBRTCCallController33.drainCandidates(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,function(xa){wa.$FBRTCCallController13.onReceivedRemoteIceCandidate(xa);});};va.prototype.$FBRTCCallController19=function(){'use strict';this.$FBRTCCallController63();this.$FBRTCCallController8.onCallConnected();this.$FBRTCCallController39.onCallHeartbeat(this.$FBRTCCallController8);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Call Connected');};va.prototype.$FBRTCCallController20=function(){'use strict';this.$FBRTCCallController45(r.CallEndReason.CONNECTION_DROPPED,false,true,false);};va.prototype.$FBRTCCallController22=function(wa){'use strict';this.$FBRTCCallController45(r.CallEndReason.WEBRTC_ERROR,false,true,false,wa.endCallSubreason);this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'webrtc error: '+JSON.stringify(wa.details));};va.prototype.$FBRTCCallController28=function(wa,xa){'use strict';this.$FBRTCCallController45(wa,false,false,false,xa);};va.prototype.$FBRTCCallController27=function(wa,xa){'use strict';var ya=xa.call_id,za=xa.type;if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Message sent after call ended: '+za);return;}if(this.$FBRTCCallController6.peerID!==wa||this.$FBRTCCallController6.callID!==ya)return;this.$FBRTCCallController11.onMessageTypeSent(za);this.$FBRTCCallController8.onMessageSent(xa);};va.prototype.$FBRTCCallController38=function(wa){'use strict';var xa;try{xa=new x(wa);}catch(ya){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Unknown data: '+JSON.stringify(wa));return;}this.$FBRTCCallController1.logReceivedMessage(xa.peerID,xa.callID,xa.msg);if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (call ended): '+xa.msgID);return;}if(!y.check(xa.peerID,xa.callID,xa.msgID)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (duplicate): '+xa.msgID);return;}if(this.$FBRTCCallController6.isAwaitingUserStart())return;if(this.$FBRTCCallController6.peerID&&this.$FBRTCCallController6.peerID!==xa.peerID){if(xa.isOffer())this.$FBRTCCallController64(xa);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different peer): '+xa.msgID);return;}if(!xa.isForCall(this.$FBRTCCallController6)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different call): '+xa.msgID);return;}this.$FBRTCCallController11.onMessageTypeReceived(xa.msgType);if(this.$FBRTCCallController6.callID&&this.$FBRTCCallController6.callID===xa.callID)this.$FBRTCCallController8.onFullMessageReceived(xa);this.$FBRTCCallController6.setSignalingExperiments(xa.getSignalingExperiments());switch(xa.msgType){case r.PayloadType.OFFER:case r.PayloadType.ICERESTART_OFFER:case r.PayloadType.PCRESTART_OFFER:this.$FBRTCCallController65(xa);break;case r.PayloadType.ANSWER:case r.PayloadType.ICERESTART_ANSWER:case r.PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController66(xa);this.$FBRTCCallController39.onCallHeartbeat(this.$FBRTCCallController8);break;case r.PayloadType.SDP_UPDATE:this.$FBRTCCallController67(xa);break;case r.PayloadType.ICE_CANDIDATE:this.$FBRTCCallController68(xa);break;case r.PayloadType.HANGUP:this.$FBRTCCallController69(xa);break;case r.PayloadType.OFFER_ACK:this.$FBRTCCallController70();break;case r.PayloadType.OFFER_NACK:this.$FBRTCCallController6.receivedNack=true;break;case r.PayloadType.ANSWER_ACK:this.$FBRTCCallController71();break;case r.PayloadType.MSG_ACK:this.$FBRTCCallController72(xa);break;case r.PayloadType.SET_VIDEO:if(this.$FBRTCCallController6.isRemoteVideoSupported&&(this.$FBRTCCallController31.callHasEscalated()||!this.$FBRTCCallController6.isPeerOnMobile))this.$FBRTCCallController46(xa.msg.videoon);break;case r.PayloadType.VIDEO_REQUEST:case r.PayloadType.ACK:case r.PayloadType.OK:case r.PayloadType.PING:case r.PayloadType.OTHER_DISMISS:case r.PayloadType.PRANSWER:break;default:break;}l.receivedSignalingMessage(xa);};va.prototype.$FBRTCCallController64=function(wa){'use strict';var xa=wa.peerID,ya=wa.callID,za=wa.msg,ab=new o({peerID:xa,callID:ya,isCaller:false});ab.onFullMessageReceived(wa);this.$FBRTCCallController26.sendOfferAck(xa,ya,za);ab.onOfferAckSent(za);var bb=r.CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController73(xa,ya,bb);ab.onCallEnded(bb,false);ab.save(this.$FBRTCCallController3);};va.prototype.$FBRTCCallController65=function(wa){'use strict';var xa=wa.msg;this.$FBRTCCallController26.sendOfferAck(this.$FBRTCCallController6.peerID,xa.call_id,xa);this.$FBRTCCallController26.sendOtherDismiss(xa.call_id);if(this.$FBRTCCallController74(xa)){this.$FBRTCCallController7